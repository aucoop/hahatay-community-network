(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{1124:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"\n#priority[data-v-95f06344] {\n\tdisplay: inline-block;\n}\n.app-content-list-item[data-v-95f06344]:hover {\n\tbackground-color: transparent;\n\topacity: 0.8;\n}\n","",{version:3,sources:["webpack://./src/components/SectionTitle.vue"],names:[],mappings:";AAyCA;CACA,qBAAA;AACA;AACA;CACA,6BAAA;CACA,YAAA;AACA",sourcesContent:['\x3c!--\n  - @copyright 2020 Greta Doçi <gretadoci@gmail.com>\n  -\n  - @author 2020 Greta Doçi <gretadoci@gmail.com>\n  -\n  - @license GNU AGPL version 3 or any later version\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<template>\n\t<div id="priority">\n\t\t<div class="app-content-list-item">\n\t\t\t<h2>{{ name }}</h2>\n\t\t</div>\n\t</div>\n</template>\n<script>\nexport default {\n\tname: \'SectionTitle\',\n\tprops: {\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n#priority {\n\tdisplay: inline-block;\n}\n.app-content-list-item:hover {\n\tbackground-color: transparent;\n\topacity: 0.8;\n}\n</style>\n'],sourceRoot:""}]),n.a=r},1129:function(t,n,e){var a={"./af":846,"./af.js":846,"./ar":847,"./ar-dz":848,"./ar-dz.js":848,"./ar-kw":849,"./ar-kw.js":849,"./ar-ly":850,"./ar-ly.js":850,"./ar-ma":851,"./ar-ma.js":851,"./ar-sa":852,"./ar-sa.js":852,"./ar-tn":853,"./ar-tn.js":853,"./ar.js":847,"./az":854,"./az.js":854,"./be":855,"./be.js":855,"./bg":856,"./bg.js":856,"./bm":857,"./bm.js":857,"./bn":858,"./bn.js":858,"./bo":859,"./bo.js":859,"./br":860,"./br.js":860,"./bs":861,"./bs.js":861,"./ca":862,"./ca.js":862,"./cs":863,"./cs.js":863,"./cv":864,"./cv.js":864,"./cy":865,"./cy.js":865,"./da":866,"./da.js":866,"./de":867,"./de-at":868,"./de-at.js":868,"./de-ch":869,"./de-ch.js":869,"./de.js":867,"./dv":870,"./dv.js":870,"./el":871,"./el.js":871,"./en-SG":872,"./en-SG.js":872,"./en-au":873,"./en-au.js":873,"./en-ca":874,"./en-ca.js":874,"./en-gb":875,"./en-gb.js":875,"./en-ie":876,"./en-ie.js":876,"./en-il":877,"./en-il.js":877,"./en-nz":878,"./en-nz.js":878,"./eo":879,"./eo.js":879,"./es":880,"./es-do":881,"./es-do.js":881,"./es-us":882,"./es-us.js":882,"./es.js":880,"./et":883,"./et.js":883,"./eu":884,"./eu.js":884,"./fa":885,"./fa.js":885,"./fi":886,"./fi.js":886,"./fo":887,"./fo.js":887,"./fr":888,"./fr-ca":889,"./fr-ca.js":889,"./fr-ch":890,"./fr-ch.js":890,"./fr.js":888,"./fy":891,"./fy.js":891,"./ga":892,"./ga.js":892,"./gd":893,"./gd.js":893,"./gl":894,"./gl.js":894,"./gom-latn":895,"./gom-latn.js":895,"./gu":896,"./gu.js":896,"./he":897,"./he.js":897,"./hi":898,"./hi.js":898,"./hr":899,"./hr.js":899,"./hu":900,"./hu.js":900,"./hy-am":901,"./hy-am.js":901,"./id":902,"./id.js":902,"./is":903,"./is.js":903,"./it":904,"./it-ch":905,"./it-ch.js":905,"./it.js":904,"./ja":906,"./ja.js":906,"./jv":907,"./jv.js":907,"./ka":908,"./ka.js":908,"./kk":909,"./kk.js":909,"./km":910,"./km.js":910,"./kn":911,"./kn.js":911,"./ko":912,"./ko.js":912,"./ku":913,"./ku.js":913,"./ky":914,"./ky.js":914,"./lb":915,"./lb.js":915,"./lo":916,"./lo.js":916,"./lt":917,"./lt.js":917,"./lv":918,"./lv.js":918,"./me":919,"./me.js":919,"./mi":920,"./mi.js":920,"./mk":921,"./mk.js":921,"./ml":922,"./ml.js":922,"./mn":923,"./mn.js":923,"./mr":924,"./mr.js":924,"./ms":925,"./ms-my":926,"./ms-my.js":926,"./ms.js":925,"./mt":927,"./mt.js":927,"./my":928,"./my.js":928,"./nb":929,"./nb.js":929,"./ne":930,"./ne.js":930,"./nl":931,"./nl-be":932,"./nl-be.js":932,"./nl.js":931,"./nn":933,"./nn.js":933,"./pa-in":934,"./pa-in.js":934,"./pl":935,"./pl.js":935,"./pt":936,"./pt-br":937,"./pt-br.js":937,"./pt.js":936,"./ro":938,"./ro.js":938,"./ru":939,"./ru.js":939,"./sd":940,"./sd.js":940,"./se":941,"./se.js":941,"./si":942,"./si.js":942,"./sk":943,"./sk.js":943,"./sl":944,"./sl.js":944,"./sq":945,"./sq.js":945,"./sr":946,"./sr-cyrl":947,"./sr-cyrl.js":947,"./sr.js":946,"./ss":948,"./ss.js":948,"./sv":949,"./sv.js":949,"./sw":950,"./sw.js":950,"./ta":951,"./ta.js":951,"./te":952,"./te.js":952,"./tet":953,"./tet.js":953,"./tg":954,"./tg.js":954,"./th":955,"./th.js":955,"./tl-ph":956,"./tl-ph.js":956,"./tlh":957,"./tlh.js":957,"./tr":958,"./tr.js":958,"./tzl":959,"./tzl.js":959,"./tzm":960,"./tzm-latn":961,"./tzm-latn.js":961,"./tzm.js":960,"./ug-cn":962,"./ug-cn.js":962,"./uk":963,"./uk.js":963,"./ur":964,"./ur.js":964,"./uz":965,"./uz-latn":966,"./uz-latn.js":966,"./uz.js":965,"./vi":967,"./vi.js":967,"./x-pseudo":968,"./x-pseudo.js":968,"./yo":969,"./yo.js":969,"./zh-cn":970,"./zh-cn.js":970,"./zh-hk":971,"./zh-hk.js":971,"./zh-tw":972,"./zh-tw.js":972};function i(t){var n=o(t);return e(n)}function o(t){if(!e.o(a,t)){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}return a[t]}i.keys=function(){return Object.keys(a)},i.resolve=o,t.exports=i,i.id=1129},1189:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"[data-v-268a25d4] .modal-content{padding-left:20px;padding-right:20px;width:250px;max-height:calc(100vh - 210px);overflow-y:auto}.tag-title[data-v-268a25d4]{margin-top:20px;margin-left:10px}.tag-group[data-v-268a25d4]{display:block;position:relative;margin:0 1px;overflow:hidden;left:4px}.tag-actions[data-v-268a25d4]{background-color:transparent;border:none;float:right}.tag-actions[data-v-268a25d4]:hover,.tag-actions[data-v-268a25d4]:focus{opacity:.7}.tag-group__label[data-v-268a25d4]{z-index:2;font-weight:bold;border:none;background-color:transparent;padding-left:10px;padding-right:10px}.app-navigation-entry-bullet-wrapper[data-v-268a25d4]{width:44px;height:44px;display:inline-block;position:absolute;list-style:none}.app-navigation-entry-bullet-wrapper .color0[data-v-268a25d4]{width:30px !important;height:30px;border-radius:50%;background-size:14px;margin-top:-65px;margin-left:180px;z-index:2;display:flex;position:relative}.icon-colorpicker[data-v-268a25d4]{background-image:var(--icon-add-fff)}.tagButton[data-v-268a25d4]{display:inline-block;margin-left:10px}.action[data-v-268a25d4]{list-style:none}[data-v-268a25d4] .action-input{margin-left:-31px}[data-v-268a25d4] .icon-tag{background-image:none}","",{version:3,sources:["webpack://./src/components/TagModal.vue"],names:[],mappings:"AAoKA,iCACC,iBAAA,CACA,kBAAA,CAEA,WAAA,CACA,8BAAA,CACA,eAAA,CAED,4BACC,eAAA,CACA,gBAAA,CAED,4BACC,aAAA,CACA,iBAAA,CACA,YAAA,CACA,eAAA,CACA,QAAA,CAED,8BACC,4BAAA,CACA,WAAA,CACA,WAAA,CACA,wEAEC,UAAA,CAGF,mCACC,SAAA,CACA,gBAAA,CACA,WAAA,CACA,4BAAA,CACA,iBAAA,CACA,kBAAA,CAED,sDACC,UAAA,CACA,WAAA,CACA,oBAAA,CACA,iBAAA,CACA,eAAA,CAEA,8DACC,qBAAA,CACA,WAAA,CACA,iBAAA,CACA,oBAAA,CACA,gBAAA,CACA,iBAAA,CACA,SAAA,CACA,YAAA,CACA,iBAAA,CAGF,mCACC,oCAAA,CAED,4BACC,oBAAA,CACA,gBAAA,CAED,yBACC,eAAA,CAED,gCACC,iBAAA,CAED,4BACC,qBAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n::v-deep .modal-content {\n\tpadding-left: 20px;\n\tpadding-right: 20px;\n\t// modal jumps on the right when text is changed to 'remove'\n\twidth: 250px;\n\tmax-height: calc(100vh - 210px);\n\toverflow-y: auto;\n}\n.tag-title {\n\tmargin-top: 20px;\n\tmargin-left: 10px;\n}\n.tag-group {\n\tdisplay: block;\n\tposition: relative;\n\tmargin: 0 1px;\n\toverflow: hidden;\n\tleft: 4px;\n}\n.tag-actions {\n\tbackground-color: transparent;\n\tborder: none;\n\tfloat: right;\n\t&:hover,\n\t&:focus {\n\t\topacity: .7;\n\t}\n}\n.tag-group__label {\n\tz-index: 2;\n\tfont-weight: bold;\n\tborder: none;\n\tbackground-color: transparent;\n\tpadding-left: 10px;\n\tpadding-right: 10px;\n}\n.app-navigation-entry-bullet-wrapper {\n\twidth: 44px;\n\theight: 44px;\n\tdisplay: inline-block;\n\tposition: absolute;\n\tlist-style: none;\n\n\t.color0 {\n\t\twidth: 30px !important;\n\t\theight: 30px;\n\t\tborder-radius: 50%;\n\t\tbackground-size: 14px;\n\t\tmargin-top: -65px;\n\t\tmargin-left: 180px;\n\t\tz-index: 2;\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t}\n}\n.icon-colorpicker {\n\tbackground-image: var(--icon-add-fff);\n}\n.tagButton {\n\tdisplay: inline-block;\n\tmargin-left: 10px;\n}\n.action {\n\tlist-style: none;\n}\n::v-deep .action-input {\n\tmargin-left: -31px;\n}\n::v-deep .icon-tag {\n\tbackground-image: none;\n}\n"],sourceRoot:""}]),n.a=r},1190:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,'.mail-message-account-color[data-v-97196126]{position:absolute;left:0px;width:2px;height:69px;z-index:1}.icon-important[data-v-97196126]  path{fill:#fc0;stroke:var(--color-main-background)}.list-item:hover .icon-important[data-v-97196126]  path,.list-item:focus .icon-important[data-v-97196126]  path,.list-item.active .icon-important[data-v-97196126]  path{stroke:var(--color-background-dark)}.icon-important.app-content-list-item-star[data-v-97196126]{background-image:none;left:7px;top:13px;opacity:1}.icon-important.app-content-list-item-star[data-v-97196126]:hover,.icon-important.app-content-list-item-star[data-v-97196126]:focus{opacity:.5}.app-content-list-item-select-checkbox[data-v-97196126]{display:inline-block;vertical-align:middle;position:absolute;left:33px;top:35px;z-index:50}.list-item-style[data-v-97196126]:not(.seen){font-weight:bold}.list-item-style.selected[data-v-97196126]{background-color:var(--color-background-dark);font-weight:bold}.icon-junk[data-v-97196126]{opacity:.2;display:flex;top:6px;left:34px;background-size:16px;height:20px;width:20px;margin:0;padding:0;position:absolute;z-index:2}list-item-style.draft .app-content-list-item-line-two[data-v-97196126]{font-style:italic}.list-item-style.active[data-v-97196126]{background-color:var(--color-primary-light);border-radius:16px}.icon-reply[data-v-97196126],.icon-attachment[data-v-97196126]{display:inline-block;vertical-align:text-top}.icon-reply[data-v-97196126]{-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=25)";opacity:.25}.icon-attachment[data-v-97196126]{-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=25)";opacity:.25}.app-content-list .list-item[data-v-97196126]{padding-right:0}.app-content-list .list-item .app-content-list-item-line-two[data-v-97196126]{padding-right:0;margin-top:-8px}.app-content-list .list-item .app-content-list-item-menu[data-v-97196126]{margin-right:-2px;margin-top:-8px}.app-content-list .list-item .app-content-list-item-menu[data-v-97196126]  .action-item__menu{right:7px !important}.app-content-list .list-item .app-content-list-item-menu[data-v-97196126]  .action-item__menu .action-item__menu_arrow{right:6px !important}.app-content-list .list-item .app-content-list-item-details[data-v-97196126]{padding-right:7px}[data-v-97196126] .list-item__extra{margin-left:41px !important}.tag-group__label[data-v-97196126]{margin:0 7px;z-index:2;font-size:calc(var(--default-font-size) * 0.8);font-weight:bold;padding-left:2px;padding-right:2px}.tag-group__bg[data-v-97196126]{position:absolute;width:100%;height:100%;top:0;left:0;opacity:15%}.tag-group[data-v-97196126]{display:inline-block;border:1px solid transparent;border-radius:var(--border-radius-pill);position:relative;margin:0 1px;overflow:hidden;left:4px}[data-v-97196126].list-item__wrapper{list-style:none}.app-content-list-item-star.icon-starred[data-v-97196126]{display:block}[data-v-97196126].icon-important.app-content-list-item-star{position:absolute;top:7px;z-index:1}.app-content-list-item-star.icon-starred[data-v-97196126]{display:inline-block;position:absolute;margin-bottom:32px;margin-left:28px;cursor:pointer;z-index:1}[data-v-97196126] .svg svg{height:16px;width:16px}',"",{version:3,sources:["webpack://./src/components/Envelope.vue"],names:[],mappings:"AA4XA,6CACC,iBAAA,CACA,QAAA,CACA,SAAA,CACA,WAAA,CACA,SAAA,CAIA,uCACA,SAAA,CACA,mCAAA,CAKA,yKACA,mCAAA,CAKA,4DACA,qBAAA,CACA,QAAA,CACA,QAAA,CACA,SAAA,CAEA,oIAEA,UAAA,CAKD,wDACC,oBAAA,CACA,qBAAA,CACA,iBAAA,CACA,SAAA,CACA,QAAA,CACA,UAAA,CAGD,6CACC,gBAAA,CAED,2CACC,6CAAA,CACA,gBAAA,CAED,4BACC,UAAA,CACA,YAAA,CACA,OAAA,CACA,SAAA,CACA,oBAAA,CACA,WAAA,CACA,UAAA,CACA,QAAA,CACA,SAAA,CACA,iBAAA,CACA,SAAA,CAED,uEACC,iBAAA,CAED,yCACC,2CAAA,CACA,kBAAA,CAGD,+DAEC,oBAAA,CACA,uBAAA,CAGD,6BACC,gEAAA,CACA,WAAA,CAGD,kCACC,gEAAA,CACA,WAAA,CAKD,8CACC,eAAA,CAEA,8EACA,eAAA,CACA,eAAA,CAGA,0EACA,iBAAA,CACA,eAAA,CAEA,8FACA,oBAAA,CAEA,uHACA,oBAAA,CAKA,6EACC,iBAAA,CAGF,oCACC,2BAAA,CAED,mCACC,YAAA,CACA,SAAA,CACA,8CAAA,CACA,gBAAA,CACA,gBAAA,CACA,iBAAA,CAED,gCACC,iBAAA,CACA,UAAA,CACA,WAAA,CACA,KAAA,CACA,MAAA,CACA,WAAA,CAED,4BACC,oBAAA,CACA,4BAAA,CACA,uCAAA,CACA,iBAAA,CACA,YAAA,CACA,eAAA,CACA,QAAA,CAED,qCACC,eAAA,CAED,0DACC,aAAA,CAED,4DACC,iBAAA,CACA,OAAA,CACA,SAAA,CAED,0DACC,oBAAA,CACA,iBAAA,CACA,kBAAA,CACA,gBAAA,CACA,cAAA,CACA,SAAA,CAED,2BACC,WAAA,CACA,UAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.mail-message-account-color {\n\tposition: absolute;\n\tleft: 0px;\n\twidth: 2px;\n\theight: 69px;\n\tz-index: 1;\n}\n\n.icon-important {\n\t::v-deep path {\n\tfill: #ffcc00;\n\tstroke: var(--color-main-background);\n\t}\n\t.list-item:hover &,\n\t.list-item:focus &,\n\t.list-item.active & {\n\t::v-deep path {\n\tstroke: var(--color-background-dark);\n\t}\n\t}\n\n\t// In message list, but not the one in the action menu\n\t&.app-content-list-item-star {\n\tbackground-image: none;\n\tleft: 7px;\n\ttop: 13px;\n\topacity: 1;\n\n\t&:hover,\n\t&:focus {\n\topacity: 0.5;\n\t}\n\t}\n}\n\n.app-content-list-item-select-checkbox {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tposition: absolute;\n\tleft: 33px;\n\ttop: 35px;\n\tz-index: 50; // same as icon-starred\n}\n\n.list-item-style:not(.seen) {\n\tfont-weight: bold;\n}\n.list-item-style.selected {\n\tbackground-color: var(--color-background-dark);\n\tfont-weight: bold;\n}\n.icon-junk {\n\topacity: .2;\n\tdisplay: flex;\n\ttop: 6px;\n\tleft: 34px;\n\tbackground-size: 16px;\n\theight: 20px;\n\twidth: 20px;\n\tmargin: 0;\n\tpadding: 0;\n\tposition: absolute;\n\tz-index: 2;\n}\nlist-item-style.draft .app-content-list-item-line-two {\n\tfont-style: italic;\n}\n.list-item-style.active {\n\tbackground-color: var(--color-primary-light);\n\tborder-radius: 16px;\n}\n\n.icon-reply,\n.icon-attachment {\n\tdisplay: inline-block;\n\tvertical-align: text-top;\n}\n\n.icon-reply {\n\t-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=25)';\n\topacity: 0.25;\n}\n\n.icon-attachment {\n\t-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=25)';\n\topacity: 0.25;\n}\n\n\t// Fix layout of messages in list until we move to component\n\n.app-content-list .list-item {\n\tpadding-right: 0;\n\n\t.app-content-list-item-line-two {\n\tpadding-right: 0;\n\tmargin-top: -8px;\n\t}\n\n\t.app-content-list-item-menu {\n\tmargin-right: -2px;\n\tmargin-top: -8px;\n\n\t::v-deep .action-item__menu {\n\tright: 7px !important;\n\n\t.action-item__menu_arrow {\n\tright: 6px !important;\n\t}\n\t}\n\t}\n\n\t.app-content-list-item-details {\n\t\tpadding-right: 7px;\n\t\t}\n}\n::v-deep .list-item__extra {\n\tmargin-left: 41px !important;\n}\n.tag-group__label {\n\tmargin: 0 7px;\n\tz-index: 2;\n\tfont-size: calc(var(--default-font-size) * 0.8);\n\tfont-weight: bold;\n\tpadding-left: 2px;\n\tpadding-right: 2px;\n}\n.tag-group__bg {\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\ttop: 0;\n\tleft: 0;\n\topacity: 15%;\n}\n.tag-group {\n\tdisplay: inline-block;\n\tborder: 1px solid transparent;\n\tborder-radius: var(--border-radius-pill);\n\tposition: relative;\n\tmargin: 0 1px;\n\toverflow: hidden;\n\tleft: 4px;\n}\n::v-deep.list-item__wrapper {\n\tlist-style: none;\n}\n.app-content-list-item-star.icon-starred {\n\tdisplay: block;\n}\n::v-deep.icon-important.app-content-list-item-star {\n\tposition: absolute;\n\ttop: 7px;\n\tz-index: 1;\n}\n.app-content-list-item-star.icon-starred {\n\tdisplay: inline-block;\n\tposition: absolute;\n\tmargin-bottom: 32px;\n\tmargin-left: 28px;\n\tcursor: pointer;\n\tz-index: 1;\n}\n::v-deep .svg svg{\n\theight: 16px;\n\twidth: 16px;\n}\n"],sourceRoot:""}]),n.a=r},1191:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"div[data-v-0c6cc3d8]{position:relative}.load-more[data-v-0c6cc3d8]{text-align:center;margin-top:10px;cursor:pointer;color:var(--color-text-maxcontrast)}.multiselect-header[data-v-0c6cc3d8]{display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:var(--color-main-background-translucent);position:sticky;top:0px;height:48px;z-index:100}#load-more-mail-messages[data-v-0c6cc3d8]{margin:10px auto;padding:10px;margin-top:50px;margin-bottom:50px}#load-more-mail-messages.icon-loading-small[data-v-0c6cc3d8]{padding-left:32px;background-position:9px center}#list-refreshing[data-v-0c6cc3d8]{position:absolute;left:calc(50% - 8px);overflow:hidden;padding:12px;background-color:var(--color-main-background);z-index:1;border-radius:var(--border-radius-pill);border:1px solid var(--color-border);top:-24px;opacity:0;transition-property:top,opacity;transition-duration:.5s;transition-timing-function:ease-in-out}#list-refreshing.refreshing[data-v-0c6cc3d8]{top:4px;opacity:1}.multiselect-header-enter-active[data-v-0c6cc3d8],.multiselect-header-leave-active[data-v-0c6cc3d8],.list-enter-active[data-v-0c6cc3d8],.list-leave-active[data-v-0c6cc3d8]{transition:all var(--animation-slow)}.multiselect-header-enter[data-v-0c6cc3d8],.multiselect-header-leave-to[data-v-0c6cc3d8],.list-enter[data-v-0c6cc3d8],.list-leave-to[data-v-0c6cc3d8]{opacity:0;height:0px;transform:scaleY(0)}#action-label[data-v-0c6cc3d8]{vertical-align:middle}@media only screen and (min-width: 600px){#action-label[data-v-0c6cc3d8]{display:block}}","",{version:3,sources:["webpack://./src/components/EnvelopeList.vue"],names:[],mappings:"AA2XA,qBAEC,iBAAA,CAGD,4BACC,iBAAA,CACA,eAAA,CACA,cAAA,CACA,mCAAA,CAGD,qCACC,YAAA,CACA,kBAAA,CACA,kBAAA,CACA,sBAAA,CACA,yDAAA,CACA,eAAA,CACA,OAAA,CACA,WAAA,CACA,WAAA,CAGD,0CACC,gBAAA,CACA,YAAA,CACA,eAAA,CACA,kBAAA,CAID,6DACC,iBAAA,CACA,8BAAA,CAGD,kCACC,iBAAA,CACA,oBAAA,CACA,eAAA,CACA,YAAA,CACA,6CAAA,CACA,SAAA,CACA,uCAAA,CACA,oCAAA,CACA,SAAA,CACA,SAAA,CACA,+BAAA,CACA,uBAAA,CACA,sCAAA,CAEA,6CACC,OAAA,CACA,SAAA,CAIF,4KAIC,oCAAA,CAGD,sJAIC,SAAA,CACA,UAAA,CACA,mBAAA,CAGD,+BACC,qBAAA,CAED,0CACC,+BACC,aAAA,CAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndiv {\n\t// So we can align the loading spinner in the Priority inbox\n\tposition: relative;\n}\n\n.load-more {\n\ttext-align: center;\n\tmargin-top: 10px;\n\tcursor: pointer;\n\tcolor: var(--color-text-maxcontrast);\n}\n\n.multiselect-header {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground-color: var(--color-main-background-translucent);\n\tposition: sticky;\n\ttop: 0px;\n\theight: 48px;\n\tz-index: 100;\n}\n\n#load-more-mail-messages {\n\tmargin: 10px auto;\n\tpadding: 10px;\n\tmargin-top: 50px;\n\tmargin-bottom: 50px;\n}\n\n/* TODO: put this in core icons.css as general rule for buttons with icons */\n#load-more-mail-messages.icon-loading-small {\n\tpadding-left: 32px;\n\tbackground-position: 9px center;\n}\n\n#list-refreshing {\n\tposition: absolute;\n\tleft: calc(50% - 8px);\n\toverflow: hidden;\n\tpadding: 12px;\n\tbackground-color: var(--color-main-background);\n\tz-index: 1;\n\tborder-radius: var(--border-radius-pill);\n\tborder: 1px solid var(--color-border);\n\ttop: -24px;\n\topacity: 0;\n\ttransition-property: top, opacity;\n\ttransition-duration: 0.5s;\n\ttransition-timing-function: ease-in-out;\n\n\t&.refreshing {\n\t\ttop: 4px;\n\t\topacity: 1;\n\t}\n}\n\n.multiselect-header-enter-active,\n.multiselect-header-leave-active,\n.list-enter-active,\n.list-leave-active {\n\ttransition: all var(--animation-slow);\n}\n\n.multiselect-header-enter,\n.multiselect-header-leave-to,\n.list-enter,\n.list-leave-to {\n\topacity: 0;\n\theight: 0px;\n\ttransform: scaleY(0);\n}\n\n#action-label {\n\tvertical-align: middle;\n}\n@media only screen and (min-width: 600px) {\n\t#action-label {\n\t\tdisplay: block;\n\t}\n}\n"],sourceRoot:""}]),n.a=r},1193:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".fade-enter-active[data-v-5dce5c60],.fade-leave-active[data-v-5dce5c60]{transition:opacity .5s}.fade-enter[data-v-5dce5c60],.fade-leave-to[data-v-5dce5c60]{opacity:0}","",{version:3,sources:["webpack://./src/components/Loading.vue"],names:[],mappings:"AA8CA,wEAEC,sBAAA,CAED,6DAEC,SAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.fade-enter-active,\n.fade-leave-active {\n\ttransition: opacity 0.5s;\n}\n.fade-enter,\n.fade-leave-to {\n\topacity: 0;\n}\n"],sourceRoot:""}]),n.a=r},1194:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"#emptycontent[data-v-4512145e]{margin-top:10px}","",{version:3,sources:["webpack://./src/components/EmptyMailboxSection.vue"],names:[],mappings:"AAYA,+BACC,eAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n#emptycontent {\n\tmargin-top: 10px;\n}\n"],sourceRoot:""}]),n.a=r},1195:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".nameimportant[data-v-73117de6]  #load-more-mail-messages,.namestarred[data-v-73117de6]  #load-more-mail-messages{margin-top:0;margin-bottom:8px}","",{version:3,sources:["webpack://./src/components/Mailbox.vue"],names:[],mappings:"AAofC,kHACC,YAAA,CACA,iBAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// Fix vertical space between sections in priority inbox\n.nameimportant,\n.namestarred {\n\t::v-deep #load-more-mail-messages {\n\t\tmargin-top: 0;\n\t\tmargin-bottom: 8px;\n\t}\n}\n"],sourceRoot:""}]),n.a=r},1245:function(t,n){},1247:function(t,n){},1266:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"\n.new-message-attachments li[data-v-44ae67a0] {\n\tpadding: 10px;\n}\n.new-message-attachments-action[data-v-44ae67a0] {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tpadding: 22px;\n\topacity: 0.5;\n}\n\n/* attachment filenames */\n.new-message-attachment-name[data-v-44ae67a0] {\n\tdisplay: inline-block;\n}\n\n/* Colour the filename with a different color during attachment upload */\n.new-message-attachment-name.upload-ongoing[data-v-44ae67a0] {\n\tcolor: #0082c9;\n}\n\n/* Colour the filename in red if the attachment upload failed */\n.new-message-attachment-name.upload-warning[data-v-44ae67a0] {\n\tcolor: #d2322d;\n}\n\n/* Red ProgressBar for failed attachment uploads */\n.new-message-attachment-name.upload-warning .ui-progressbar-value[data-v-44ae67a0] {\n\tborder: 1px solid #e9322d;\n\tbackground: #e9322d;\n}\n.attachments-upload-progress[data-v-44ae67a0] {\n\tdisplay: flex;\n}\n.attachments-upload-progress > div[data-v-44ae67a0] {\n\tpadding-left: 3px;\n}\n","",{version:3,sources:["webpack://./src/components/ComposerAttachments.vue"],names:[],mappings:";AAuOA;CACA,aAAA;AACA;AAEA;CACA,qBAAA;CACA,sBAAA;CACA,aAAA;CACA,YAAA;AACA;;AAEA,yBAAA;AACA;CACA,qBAAA;AACA;;AAEA,wEAAA;AACA;CACA,cAAA;AACA;;AAEA,+DAAA;AACA;CACA,cAAA;AACA;;AAEA,kDAAA;AACA;CACA,yBAAA;CACA,mBAAA;AACA;AAEA;CACA,aAAA;AACA;AAEA;CACA,iBAAA;AACA",sourcesContent:["\x3c!--\n  - @copyright 2018 Christoph Wurst <christoph@winzerhof-wurst.at>\n  - @copyright 2020 Gary Kim <gary@garykim.dev>\n  -\n  - @author 2018 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @license GNU AGPL version 3 or any later version\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<template>\n\t<div class=\"new-message-attachments\">\n\t\t<ul>\n\t\t\t<li v-for=\"attachment in value\" :key=\"attachment.id\">\n\t\t\t\t<div class=\"new-message-attachment-name\">\n\t\t\t\t\t{{ attachment.displayName }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"new-message-attachments-action svg icon-delete\" @click=\"onDelete(attachment)\" />\n\t\t\t</li>\n\t\t\t<li v-if=\"uploading\" class=\"attachments-upload-progress\">\n\t\t\t\t<div :class=\"{'icon-loading-small': uploading}\" />\n\t\t\t\t<div>{{ uploading ? t('mail', 'Uploading {percent}% …', {percent: uploadProgress}) : '' }}</div>\n\t\t\t</li>\n\t\t</ul>\n\n\t\t<input ref=\"localAttachments\"\n\t\t\ttype=\"file\"\n\t\t\tmultiple\n\t\t\tstyle=\"display: none;\"\n\t\t\t@change=\"onLocalAttachmentSelected\">\n\t</div>\n</template>\n\n<script>\nimport map from 'lodash/fp/map'\nimport trimStart from 'lodash/fp/trimCharsStart'\nimport { getRequestToken } from '@nextcloud/auth'\nimport { formatFileSize } from '@nextcloud/files'\nimport prop from 'lodash/fp/prop'\nimport { getFilePickerBuilder, showWarning } from '@nextcloud/dialogs'\nimport sum from 'lodash/fp/sum'\nimport sumBy from 'lodash/fp/sumBy'\nimport { translate as t, translatePlural as n } from '@nextcloud/l10n'\n\nimport Vue from 'vue'\n\nimport logger from '../logger'\nimport { getFileSize } from '../service/FileService'\nimport { shareFile } from '../service/FileSharingService'\nimport { uploadLocalAttachment } from '../service/AttachmentService'\n\nexport default {\n\tname: 'ComposerAttachments',\n\tprops: {\n\t\tvalue: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tbus: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tuploadSizeLimit: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tuploading: false,\n\t\t\tuploads: {},\n\t\t}\n\t},\n\tcomputed: {\n\t\tuploadProgress() {\n\t\t\tlet uploaded = 0\n\t\t\tlet total = 0\n\t\t\tfor (const id in this.uploads) {\n\t\t\t\tuploaded += this.uploads[id].uploaded\n\t\t\t\ttotal += this.uploads[id].total\n\t\t\t}\n\t\t\treturn ((uploaded / total) * 100).toFixed(1)\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.bus.$on('onAddLocalAttachment', this.onAddLocalAttachment)\n\t\tthis.bus.$on('onAddCloudAttachment', this.onAddCloudAttachment)\n\t\tthis.bus.$on('onAddCloudAttachmentLink', this.onAddCloudAttachmentLink)\n\t},\n\tmethods: {\n\t\tonAddLocalAttachment() {\n\t\t\tthis.$refs.localAttachments.click()\n\t\t},\n\t\temitNewAttachments(attachments) {\n\t\t\tthis.$emit('input', this.value.concat(attachments))\n\t\t},\n\t\ttotalSizeOfUpload() {\n\t\t\treturn Object.values(this.value).reduce((acc, upload) => {\n\t\t\t\tif (!upload.type === 'local') {\n\t\t\t\t\t// Ignore link shares\n\t\t\t\t\treturn acc\n\t\t\t\t}\n\n\t\t\t\treturn acc + upload.size\n\t\t\t}, 0)\n\t\t},\n\t\tonLocalAttachmentSelected(e) {\n\t\t\tthis.uploading = true\n\n\t\t\tVue.set(this, 'uploads', {})\n\n\t\t\tconst toUpload = sumBy(prop('size'), Object.values(e.target.files))\n\t\t\tconst newTotal = toUpload + this.totalSizeOfUpload()\n\t\t\tlogger.debug('checking upload size limit', {\n\t\t\t\texistingUploads: this.totalSizeOfUpload(),\n\t\t\t\ttoUpload,\n\t\t\t\tlimit: this.uploadSizeLimit,\n\t\t\t\tnewTotal,\n\t\t\t})\n\t\t\tif (this.uploadSizeLimit && newTotal > this.uploadSizeLimit) {\n\t\t\t\tthis.showAttachmentFileSizeWarning(e.target.files.length)\n\n\t\t\t\tthis.uploading = false\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst progress = (id) => (prog, uploaded) => {\n\t\t\t\tthis.uploads[id].uploaded = uploaded\n\t\t\t}\n\n\t\t\tconst promises = map((file) => {\n\t\t\t\tVue.set(this.uploads, file.name, {\n\t\t\t\t\ttotal: file.size,\n\t\t\t\t\tuploaded: 0,\n\t\t\t\t})\n\n\t\t\t\treturn uploadLocalAttachment(file, progress(file.name)).then(({ file, id }) => {\n\t\t\t\t\tlogger.info('uploaded')\n\t\t\t\t\tthis.emitNewAttachments([{\n\t\t\t\t\t\tfileName: file.name,\n\t\t\t\t\t\tdisplayName: trimStart('/', file.name),\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tsize: file.size,\n\t\t\t\t\t\ttype: 'local',\n\t\t\t\t\t}])\n\t\t\t\t})\n\n\t\t\t}, e.target.files)\n\n\t\t\tconst done = Promise.all(promises)\n\t\t\t\t.catch((error) => logger.error('could not upload all attachments', { error }))\n\t\t\t\t.then(() => (this.uploading = false))\n\n\t\t\tthis.$emit('upload', done)\n\n\t\t\treturn done\n\t\t},\n\t\tasync onAddCloudAttachment() {\n\t\t\tconst picker = getFilePickerBuilder(t('mail', 'Choose a file to add as attachment')).setMultiSelect(true).build()\n\n\t\t\ttry {\n\t\t\t\tconst paths = await picker.pick(t('mail', 'Choose a file to add as attachment'))\n\t\t\t\tconst fileSizes = await Promise.all(paths.map(getFileSize))\n\t\t\t\tconst newTotal = sum(fileSizes) + this.totalSizeOfUpload()\n\n\t\t\t\tif (this.uploadSizeLimit && newTotal > this.uploadSizeLimit) {\n\t\t\t\t\tthis.showAttachmentFileSizeWarning(paths.length)\n\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.emitNewAttachments(paths.map(function(name) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfileName: name,\n\t\t\t\t\t\tdisplayName: trimStart('/', name),\n\t\t\t\t\t\ttype: 'cloud',\n\t\t\t\t\t}\n\t\t\t\t}))\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('could not choose a file as attachment', { error })\n\t\t\t}\n\t\t},\n\t\tasync onAddCloudAttachmentLink() {\n\t\t\tconst picker = getFilePickerBuilder(t('mail', 'Choose a file to share as a link')).build()\n\n\t\t\ttry {\n\t\t\t\tconst path = await picker.pick(t('mail', 'Choose a file to share as a link'))\n\t\t\t\tconst url = await shareFile(path, getRequestToken())\n\n\t\t\t\tthis.appendToBodyAtCursor(`<a href=\"${url}\">${url}</a>`)\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('could not choose a file as attachment link', { error })\n\t\t\t}\n\t\t},\n\t\tshowAttachmentFileSizeWarning(num) {\n\t\t\tshowWarning(n(\n\t\t\t\t'mail',\n\t\t\t\t'The attachment exceed the allowed attachments size of {size}. Please share the file via link instead.',\n\t\t\t\t'The attachments exceed the allowed attachments size of {size}. Please share the files via link instead.',\n\t\t\t\tnum,\n\t\t\t\t{\n\t\t\t\t\tsize: formatFileSize(this.uploadSizeLimit),\n\t\t\t\t}\n\t\t\t))\n\t\t},\n\t\tonDelete(attachment) {\n\t\t\tthis.$emit(\n\t\t\t\t'input',\n\t\t\t\tthis.value.filter((a) => a !== attachment)\n\t\t\t)\n\t\t},\n\t\tappendToBodyAtCursor(toAppend) {\n\t\t\tthis.bus.$emit('appendToBodyAtCursor', toAppend)\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.new-message-attachments li {\n\tpadding: 10px;\n}\n\n.new-message-attachments-action {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tpadding: 22px;\n\topacity: 0.5;\n}\n\n/* attachment filenames */\n.new-message-attachment-name {\n\tdisplay: inline-block;\n}\n\n/* Colour the filename with a different color during attachment upload */\n.new-message-attachment-name.upload-ongoing {\n\tcolor: #0082c9;\n}\n\n/* Colour the filename in red if the attachment upload failed */\n.new-message-attachment-name.upload-warning {\n\tcolor: #d2322d;\n}\n\n/* Red ProgressBar for failed attachment uploads */\n.new-message-attachment-name.upload-warning .ui-progressbar-value {\n\tborder: 1px solid #e9322d;\n\tbackground: #e9322d;\n}\n\n.attachments-upload-progress {\n\tdisplay: flex;\n}\n\n.attachments-upload-progress > div {\n\tpadding-left: 3px;\n}\n</style>\n"],sourceRoot:""}]),n.a=r},1305:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"\n#mailvelope-composer[data-v-1320c887] {\n\twidth: 100%;\n\theight: 450px;\n}\n","",{version:3,sources:["webpack://./src/components/MailvelopeEditor.vue"],names:[],mappings:";AA6EA;CACA,WAAA;CACA,aAAA;AACA",sourcesContent:["\x3c!--\n  - @copyright 2020 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @author 2020 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @license GNU AGPL version 3 or any later version\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<template>\n\t<div id=\"mailvelope-composer\" />\n</template>\n\n<script>\nimport logger from '../logger'\nimport { isPgpgMessage } from '../crypto/pgp'\n\nexport default {\n\tname: 'MailvelopeEditor',\n\tprops: {\n\t\tvalue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\trecipients: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tquotedText: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: () => undefined,\n\t\t},\n\t\tisReplyOrForward: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\teditor: undefined,\n\t\t}\n\t},\n\tasync mounted() {\n\t\tconst isEncrypted = this.quotedText ? isPgpgMessage(this.quotedText) : false\n\t\tconst quotedMail = this.isReplyOrForward ? this.quotedText?.value : undefined\n\n\t\tthis.editor = await window.mailvelope.createEditorContainer('#mailvelope-composer', undefined, {\n\t\t\tquotedMail: isEncrypted ? quotedMail : undefined,\n\t\t})\n\t},\n\tmethods: {\n\t\tasync pull() {\n\t\t\tconst recipients = this.recipients.map((r) => r.email)\n\t\t\tlogger.info('encrypting message', { recipients })\n\t\t\tconst armored = await this.editor.encrypt(recipients)\n\t\t\tlogger.info('message encryted', { armored })\n\n\t\t\tthis.$emit('input', armored)\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n#mailvelope-composer {\n\twidth: 100%;\n\theight: 450px;\n}\n</style>\n"],sourceRoot:""}]),n.a=r},1306:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".message-composer[data-v-ee7216e4]{margin:0;z-index:100}.composer-actions[data-v-ee7216e4]{display:flex;flex-direction:row;align-items:flex-end;justify-content:space-between;position:sticky;bottom:0;padding:12px;background:linear-gradient(rgba(255, 255, 255, 0), var(--color-main-background-translucent) 50%)}.composer-actions-right[data-v-ee7216e4]{display:flex;align-items:center}.composer-fields[data-v-ee7216e4]{display:flex;align-items:center;border-top:1px solid var(--color-border)}.composer-fields.mail-account[data-v-ee7216e4]{border-top:none}.composer-fields.mail-account>.multiselect[data-v-ee7216e4]{max-width:none;min-height:auto}.composer-fields .multiselect[data-v-ee7216e4],.composer-fields input[data-v-ee7216e4],.composer-fields TextEditor[data-v-ee7216e4]{flex-grow:1;max-width:none;border:none;border-radius:0}.composer-fields .multiselect[data-v-ee7216e4]{margin-right:12px}.subject[data-v-ee7216e4]{font-size:20px;font-weight:bold;margin:0;padding:24px 12px}.warning-box[data-v-ee7216e4]{padding:5px 12px;border-radius:0}.message-body[data-v-ee7216e4]{min-height:300px;width:100%;margin:0;padding:12px;border:none !important;outline:none !important;box-shadow:none !important}#draft-status[data-v-ee7216e4]{padding:5px;opacity:.5;font-size:small}.from-label[data-v-ee7216e4],.to-label[data-v-ee7216e4],.copy-toggle[data-v-ee7216e4],.cc-label[data-v-ee7216e4],.bcc-label[data-v-ee7216e4]{padding:12px;cursor:text;color:var(--color-text-maxcontrast);width:100px;text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.bcc-label[data-v-ee7216e4]{top:initial;bottom:0}.copy-toggle[data-v-ee7216e4]{cursor:pointer;width:initial}.copy-toggle[data-v-ee7216e4]:hover,.copy-toggle[data-v-ee7216e4]:focus{color:var(--color-main-text)}.reply[data-v-ee7216e4]{min-height:100px}.send[data-v-ee7216e4]{padding:12px 18px 13px 36px;background-position:12px center;margin-left:4px}[data-v-ee7216e4] .multiselect .multiselect__tags{border:none !important}.submit-message.send.primary.icon-confirm-white[data-v-ee7216e4]{color:var(--color-main-background)}","",{version:3,sources:["webpack://./src/components/Composer.vue"],names:[],mappings:"AAszBA,mCACC,QAAA,CACA,WAAA,CAGD,mCACC,YAAA,CACA,kBAAA,CACA,oBAAA,CACA,6BAAA,CACA,eAAA,CACA,QAAA,CACA,YAAA,CACA,gGAAA,CAGD,yCACC,YAAA,CACA,kBAAA,CAGD,kCACC,YAAA,CACA,kBAAA,CACA,wCAAA,CAEA,+CACC,eAAA,CAEA,4DACC,cAAA,CACA,eAAA,CAIF,oIAGC,WAAA,CACA,cAAA,CACA,WAAA,CACA,eAAA,CAGD,+CACC,iBAAA,CAIF,0BACC,cAAA,CACA,gBAAA,CACA,QAAA,CACA,iBAAA,CAGD,8BACC,gBAAA,CACA,eAAA,CAGD,+BACC,gBAAA,CACA,UAAA,CACA,QAAA,CACA,YAAA,CACA,sBAAA,CACA,uBAAA,CACA,0BAAA,CAGD,+BACC,WAAA,CACA,UAAA,CACA,eAAA,CAGD,6IAKC,YAAA,CACA,WAAA,CACA,mCAAA,CACA,WAAA,CACA,gBAAA,CACA,kBAAA,CACA,eAAA,CACA,sBAAA,CAGD,4BACC,WAAA,CACA,QAAA,CAGD,8BACC,cAAA,CACA,aAAA,CAEA,wEAEC,4BAAA,CAIF,wBACC,gBAAA,CAGD,uBACC,2BAAA,CACA,+BAAA,CACA,eAAA,CAED,kDACC,sBAAA,CAED,iEACC,kCAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.message-composer {\n\tmargin: 0;\n\tz-index: 100;\n}\n\n.composer-actions {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: flex-end;\n\tjustify-content: space-between;\n\tposition: sticky;\n\tbottom: 0;\n\tpadding: 12px;\n\tbackground: linear-gradient(rgba(255, 255, 255, 0), var(--color-main-background-translucent) 50%);\n}\n\n.composer-actions-right {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.composer-fields {\n\tdisplay: flex;\n\talign-items: center;\n\tborder-top: 1px solid var(--color-border);\n\n\t&.mail-account {\n\t\tborder-top: none;\n\n\t\t& > .multiselect {\n\t\t\tmax-width: none;\n\t\t\tmin-height: auto;\n\t\t}\n\t}\n\n\t.multiselect,\n\tinput,\n\tTextEditor {\n\t\tflex-grow: 1;\n\t\tmax-width: none;\n\t\tborder: none;\n\t\tborder-radius: 0;\n\t}\n\n\t.multiselect {\n\t\tmargin-right: 12px;\n\t}\n}\n\n.subject {\n\tfont-size: 20px;\n\tfont-weight: bold;\n\tmargin: 0;\n\tpadding: 24px 12px;\n}\n\n.warning-box {\n\tpadding: 5px 12px;\n\tborder-radius: 0;\n}\n\n.message-body {\n\tmin-height: 300px;\n\twidth: 100%;\n\tmargin: 0;\n\tpadding: 12px;\n\tborder: none !important;\n\toutline: none !important;\n\tbox-shadow: none !important;\n}\n\n#draft-status {\n\tpadding: 5px;\n\topacity: 0.5;\n\tfont-size: small;\n}\n\n.from-label,\n.to-label,\n.copy-toggle,\n.cc-label,\n.bcc-label {\n\tpadding: 12px;\n\tcursor: text;\n\tcolor: var(--color-text-maxcontrast);\n\twidth: 100px;\n\ttext-align: right;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n\n.bcc-label {\n\ttop: initial;\n\tbottom: 0;\n}\n\n.copy-toggle {\n\tcursor: pointer;\n\twidth: initial;\n\n\t&:hover,\n\t&:focus {\n\t\tcolor: var(--color-main-text);\n\t}\n}\n\n.reply {\n\tmin-height: 100px;\n}\n\n.send {\n\tpadding: 12px 18px 13px 36px;\n\tbackground-position: 12px center;\n\tmargin-left: 4px;\n}\n::v-deep .multiselect .multiselect__tags {\n\tborder: none !important;\n}\n.submit-message.send.primary.icon-confirm-white {\n\tcolor: var(--color-main-background);\n}\n"],sourceRoot:""}]),n.a=r},1307:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"\n.app-content-details[data-v-0f812b2d] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: center;\n}\n.icon[data-v-0f812b2d] {\n\theight: 64px;\n\twidth: 64px;\n\tmargin: 0 auto 15px;\n\tbackground-size: 64px;\n\topacity: 0.4;\n}\nh2[data-v-0f812b2d],\np[data-v-0f812b2d] {\n\ttext-align: center;\n}\n","",{version:3,sources:["webpack://./src/components/NoMessageSelected.vue"],names:[],mappings:";AAyCA;CACA,aAAA;CACA,sBAAA;CACA,uBAAA;AACA;AAEA;CACA,YAAA;CACA,WAAA;CACA,mBAAA;CACA,qBAAA;CACA,YAAA;AACA;AAEA;;CAEA,kBAAA;AACA",sourcesContent:["\x3c!--\n  - @copyright 2019 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @author 2019 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @license GNU AGPL version 3 or any later version\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<template>\n\t<AppContentDetails>\n\t\t<div class=\"icon icon-mail\" />\n\t\t<h2>{{ t('mail', 'No message selected') }}</h2>\n\t\t<p />\n\t</AppContentDetails>\n</template>\n\n<script>\nimport AppContentDetails from '@nextcloud/vue/dist/Components/AppContentDetails'\n\nexport default {\n\tname: 'NoMessageSelected',\n\tcomponents: {\n\t\tAppContentDetails,\n\t},\n}\n<\/script>\n\n<style scoped>\n.app-content-details {\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: center;\n}\n\n.icon {\n\theight: 64px;\n\twidth: 64px;\n\tmargin: 0 auto 15px;\n\tbackground-size: 64px;\n\topacity: 0.4;\n}\n\nh2,\np {\n\ttext-align: center;\n}\n</style>\n"],sourceRoot:""}]),n.a=r},1309:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".user-bubble__title[data-v-7f075410]{max-width:30vw}.user-bubble-email[data-v-7f075410]{margin:10px}.contact-popover[data-v-7f075410]{display:inline-block}.contact-wrapper[data-v-7f075410]{padding:10px;min-width:300px}.contact-wrapper a[data-v-7f075410]{opacity:.7}.contact-wrapper a[data-v-7f075410]:hover{opacity:1}.contact-input-wrapper[data-v-7f075410]{margin-top:10px;margin-bottom:10px}.contact-input-wrapper input[data-v-7f075410],.contact-input-wrapper .multiselect[data-v-7f075410]{width:100%}.icon-user[data-v-7f075410],.icon-reply[data-v-7f075410],.icon-checkmark[data-v-7f075410],.icon-close[data-v-7f075410],.icon-add[data-v-7f075410]{height:44px;min-width:44px;margin:0;padding:9px 18px 10px 32px}@media only screen and (min-width: 600px){.icon-user[data-v-7f075410],.icon-reply[data-v-7f075410],.icon-checkmark[data-v-7f075410],.icon-close[data-v-7f075410],.icon-add[data-v-7f075410]{background-position:12px center}}.icon-add[data-v-7f075410]{display:revert;vertical-align:revert}.contact-existing[data-v-7f075410]{margin-bottom:10px;font-size:small}.contact-existing .icon-details[data-v-7f075410]{padding-left:34px;background-position:10px center;text-align:left}","",{version:3,sources:["webpack://./src/components/RecipientBubble.vue"],names:[],mappings:"AAsNA,qCACC,cAAA,CAED,oCACC,WAAA,CAGD,kCACC,oBAAA,CAED,kCACC,YAAA,CACA,eAAA,CAEA,oCACC,UAAA,CAED,0CACC,SAAA,CAGF,wCACC,eAAA,CACG,kBAAA,CACH,mGAEC,UAAA,CAGF,kJAKC,WAAA,CACA,cAAA,CACA,QAAA,CACA,0BAAA,CAED,0CACC,kJAKC,+BAAA,CAAA,CAGF,2BACC,cAAA,CACG,qBAAA,CAEJ,mCACC,kBAAA,CACA,eAAA,CACA,iDACC,iBAAA,CACA,+BAAA,CACA,eAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.user-bubble__title {\n\tmax-width: 30vw;\n}\n.user-bubble-email {\n\tmargin: 10px;\n}\n\n.contact-popover {\n\tdisplay: inline-block;\n}\n.contact-wrapper {\n\tpadding:10px;\n\tmin-width: 300px;\n\n\ta {\n\t\topacity: 0.7;\n\t}\n\ta:hover {\n\t\topacity: 1;\n\t}\n}\n.contact-input-wrapper {\n\tmargin-top: 10px;\n    margin-bottom: 10px;\n\tinput,\n\t.multiselect {\n\t\twidth: 100%;\n\t}\n}\n.icon-user,\n.icon-reply,\n.icon-checkmark,\n.icon-close,\n.icon-add {\n\theight: 44px;\n\tmin-width: 44px;\n\tmargin: 0;\n\tpadding: 9px 18px 10px 32px;\n}\n@media only screen and (min-width: 600px) {\n\t.icon-user,\n\t.icon-reply,\n\t.icon-checkmark,\n\t.icon-close,\n\t.icon-add {\n\t\tbackground-position: 12px center;\n\t}\n}\n.icon-add {\n\tdisplay: revert;\n    vertical-align: revert;\n}\n.contact-existing {\n\tmargin-bottom: 10px;\n\tfont-size: small;\n\t.icon-details {\n\t\tpadding-left: 34px;\n\t\tbackground-position: 10px center;\n\t\ttext-align: left;\n\t}\n}\n\n"],sourceRoot:""}]),n.a=r},1312:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"\n.reservation[data-v-b2f6d4c0] {\n\tdisplay: flex;\n\tflex-direction: row;\n\tmargin: 30px 38px;\n\tborder: 1px solid var(--color-border);\n\tborder-radius: var(--border-radius);\n\tpadding: 20px;\n\talign-items: center;\n}\n.event[data-v-b2f6d4c0] {\n\tflex-grow: 1;\n}\n.event-name[data-v-b2f6d4c0] {\n\tfont-size: larger;\n\tfont-weight: bold;\n}\n","",{version:3,sources:["webpack://./src/components/itinerary/EventReservation.vue"],names:[],mappings:";AAsJA;CACA,aAAA;CACA,mBAAA;CACA,iBAAA;CACA,qCAAA;CACA,mCAAA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;CACA,YAAA;AACA;AAEA;CACA,iBAAA;CACA,iBAAA;AACA",sourcesContent:["\x3c!--\n  - @copyright 2019 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @author 2019 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @license GNU AGPL version 3 or any later version\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<template>\n\t<div class=\"reservation\">\n\t\t<div class=\"event\">\n\t\t\t<div class=\"event-name\">\n\t\t\t\t{{ eventName }}\n\t\t\t</div>\n\t\t\t<div v-if=\"location\" class=\"venue\">\n\t\t\t\t{{ location }}\n\t\t\t</div>\n\t\t\t<div v-if=\"date\">\n\t\t\t\t{{ date }}\n\t\t\t</div>\n\t\t\t<div v-if=\"time\">\n\t\t\t\t{{ time }}\n\t\t\t</div>\n\t\t</div>\n\t\t<CalendarImport v-if=\"canImport\" :calendars=\"calendars\" :handler=\"handleImport\" />\n\t</div>\n</template>\n\n<script>\nimport ical from 'ical.js'\nimport md5 from 'md5'\nimport moment from '@nextcloud/moment'\nimport { showError, showSuccess } from '@nextcloud/dialogs'\n\nimport CalendarImport from './CalendarImport'\nimport { importCalendarEvent } from '../../service/DAVService'\nimport logger from '../../logger'\n\nexport default {\n\tname: 'EventReservation',\n\tcomponents: { CalendarImport },\n\tprops: {\n\t\tdata: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcalendars: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\teventName() {\n\t\t\treturn this.data.reservationFor.name\n\t\t},\n\t\ttime() {\n\t\t\tif (!('startDate' in this.data.reservationFor)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn moment(this.data.reservationFor.startDate).format('LT')\n\t\t},\n\t\tdate() {\n\t\t\tif (!('startDate' in this.data.reservationFor)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn moment(this.data.reservationFor.startDate).format('L')\n\t\t},\n\t\tlocation() {\n\t\t\tif (!('location' in this.data.reservationFor) || !('name' in this.data.reservationFor.location)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn this.data.reservationFor.location.name\n\t\t},\n\t\tcanImport() {\n\t\t\treturn 'startDate' in this.data.reservationFor\n\t\t},\n\t},\n\tmethods: {\n\t\tgetEndDateTime(event) {\n\t\t\tif ('endDate' in this.data.reservationFor) {\n\t\t\t\treturn moment(this.data.reservationFor.endDate).format()\n\t\t\t} else {\n\t\t\t\t// Assume it's 2h and user will adjust if necessary\n\t\t\t\t// TODO: handle 'duration' https://schema.org/Event\n\t\t\t\treturn moment('2019-10-22T12:00:00Z').add(2, 'hours').format()\n\t\t\t}\n\t\t},\n\t\thandleImport(calendar) {\n\t\t\tconst event = new ical.Component('VEVENT')\n\t\t\tevent.updatePropertyWithValue('SUMMARY', this.eventName)\n\n\t\t\tconst start = moment(this.data.reservationFor.startDate).format()\n\t\t\tevent.updatePropertyWithValue('DTSTART', ical.Time.fromDateTimeString(start))\n\t\t\tevent.updatePropertyWithValue(\n\t\t\t\t'DTEND',\n\t\t\t\tical.Time.fromDateTimeString(this.getEndDateTime(this.data.reservationFor))\n\t\t\t)\n\n\t\t\tif ('location' in this.data.reservationFor) {\n\t\t\t\tevent.updatePropertyWithValue('LOCATION', this.data.reservationFor.location.name)\n\t\t\t\tif ('geo' in this.data.reservationFor.location) {\n\t\t\t\t\t// https://www.kanzaki.com/docs/ical/geo.html\n\t\t\t\t\tevent.updatePropertyWithValue(\n\t\t\t\t\t\t'GEO',\n\t\t\t\t\t\t`${this.data.reservationFor.location.geo.latitude};${this.data.reservationFor.location.geo.longitude}`\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// TODO: read version from package.json\n\t\t\tevent.updatePropertyWithValue('PRODID', 'Nextcloud Mail')\n\n\t\t\t// TODO: is this free of collisions? the bug reports will tell us!\n\t\t\tevent.updatePropertyWithValue('UID', md5(this.messageId + this.eventName))\n\n\t\t\tconst cal = new ical.Component('VCALENDAR')\n\t\t\tcal.addSubcomponent(event)\n\t\t\tlogger.debug('generated calendar event from event reservation data', { ical: cal.toString() })\n\t\t\treturn importCalendarEvent(calendar.url)(cal.toString())\n\t\t\t\t.then(() => {\n\t\t\t\t\tlogger.debug('event successfully imported')\n\t\t\t\t\tshowSuccess(t('mail', 'Event imported into {calendar}', { calendar: calendar.displayname }))\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlogger.error('Could not import event', { error })\n\t\t\t\t\tshowError(t('mail', 'Could not create event'))\n\t\t\t\t})\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.reservation {\n\tdisplay: flex;\n\tflex-direction: row;\n\tmargin: 30px 38px;\n\tborder: 1px solid var(--color-border);\n\tborder-radius: var(--border-radius);\n\tpadding: 20px;\n\talign-items: center;\n}\n\n.event {\n\tflex-grow: 1;\n}\n\n.event-name {\n\tfont-size: larger;\n\tfont-weight: bold;\n}\n</style>\n"],sourceRoot:""}]),n.a=r},1313:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"\n.reservation[data-v-670645fc] {\n\tdisplay: flex;\n\tflex-direction: row;\n\tmargin: 30px 38px;\n\tborder: 1px solid var(--color-border);\n\tborder-radius: var(--border-radius);\n\tpadding: 20px;\n\talign-items: center;\n}\n.departure[data-v-670645fc],\n.arrival[data-v-670645fc] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n}\n.departure[data-v-670645fc],\n.arrival[data-v-670645fc],\n.connection[data-v-670645fc] {\n\tjustify-content: center;\n}\n.iata[data-v-670645fc] {\n\tfont-size: larger;\n\tfont-weight: bold;\n}\n.airport[data-v-670645fc] {\n\tfont-size: large;\n}\n.departure[data-v-670645fc] {\n\ttext-align: right;\n}\n.connection[data-v-670645fc] {\n\ttext-align: center;\n\tpadding: 0 40px;\n}\n","",{version:3,sources:["webpack://./src/components/itinerary/FlightReservation.vue"],names:[],mappings:";AA6JA;CACA,aAAA;CACA,mBAAA;CACA,iBAAA;CACA,qCAAA;CACA,mCAAA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;;CAEA,aAAA;CACA,sBAAA;CACA,YAAA;AACA;AAEA;;;CAGA,uBAAA;AACA;AAEA;CACA,iBAAA;CACA,iBAAA;AACA;AAEA;CACA,gBAAA;AACA;AAEA;CACA,iBAAA;AACA;AAEA;CACA,kBAAA;CACA,eAAA;AACA",sourcesContent:["<template>\n\t<div class=\"reservation\">\n\t\t<div class=\"departure\">\n\t\t\t<div class=\"iata\">\n\t\t\t\t{{ data.reservationFor.departureAirport.iataCode }}\n\t\t\t</div>\n\t\t\t<div class=\"airport\">\n\t\t\t\t{{ data.reservationFor.departureAirport.name }}\n\t\t\t</div>\n\t\t\t<div v-if=\"departureDate\">\n\t\t\t\t{{ departureDate }}\n\t\t\t</div>\n\t\t\t<div v-if=\"departureTime\">\n\t\t\t\t{{ departureTime }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"connection\">\n\t\t\t<div><AirplaneIcon :title=\"t('mail', 'Airplane')\" /></div>\n\t\t\t<div>{{ flightNumber }}</div>\n\t\t\t<div v-if=\"reservation\">\n\t\t\t\t{{ t('mail', 'Reservation {id}', {id: reservation}) }}\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t<ArrowIcon decorative />\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"arrival\">\n\t\t\t<div class=\"iata\">\n\t\t\t\t{{ data.reservationFor.arrivalAirport.iataCode }}\n\t\t\t</div>\n\t\t\t<div class=\"airport\">\n\t\t\t\t{{ data.reservationFor.arrivalAirport.name }}\n\t\t\t</div>\n\t\t\t<div v-if=\"arrivalDate\">\n\t\t\t\t{{ arrivalDate }}\n\t\t\t</div>\n\t\t\t<div v-if=\"arrivalTime\">\n\t\t\t\t{{ arrivalTime }}\n\t\t\t</div>\n\t\t</div>\n\t\t<CalendarImport :calendars=\"calendars\" :handler=\"handleImport\" />\n\t</div>\n</template>\n\n<script>\nimport AirplaneIcon from 'vue-material-design-icons/Airplane'\nimport ArrowIcon from 'vue-material-design-icons/ArrowRight'\nimport ical from 'ical.js'\nimport md5 from 'md5'\nimport moment from '@nextcloud/moment'\nimport { showError, showSuccess } from '@nextcloud/dialogs'\n\nimport CalendarImport from './CalendarImport'\nimport { importCalendarEvent } from '../../service/DAVService'\nimport logger from '../../logger'\n\nexport default {\n\tname: 'FlightReservation',\n\tcomponents: {\n\t\tAirplaneIcon,\n\t\tArrowIcon,\n\t\tCalendarImport,\n\t},\n\tprops: {\n\t\tdata: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcalendars: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tdepartureTime() {\n\t\t\tif (!('departureTime' in this.data.reservationFor)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn moment(this.data.reservationFor.departureTime['@value']).format('LT')\n\t\t},\n\t\tdepartureDate() {\n\t\t\tif (!('departureTime' in this.data.reservationFor)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn moment(this.data.reservationFor.departureTime['@value']).format('L')\n\t\t},\n\t\tarrivalTime() {\n\t\t\tif (!('arrivalTime' in this.data.reservationFor)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn moment(this.data.reservationFor.arrivalTime['@value']).format('LT')\n\t\t},\n\t\tarrivalDate() {\n\t\t\tif (!('arrivalTime' in this.data.reservationFor)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn moment(this.data.reservationFor.arrivalTime['@value']).format('L')\n\t\t},\n\t\tflightNumber() {\n\t\t\treturn this.data.reservationFor.airline.iataCode + this.data.reservationFor.flightNumber\n\t\t},\n\t\treservation() {\n\t\t\tif (!('reservationNumber' in this.data)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn this.data.reservationNumber\n\t\t},\n\t\tcanImport() {\n\t\t\treturn 'departureTime' in this.data.reservationFor && 'arrivalTime' in this.data.reservationFor\n\t\t},\n\t},\n\tmethods: {\n\t\thandleImport(calendar) {\n\t\t\tconst event = new ical.Component('VEVENT')\n\t\t\tevent.updatePropertyWithValue(\n\t\t\t\t'SUMMARY',\n\t\t\t\tt('mail', 'Flight {flightNr} from {depAirport} to {arrAirport}', {\n\t\t\t\t\tflightNr: this.flightNumber,\n\t\t\t\t\tdepAirport: this.data.reservationFor.departureAirport.iataCode,\n\t\t\t\t\tarrAirport: this.data.reservationFor.arrivalAirport.iataCode,\n\t\t\t\t})\n\t\t\t)\n\n\t\t\tconst depart = moment(this.data.reservationFor.departureTime['@value']).format()\n\t\t\tevent.updatePropertyWithValue('DTSTART', ical.Time.fromDateTimeString(depart))\n\t\t\tconst arrive = moment(this.data.reservationFor.arrivalTime['@value']).format()\n\t\t\tevent.updatePropertyWithValue('DTEND', ical.Time.fromDateTimeString(arrive))\n\n\t\t\t// TODO: read version from package.json\n\t\t\tevent.updatePropertyWithValue('PRODID', 'Nextcloud Mail')\n\n\t\t\t// TODO: is this free of collisions? the bug reports will tell us!\n\t\t\tevent.updatePropertyWithValue('UID', md5(this.messageId + this.flightNumber))\n\n\t\t\tconst cal = new ical.Component('VCALENDAR')\n\t\t\tcal.addSubcomponent(event)\n\t\t\tlogger.debug('generated calendar event from flight reservation data', { ical: cal.toString() })\n\n\t\t\treturn importCalendarEvent(calendar.url)(cal.toString())\n\t\t\t\t.then(() => {\n\t\t\t\t\tlogger.debug('event successfully imported')\n\t\t\t\t\tshowSuccess(t('mail', 'Event imported into {calendar}', { calendar: calendar.displayname }))\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlogger.error('Could not import event', { error })\n\t\t\t\t\tshowError(t('mail', 'Could not create event'))\n\t\t\t\t})\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.reservation {\n\tdisplay: flex;\n\tflex-direction: row;\n\tmargin: 30px 38px;\n\tborder: 1px solid var(--color-border);\n\tborder-radius: var(--border-radius);\n\tpadding: 20px;\n\talign-items: center;\n}\n\n.departure,\n.arrival {\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n}\n\n.departure,\n.arrival,\n.connection {\n\tjustify-content: center;\n}\n\n.iata {\n\tfont-size: larger;\n\tfont-weight: bold;\n}\n\n.airport {\n\tfont-size: large;\n}\n\n.departure {\n\ttext-align: right;\n}\n\n.connection {\n\ttext-align: center;\n\tpadding: 0 40px;\n}\n</style>\n"],sourceRoot:""}]),n.a=r},1314:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"\n.reservation[data-v-1eebd676] {\n\tdisplay: flex;\n\tflex-direction: row;\n\tmargin: 30px 38px;\n\tborder: 1px solid var(--color-border);\n\tborder-radius: var(--border-radius);\n\tpadding: 20px;\n\talign-items: center;\n}\n.departure[data-v-1eebd676],\n.arrival[data-v-1eebd676] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n}\n.departure[data-v-1eebd676],\n.arrival[data-v-1eebd676],\n.connection[data-v-1eebd676] {\n\tjustify-content: center;\n}\n.station[data-v-1eebd676] {\n\tfont-size: larger;\n\tfont-weight: bold;\n}\n.departure[data-v-1eebd676] {\n\ttext-align: right;\n}\n.connection[data-v-1eebd676] {\n\ttext-align: center;\n\tpadding: 0 40px;\n}\n","",{version:3,sources:["webpack://./src/components/itinerary/TrainReservation.vue"],names:[],mappings:";AAiKA;CACA,aAAA;CACA,mBAAA;CACA,iBAAA;CACA,qCAAA;CACA,mCAAA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;;CAEA,aAAA;CACA,sBAAA;CACA,YAAA;AACA;AAEA;;;CAGA,uBAAA;AACA;AAEA;CACA,iBAAA;CACA,iBAAA;AACA;AAEA;CACA,iBAAA;AACA;AAEA;CACA,kBAAA;CACA,eAAA;AACA",sourcesContent:["<template>\n\t<div class=\"reservation\">\n\t\t<div class=\"departure\">\n\t\t\t<div class=\"station\">\n\t\t\t\t{{ data.reservationFor.departureStation.name }}\n\t\t\t</div>\n\t\t\t<div v-if=\"departureDate\">\n\t\t\t\t{{ departureDate }}\n\t\t\t</div>\n\t\t\t<div v-if=\"departureTime\">\n\t\t\t\t{{ departureTime }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"connection\">\n\t\t\t<div><TrainIcon :title=\"t('mail', 'Train')\" /></div>\n\t\t\t<div>{{ trainNumber }}</div>\n\t\t\t<div><ArrowIcon decorative /></div>\n\t\t</div>\n\t\t<div class=\"arrival\">\n\t\t\t<div class=\"station\">\n\t\t\t\t{{ data.reservationFor.arrivalStation.name }}\n\t\t\t</div>\n\t\t\t<div v-if=\"arrivalDate\">\n\t\t\t\t{{ arrivalDate }}\n\t\t\t</div>\n\t\t\t<div v-if=\"arrivalTime\">\n\t\t\t\t{{ arrivalTime }}\n\t\t\t</div>\n\t\t</div>\n\t\t<CalendarImport v-if=\"canImport\" :calendars=\"calendars\" :handler=\"handleImport\" />\n\t</div>\n</template>\n\n<script>\nimport ArrowIcon from 'vue-material-design-icons/ArrowRight'\nimport ical from 'ical.js'\nimport md5 from 'md5'\nimport moment from '@nextcloud/moment'\nimport { showError, showSuccess } from '@nextcloud/dialogs'\nimport TrainIcon from 'vue-material-design-icons/Train'\n\nimport CalendarImport from './CalendarImport'\nimport { importCalendarEvent } from '../../service/DAVService'\nimport logger from '../../logger'\n\nexport default {\n\tname: 'TrainReservation',\n\tcomponents: {\n\t\tArrowIcon,\n\t\tCalendarImport,\n\t\tTrainIcon,\n\t},\n\tprops: {\n\t\tdata: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcalendars: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tdepartureTime() {\n\t\t\tif (!('departureTime' in this.data.reservationFor)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn moment(this.data.reservationFor.departureTime).format('LT')\n\t\t},\n\t\tdepartureDate() {\n\t\t\tif ('departureTime' in this.data.reservationFor) {\n\t\t\t\treturn moment(this.data.reservationFor.departureTime).format('L')\n\t\t\t}\n\t\t\tif ('departureDay' in this.data.reservationFor) {\n\t\t\t\treturn moment(this.data.reservationFor.departureDay).format('L')\n\t\t\t}\n\t\t\treturn undefined\n\t\t},\n\t\tarrivalTime() {\n\t\t\tif (!('arrivalTime' in this.data.reservationFor)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn moment(this.data.reservationFor.arrivalTime).format('LT')\n\t\t},\n\t\tarrivalDate() {\n\t\t\tif (!('arrivalTime' in this.data.reservationFor)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn moment(this.data.reservationFor.arrivalTime).format('L')\n\t\t},\n\t\ttrainNumber() {\n\t\t\treturn this.data.reservationFor.trainNumber\n\t\t},\n\t\tcanImport() {\n\t\t\treturn (\n\t\t\t\t('departureTime' in this.data.reservationFor && 'arrivalTime' in this.data.reservationFor)\n\t\t\t\t|| 'departureDay' in this.data.reservationFor\n\t\t\t)\n\t\t},\n\t},\n\tmethods: {\n\t\thandleImport(calendar) {\n\t\t\tconst event = new ical.Component('VEVENT')\n\t\t\tif ('trainNumber' in this.data.reservationFor) {\n\t\t\t\tevent.updatePropertyWithValue(\n\t\t\t\t\t'SUMMARY',\n\t\t\t\t\tt('mail', '{trainNr} from {depStation} to {arrStation}', {\n\t\t\t\t\t\ttrainNr: this.data.reservationFor.trainNumber,\n\t\t\t\t\t\tdepStation: this.data.reservationFor.departureStation.name,\n\t\t\t\t\t\tarrStation: this.data.reservationFor.arrivalStation.name,\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tevent.updatePropertyWithValue(\n\t\t\t\t\t'SUMMARY',\n\t\t\t\t\tt('mail', 'Train from {depStation} to {arrStation}', {\n\t\t\t\t\t\tdepStation: this.data.reservationFor.departureStation.name,\n\t\t\t\t\t\tarrStation: this.data.reservationFor.arrivalStation.name,\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t}\n\n\t\t\tif ('departureTime' in this.data.reservationFor && 'arrivalTime' in this.data.reservationFor) {\n\t\t\t\tconst depart = moment(this.data.reservationFor.departureTime).format()\n\t\t\t\tevent.updatePropertyWithValue('DTSTART', ical.Time.fromDateTimeString(depart))\n\t\t\t\tconst arrive = moment(this.data.reservationFor.arrivalTime).format()\n\t\t\t\tevent.updatePropertyWithValue('DTEND', ical.Time.fromDateTimeString(arrive))\n\t\t\t} else if ('departureDay' in this.data.reservationFor) {\n\t\t\t\tconst date = moment(this.data.reservationFor.departureDay).format()\n\t\t\t\tevent.updatePropertyWithValue('DTSTART', ical.Time.fromDateTimeString(date))\n\t\t\t}\n\n\t\t\t// TODO: read version from package.json\n\t\t\tevent.updatePropertyWithValue('PRODID', 'Nextcloud Mail')\n\n\t\t\t// TODO: is this free of collisions? the bug reports will tell us!\n\t\t\tevent.updatePropertyWithValue('UID', md5(this.messageId + this.departureTime))\n\n\t\t\tconst cal = new ical.Component('VCALENDAR')\n\t\t\tcal.addSubcomponent(event)\n\t\t\tlogger.debug('generated calendar event from train reservation data', { ical: cal.toString() })\n\n\t\t\treturn importCalendarEvent(calendar.url)(cal.toString())\n\t\t\t\t.then(() => {\n\t\t\t\t\tlogger.debug('event successfully imported')\n\t\t\t\t\tshowSuccess(t('mail', 'Event imported into {calendar}', { calendar: calendar.displayname }))\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlogger.error('Could not import event', { error })\n\t\t\t\t\tshowError(t('mail', 'Could not create event'))\n\t\t\t\t})\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.reservation {\n\tdisplay: flex;\n\tflex-direction: row;\n\tmargin: 30px 38px;\n\tborder: 1px solid var(--color-border);\n\tborder-radius: var(--border-radius);\n\tpadding: 20px;\n\talign-items: center;\n}\n\n.departure,\n.arrival {\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n}\n\n.departure,\n.arrival,\n.connection {\n\tjustify-content: center;\n}\n\n.station {\n\tfont-size: larger;\n\tfont-weight: bold;\n}\n\n.departure {\n\ttext-align: right;\n}\n\n.connection {\n\ttext-align: center;\n\tpadding: 0 40px;\n}\n</style>\n"],sourceRoot:""}]),n.a=r},1317:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,'.attachment[data-v-473b0a1e]{position:relative;display:inline-block;width:calc(100% - 32px);padding:16px}.attachment[data-v-473b0a1e]:hover,.attachment span[data-v-473b0a1e]:hover{background-color:var(--color-background-hover);cursor:pointer}.mail-attached-image[data-v-473b0a1e]{display:block;max-width:100%;border-radius:var(--border-radius);cursor:pointer}.mail-attached-image[data-v-473b0a1e]:hover{opacity:.8}.attachment-save-to-cloud[data-v-473b0a1e],.attachment-download[data-v-473b0a1e],.attachment-import[data-v-473b0a1e]{position:absolute;padding:21px;margin:0;bottom:6px;background-color:transparent;border-color:transparent}.attachment-save-to-cloud[data-v-473b0a1e]{right:0}.attachment-download[data-v-473b0a1e]{right:32px;opacity:.6}.attachment-import[data-v-473b0a1e]{right:64px}.attachment-import-popover[data-v-473b0a1e]{right:32px;top:42px}.attachment-import-popover[data-v-473b0a1e]::after{right:32px}.attachment-name[data-v-473b0a1e]{display:inline-block;width:calc(100% - 72px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;vertical-align:middle}.attachment-size[data-v-473b0a1e]{-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";opacity:.5}.attachment-icon[data-v-473b0a1e]{vertical-align:middle;text-align:left}',"",{version:3,sources:["webpack://./src/components/MessageAttachment.vue"],names:[],mappings:"AAgMA,6BACC,iBAAA,CACA,oBAAA,CACA,uBAAA,CACA,YAAA,CAGD,2EAEC,8CAAA,CACA,cAAA,CAGD,sCACC,aAAA,CACA,cAAA,CACA,kCAAA,CACA,cAAA,CAED,4CACC,UAAA,CAGD,qHAGC,iBAAA,CACA,YAAA,CACA,QAAA,CACA,UAAA,CACA,4BAAA,CACA,wBAAA,CAGD,2CACC,OAAA,CAGD,sCACC,UAAA,CACA,UAAA,CAGD,oCACC,UAAA,CAGD,4CACC,UAAA,CACA,QAAA,CAGD,mDACC,UAAA,CAGD,kCACC,oBAAA,CACA,uBAAA,CACA,kBAAA,CACA,eAAA,CACA,sBAAA,CACA,qBAAA,CAID,kCACC,gEAAA,CACA,UAAA,CAGD,kCACC,qBAAA,CACA,eAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.attachment {\n\tposition: relative;\n\tdisplay: inline-block;\n\twidth: calc(100% - 32px);\n\tpadding: 16px;\n}\n\n.attachment:hover,\n.attachment span:hover {\n\tbackground-color: var(--color-background-hover);\n\tcursor: pointer;\n}\n\n.mail-attached-image {\n\tdisplay: block;\n\tmax-width: 100%;\n\tborder-radius: var(--border-radius);\n\tcursor: pointer;\n}\n.mail-attached-image:hover {\n\topacity: 0.8;\n}\n\n.attachment-save-to-cloud,\n.attachment-download,\n.attachment-import {\n\tposition: absolute;\n\tpadding: 21px;\n\tmargin: 0;\n\tbottom: 6px;\n\tbackground-color: transparent;\n\tborder-color: transparent;\n}\n\n.attachment-save-to-cloud {\n\tright: 0;\n}\n\n.attachment-download {\n\tright: 32px;\n\topacity: 0.6;\n}\n\n.attachment-import {\n\tright: 64px;\n}\n\n.attachment-import-popover {\n\tright: 32px;\n\ttop: 42px;\n}\n\n.attachment-import-popover::after {\n\tright: 32px;\n}\n\n.attachment-name {\n\tdisplay: inline-block;\n\twidth: calc(100% - 72px);\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tvertical-align: middle;\n}\n\n/* show attachment size less prominent */\n.attachment-size {\n\t-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=50)';\n\topacity: 0.5;\n}\n\n.attachment-icon {\n\tvertical-align: middle;\n\ttext-align: left;\n}\n"],sourceRoot:""}]),n.a=r},1318:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".attachments{width:300px}.attachments-button-wrapper{text-align:center}.attachments-save-to-cloud{display:inline-block;margin:16px;background-position:16px center;padding:12px;padding-left:44px}.oc-dialog{z-index:10000000}","",{version:3,sources:["webpack://./src/components/MessageAttachments.vue"],names:[],mappings:"AA6HA,aACC,WAAA,CAKD,4BACC,iBAAA,CAED,2BACC,oBAAA,CACA,WAAA,CACA,+BAAA,CACA,YAAA,CACA,iBAAA,CAED,WACC,gBAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.attachments {\n\twidth: 300px;\n}\n\n/* show icon + text for Download all button\n\t\tas well as when there is only one attachment */\n.attachments-button-wrapper {\n\ttext-align: center;\n}\n.attachments-save-to-cloud {\n\tdisplay: inline-block;\n\tmargin: 16px;\n\tbackground-position: 16px center;\n\tpadding: 12px;\n\tpadding-left: 44px;\n}\n.oc-dialog {\n\tz-index: 10000000;\n}\n"],sourceRoot:""}]),n.a=r},1319:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".mail-message-has-mdn-request[data-v-3bf60f28]{white-space:normal}","",{version:3,sources:["webpack://./src/components/MdnRequest.vue"],names:[],mappings:"AA4DA,+CACC,kBAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.mail-message-has-mdn-request {\n\twhite-space: normal;\n}\n"],sourceRoot:""}]),n.a=r},1320:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"\n#mail-content[data-v-812ccd96] {\n\theight: 450px;\n}\n","",{version:3,sources:["webpack://./src/components/MessageEncryptedBody.vue"],names:[],mappings:";AA8CA;CACA,aAAA;AACA",sourcesContent:["<template>\n\t<div>\n\t\t<div v-if=\"mailvelope\" id=\"mail-content\">\n\t\t\t<MdnRequest :message=\"message\" />\n\t\t</div>\n\t\t<span v-else>{{ t('mail', 'This message is encrypted with PGP. Install Mailvelope to decrypt it.') }}</span>\n\t</div>\n</template>\n\n<script>\nimport { getMailvelope } from '../crypto/mailvelope'\nimport MdnRequest from './MdnRequest'\n\nexport default {\n\tname: 'MessageEncryptedBody',\n\tcomponents: { MdnRequest },\n\tprops: {\n\t\tbody: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tfrom: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: undefined,\n\t\t},\n\t\tmessage: {\n\t\t\trequired: true,\n\t\t\ttype: Object,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tmailvelope: false,\n\t\t}\n\t},\n\tasync mounted() {\n\t\tthis.mailvelope = await getMailvelope()\n\t\tthis.mailvelope.createDisplayContainer('#mail-content', this.body, undefined, {\n\t\t\tsenderAddress: this.from,\n\t\t})\n\t},\n}\n<\/script>\n\n<style scoped>\n#mail-content {\n\theight: 450px;\n}\n</style>\n"],sourceRoot:""}]),n.a=r},1324:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"#mail-content[data-v-566bc156]{margin-left:48px;margin-top:2px;display:flex;flex-direction:column;height:100%;background-color:#fff}#mail-message-has-blocked-content[data-v-566bc156]{margin-left:8px}#message-container[data-v-566bc156]{flex:1;display:flex;background-color:#fff}#message-container.scroll[data-v-566bc156]{max-height:50vh;overflow-y:auto}[data-v-566bc156] .icon-toggle{background-image:var(--icon-toggle-000) !important}[data-v-566bc156] .action-item__menutoggle--with-title{background-color:var(--color-background-hover) !important}.message-frame[data-v-566bc156]{width:100%}","",{version:3,sources:["webpack://./src/components/MessageHTMLBody.vue"],names:[],mappings:"AA8IA,+BACC,gBAAA,CACA,cAAA,CACA,YAAA,CACA,qBAAA,CACA,WAAA,CACA,qBAAA,CAED,mDACC,eAAA,CAGD,oCACC,MAAA,CACA,YAAA,CACA,qBAAA,CAGA,2CACC,eAAA,CACA,eAAA,CAGF,+BACC,kDAAA,CAED,uDACC,yDAAA,CAED,gCACC,UAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// account for 8px margin on iframe body\n#mail-content {\n\tmargin-left: 48px;\n\tmargin-top: 2px;\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tbackground-color: #FFFFFF;\n}\n#mail-message-has-blocked-content {\n\tmargin-left: 8px;\n}\n\n#message-container {\n\tflex: 1;\n\tdisplay: flex;\n\tbackground-color: #FFFFFF;\n\n\t// TODO: collapse quoted text and remove inner scrollbar\n\t&.scroll {\n\t\tmax-height: 50vh;\n\t\toverflow-y: auto;\n\t}\n}\n::v-deep .icon-toggle {\n\tbackground-image: var(--icon-toggle-000) !important;\n}\n::v-deep .action-item__menutoggle--with-title {\n\tbackground-color: var(--color-background-hover) !important;\n}\n.message-frame {\n\twidth: 100%;\n}\n"],sourceRoot:""}]),n.a=r},1325:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".quoted-text{color:var(--color-text-maxcontrast)}","",{version:3,sources:["webpack://./src/components/MessagePlainTextBody.vue"],names:[],mappings:"AAqEA,aACC,mCAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.quoted-text {\n\tcolor: var(--color-text-maxcontrast)\n}\n"],sourceRoot:""}]),n.a=r},1326:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"#mail-content[data-v-6bd2c088],.mail-signature[data-v-6bd2c088]{white-space:pre-wrap}.mail-signature[data-v-6bd2c088],.quoted[data-v-6bd2c088]{color:var(--color-text-maxcontrast)}","",{version:3,sources:["webpack://./src/components/MessagePlainTextBody.vue"],names:[],mappings:"AA0EA,gEACC,oBAAA,CAED,0DACC,mCAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#mail-content, .mail-signature {\n\twhite-space: pre-wrap;\n}\n.mail-signature, .quoted {\n\tcolor: var(--color-text-maxcontrast)\n}\n"],sourceRoot:""}]),n.a=r},1327:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".v-popover>.trigger>.action-item[data-v-106a4f26]{border-radius:22px;background-color:var(--color-background-darker)}","",{version:3,sources:["webpack://./src/components/Message.vue"],names:[],mappings:"AA8GA,kDACC,kBAAA,CACA,+CAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.v-popover > .trigger > .action-item {\n\tborder-radius: 22px;\n\tbackground-color: var(--color-background-darker);\n}\n"],sourceRoot:""}]),n.a=r},1329:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".source-modal[data-v-4870a97e]  .modal-container{height:800px}.source-modal .source-modal-content[data-v-4870a97e]{width:100%;height:100%;overflow-y:scroll !important}","",{version:3,sources:["webpack://./src/components/MenuEnvelope.vue"],names:[],mappings:"AAqWC,iDACC,YAAA,CAGD,qDACC,UAAA,CACA,WAAA,CACA,4BAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.source-modal {\n\t::v-deep .modal-container {\n\t\theight: 800px;\n\t}\n\n\t.source-modal-content {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\toverflow-y: scroll !important;\n\t}\n}\n"],sourceRoot:""}]),n.a=r},1330:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".sender[data-v-0737c023]{margin-left:8px}.right[data-v-0737c023]{display:flex;flex-direction:row;align-items:center;justify-content:flex-end;margin-left:10px;margin-right:22px;height:44px}.right .app-content-list-item-menu[data-v-0737c023]{margin-left:4px}.right .timestamp[data-v-0737c023]{margin-right:10px;font-size:small;white-space:nowrap;margin-bottom:0}.button[data-v-0737c023]{color:var(--color-main-background)}.button[data-v-0737c023]:not(.active):not(.primary){display:none}.button:not(.active):not(.primary).primary[data-v-0737c023]{background-color:var(--color-primary);opacity:1;margin-bottom:0}.avatardiv[data-v-0737c023]{display:inline-block;margin-bottom:-23px}.subject[data-v-0737c023]{margin-left:8px;cursor:default}.envelope[data-v-0737c023]{display:flex;flex-direction:column}.envelope--header[data-v-0737c023]{position:relative;display:flex;padding:10px;margin-bottom:3px;border-radius:var(--border-radius)}.envelope--header[data-v-0737c023]:hover{background-color:var(--color-background-hover);border-radius:16px}.left[data-v-0737c023]{flex-grow:1}.icon-important[data-v-0737c023]  path{fill:#fc0;stroke:var(--color-main-background);cursor:pointer}.icon-important.app-content-list-item-star[data-v-0737c023]{background-image:none;position:absolute;opacity:1;width:16px;height:16px;margin-left:-1px;display:flex}.icon-important.app-content-list-item-star[data-v-0737c023]:hover,.icon-important.app-content-list-item-star[data-v-0737c023]:focus{opacity:.5}.app-content-list-item-star.icon-starred[data-v-0737c023]{display:inline-block;position:absolute;margin-top:-2px;margin-left:27px;cursor:pointer}.left[data-v-0737c023]:not(.seen){font-weight:bold}.tag-group__label[data-v-0737c023]{margin:0 7px;z-index:2;font-size:calc(var(--default-font-size) * 0.8);font-weight:bold;padding-left:2px;padding-right:2px}.tag-group__bg[data-v-0737c023]{position:absolute;width:100%;height:100%;top:0;left:0;opacity:15%}.tag-group[data-v-0737c023]{display:inline-block;border:1px solid transparent;border-radius:var(--border-radius-pill);position:relative;margin:0 1px;overflow:hidden;left:4px}.envelope--header.list-item-style[data-v-0737c023]{border-radius:16px;background-color:var(--color-primary-light)}","",{version:3,sources:["webpack://./src/components/ThreadEnvelope.vue"],names:[],mappings:"AAkRA,yBACC,eAAA,CAGD,wBACC,YAAA,CACA,kBAAA,CACA,kBAAA,CACA,wBAAA,CACA,gBAAA,CACA,iBAAA,CACA,WAAA,CAEA,oDACC,eAAA,CAGD,mCACC,iBAAA,CACA,eAAA,CACA,kBAAA,CACA,eAAA,CAGF,yBACC,kCAAA,CACA,oDACC,YAAA,CAEA,4DACC,qCAAA,CACA,SAAA,CACA,eAAA,CAKH,4BACC,oBAAA,CACA,mBAAA,CAED,0BACC,eAAA,CACA,cAAA,CAGD,2BACC,YAAA,CACA,qBAAA,CAGD,mCACC,iBAAA,CACA,YAAA,CACA,YAAA,CACA,iBAAA,CACA,kCAAA,CAEA,yCACC,8CAAA,CACA,kBAAA,CAGF,uBACC,WAAA,CAGA,uCACC,SAAA,CACA,mCAAA,CACA,cAAA,CAGD,4DACC,qBAAA,CACA,iBAAA,CACA,SAAA,CACA,UAAA,CACA,WAAA,CACA,gBAAA,CACA,YAAA,CAEA,oIAEC,UAAA,CAIH,0DACC,oBAAA,CACA,iBAAA,CACA,eAAA,CACA,gBAAA,CACA,cAAA,CAED,kCACC,gBAAA,CAED,mCACC,YAAA,CACA,SAAA,CACA,8CAAA,CACA,gBAAA,CACA,gBAAA,CACA,iBAAA,CAED,gCACC,iBAAA,CACA,UAAA,CACA,WAAA,CACA,KAAA,CACA,MAAA,CACA,WAAA,CAED,4BACC,oBAAA,CACA,4BAAA,CACA,uCAAA,CACA,iBAAA,CACA,YAAA,CACA,eAAA,CACA,QAAA,CAED,mDACC,kBAAA,CACA,2CAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.sender {\n\tmargin-left: 8px;\n}\n\n.right {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: flex-end;\n\tmargin-left: 10px;\n\tmargin-right: 22px;\n\theight: 44px;\n\n\t.app-content-list-item-menu {\n\t\tmargin-left: 4px;\n\t}\n\n\t.timestamp {\n\t\tmargin-right: 10px;\n\t\tfont-size: small;\n\t\twhite-space: nowrap;\n\t\tmargin-bottom: 0;\n\t}\n}\n.button {\n\tcolor: var(--color-main-background);\n\t&:not(.active):not(.primary) {\n\t\tdisplay: none;\n\n\t\t&.primary {\n\t\t\tbackground-color: var(--color-primary);\n\t\t\topacity: 1;\n\t\t\tmargin-bottom: 0;\n\n\t\t}\n\t}\n}\n.avatardiv {\n\tdisplay: inline-block;\n\tmargin-bottom: -23px;\n}\n.subject {\n\tmargin-left: 8px;\n\tcursor: default;\n}\n\n.envelope {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.envelope--header {\n\tposition: relative;\n\tdisplay: flex;\n\tpadding: 10px;\n\tmargin-bottom: 3px;\n\tborder-radius: var(--border-radius);\n\n\t&:hover {\n\t\tbackground-color: var(--color-background-hover);\n\t\tborder-radius: 16px;\n\t}\n}\n.left {\n\tflex-grow: 1;\n}\n.icon-important {\n\t::v-deep path {\n\t\tfill: #ffcc00;\n\t\tstroke: var(--color-main-background);\n\t\tcursor: pointer;\n\t}\n\n\t&.app-content-list-item-star {\n\t\tbackground-image: none;\n\t\tposition: absolute;\n\t\topacity: 1;\n\t\twidth: 16px;\n\t\theight: 16px;\n\t\tmargin-left: -1px;\n\t\tdisplay: flex;\n\n\t\t&:hover,\n\t\t&:focus {\n\t\t\topacity: 0.5;\n\t\t}\n\t}\n}\n.app-content-list-item-star.icon-starred {\n\tdisplay: inline-block;\n\tposition: absolute;\n\tmargin-top: -2px;\n\tmargin-left: 27px;\n\tcursor: pointer;\n}\n.left:not(.seen) {\n\tfont-weight: bold;\n}\n.tag-group__label {\n\tmargin: 0 7px;\n\tz-index: 2;\n\tfont-size: calc(var(--default-font-size) * 0.8);\n\tfont-weight: bold;\n\tpadding-left: 2px;\n\tpadding-right: 2px;\n}\n.tag-group__bg {\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\ttop: 0;\n\tleft: 0;\n\topacity: 15%;\n}\n.tag-group {\n\tdisplay: inline-block;\n\tborder: 1px solid transparent;\n\tborder-radius: var(--border-radius-pill);\n\tposition: relative;\n\tmargin: 0 1px;\n\toverflow: hidden;\n\tleft: 4px;\n}\n.envelope--header.list-item-style {\n\tborder-radius: 16px;\n\tbackground-color: var(--color-primary-light);\n}\n"],sourceRoot:""}]),n.a=r},1331:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"#mail-message{flex-grow:1}#mail-message .icon-loading:only-child:after{margin-top:20px}.mail-message-body{flex:1;margin-bottom:60px;position:relative}#mail-thread-header{display:flex;flex-direction:row;justify-content:space-between;align-items:center;padding:30px 0;box-sizing:content-box !important;height:44px;width:100%;z-index:100;position:fixed;position:-webkit-sticky;position:sticky;top:0;background:-webkit-linear-gradient(var(--color-main-background), var(--color-main-background) 80%, rgba(255, 255, 255, 0));background:-o-linear-gradient(var(--color-main-background), var(--color-main-background) 80%, rgba(255, 255, 255, 0));background:-moz-linear-gradient(var(--color-main-background), var(--color-main-background) 80%, rgba(255, 255, 255, 0));background:linear-gradient(var(--color-main-background), var(--color-main-background) 80%, rgba(255, 255, 255, 0))}#mail-thread-header-fields{width:0;padding-left:60px;flex:1 1 auto}#mail-thread-header-fields h2,#mail-thread-header-fields p{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-bottom:7px;margin-bottom:0}#mail-thread-header-fields .transparency{opacity:.6}#mail-thread-header-fields .transparency a{font-weight:bold}.attachment-popover{position:sticky;bottom:12px;text-align:center}.tooltip-inner{text-align:left}#mail-content{margin:10px 38px 50px 60px}.mail-message-body-html #mail-content{margin-bottom:-44px}#mail-content iframe{width:100%}#show-images-text{display:none}#mail-content a,.mail-signature a{color:#07d;border-bottom:1px dotted #07d;text-decoration:none;word-wrap:break-word}.icon-reply-white,.icon-reply-all-white{height:44px;min-width:44px;margin:0;padding:9px 18px 10px 32px}@media only screen and (max-width: 600px){.action-label{display:none}}@media only screen and (min-width: 600px){.icon-reply-white,.icon-reply-all-white{background-position:12px center}}@media print{#mail-thread-header-fields{position:relative}#header,.app-navigation,#reply-composer,#forward-button,#mail-message-has-blocked-content,.app-content-list,.message-composer,.mail-message-attachments{display:none !important}.app-content{margin-left:0 !important}.mail-message-body{margin-bottom:0 !important}}.message-source{font-family:monospace;white-space:pre-wrap;user-select:text}.avatar-header{max-height:24px;overflow:hidden}.avatar-more{display:inline;background-color:var(--color-background-dark);padding:0px 0px 1px 1px;border-radius:10px;cursor:pointer}.avatar-hidden{visibility:hidden}.popover__wrapper{max-width:500px}.app-content-list-item-star.icon-starred{display:none}.user-bubble__wrapper{margin-right:4px}.user-bubble__title{cursor:pointer}","",{version:3,sources:["webpack://./src/components/Thread.vue"],names:[],mappings:"AA+PA,cACC,WAAA,CAGC,6CACC,eAAA,CAKH,mBACC,MAAA,CACA,kBAAA,CACA,iBAAA,CAGD,oBACC,YAAA,CACA,kBAAA,CACA,6BAAA,CACA,kBAAA,CACA,cAAA,CAIA,iCAAA,CACA,WAAA,CACA,UAAA,CAEA,WAAA,CACA,cAAA,CACA,uBAAA,CACA,eAAA,CACA,KAAA,CACA,0HAAA,CACA,qHAAA,CACA,uHAAA,CACA,kHAAA,CAGD,2BAEC,OAAA,CACA,iBAAA,CAEA,aAAA,CACA,2DAEC,kBAAA,CACA,eAAA,CACA,sBAAA,CACA,kBAAA,CACA,eAAA,CAGD,yCACC,UAAA,CACA,2CACC,gBAAA,CAKH,oBACC,eAAA,CACA,WAAA,CACA,iBAAA,CAGD,eACC,eAAA,CAGD,cACC,0BAAA,CAEA,sCACC,mBAAA,CAIF,qBACC,UAAA,CAGD,kBACC,YAAA,CAGD,kCAEC,UAAA,CACA,6BAAA,CACA,oBAAA,CACA,oBAAA,CAGD,wCAEC,WAAA,CACA,cAAA,CACA,QAAA,CACA,0BAAA,CAKD,0CACC,cACC,YAAA,CAAA,CAGF,0CACC,wCAEC,+BAAA,CAAA,CAIF,aACC,2BACC,iBAAA,CAGD,wJAQC,uBAAA,CAED,aACC,wBAAA,CAED,mBACC,0BAAA,CAAA,CAIF,gBACC,qBAAA,CACA,oBAAA,CACA,gBAAA,CAGD,eACC,eAAA,CACA,eAAA,CAED,aACC,cAAA,CACA,6CAAA,CACA,uBAAA,CACA,kBAAA,CACA,cAAA,CAED,eACC,iBAAA,CAED,kBACC,eAAA,CAGD,yCACC,YAAA,CAED,sBACC,gBAAA,CAED,oBACC,cAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#mail-message {\n\tflex-grow: 1;\n\n\t.icon-loading {\n\t\t&:only-child:after {\n\t\t\tmargin-top: 20px;\n\t\t}\n\t}\n}\n\n.mail-message-body {\n\tflex: 1;\n\tmargin-bottom: 60px;\n\tposition: relative;\n}\n\n#mail-thread-header {\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: space-between;\n\talign-items: center;\n\tpadding: 30px 0;\n\t// somehow ios doesn't care about this !important rule\n\t// so we have to manually set left/right padding to chidren\n\t// for 100% to be used\n\tbox-sizing: content-box !important;\n\theight: 44px;\n\twidth: 100%;\n\n\tz-index: 100;\n\tposition: fixed; // ie fallback\n\tposition: -webkit-sticky; // ios/safari fallback\n\tposition: sticky;\n\ttop: 0;\n\tbackground: -webkit-linear-gradient(var(--color-main-background), var(--color-main-background) 80%, rgba(255,255,255,0));\n\tbackground: -o-linear-gradient(var(--color-main-background), var(--color-main-background)  80%, rgba(255,255,255,0));\n\tbackground: -moz-linear-gradient(var(--color-main-background), var(--color-main-background)  80%, rgba(255,255,255,0));\n\tbackground: linear-gradient(var(--color-main-background), var(--color-main-background)  80%, rgba(255,255,255,0));\n}\n\n#mail-thread-header-fields {\n\t// initial width\n\twidth: 0;\n\tpadding-left: 60px;\n\t// grow and try to fill 100%\n\tflex: 1 1 auto;\n\th2,\n\tp {\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tpadding-bottom: 7px;\n\t\tmargin-bottom: 0;\n\t}\n\n\t.transparency {\n\t\topacity: 0.6;\n\t\ta {\n\t\t\tfont-weight: bold;\n\t\t}\n\t}\n}\n\n.attachment-popover {\n\tposition: sticky;\n\tbottom: 12px;\n\ttext-align: center;\n}\n\n.tooltip-inner {\n\ttext-align: left;\n}\n\n#mail-content {\n\tmargin: 10px 38px 50px 60px;\n\n\t.mail-message-body-html & {\n\t\tmargin-bottom: -44px; // accounting for the sticky attachment button\n\t}\n}\n\n#mail-content iframe {\n\twidth: 100%;\n}\n\n#show-images-text {\n\tdisplay: none;\n}\n\n#mail-content a,\n.mail-signature a {\n\tcolor: #07d;\n\tborder-bottom: 1px dotted #07d;\n\ttext-decoration: none;\n\tword-wrap: break-word;\n}\n\n.icon-reply-white,\n.icon-reply-all-white {\n\theight: 44px;\n\tmin-width: 44px;\n\tmargin: 0;\n\tpadding: 9px 18px 10px 32px;\n}\n\n/* Show action button label and move icon to the left\n   on screens larger than 600px */\n@media only screen and (max-width: 600px) {\n\t.action-label {\n\t\tdisplay: none;\n\t}\n}\n@media only screen and (min-width: 600px) {\n\t.icon-reply-white,\n\t.icon-reply-all-white {\n\t\tbackground-position: 12px center;\n\t}\n}\n\n@media print {\n\t#mail-thread-header-fields {\n\t\tposition: relative;\n\t}\n\n\t#header,\n\t.app-navigation,\n\t#reply-composer,\n\t#forward-button,\n\t#mail-message-has-blocked-content,\n\t.app-content-list,\n\t.message-composer,\n\t.mail-message-attachments {\n\t\tdisplay: none !important;\n\t}\n\t.app-content {\n\t\tmargin-left: 0 !important;\n\t}\n\t.mail-message-body {\n\t\tmargin-bottom: 0 !important;\n\t}\n}\n\n.message-source {\n\tfont-family: monospace;\n\twhite-space: pre-wrap;\n\tuser-select: text;\n}\n\n.avatar-header {\n\tmax-height: 24px;\n\toverflow: hidden;\n}\n.avatar-more {\n\tdisplay: inline;\n\tbackground-color: var(--color-background-dark);\n\tpadding: 0px 0px 1px 1px;\n\tborder-radius: 10px;\n\tcursor: pointer;\n}\n.avatar-hidden {\n\tvisibility: hidden;\n}\n.popover__wrapper {\n\tmax-width: 500px;\n}\n\n.app-content-list-item-star.icon-starred {\n\tdisplay: none;\n}\n.user-bubble__wrapper {\n\tmargin-right: 4px;\n}\n.user-bubble__title {\n\tcursor: pointer;\n}\n"],sourceRoot:""}]),n.a=r},1332:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,".v-popover>.trigger[data-v-407d295e]>{z-index:1}.icon-info[data-v-407d295e]{background-image:var(--icon-info-000)}.important-info[data-v-407d295e]{max-width:230px;padding:16px}.app-content-list-item[data-v-407d295e]:hover{background:transparent}.button[data-v-407d295e]{background-color:var(--color-main-background);width:44px;height:44px;border:0;margin-bottom:17px}.button[data-v-407d295e]:hover,.button[data-v-407d295e]:focus{background-color:var(--color-background-dark)}#app-content-wrapper[data-v-407d295e]{display:flex}","",{version:3,sources:["webpack://./src/components/MailboxThread.vue"],names:[],mappings:"AA+LA,sCACC,SAAA,CAGD,4BACC,qCAAA,CAGD,iCACC,eAAA,CACA,YAAA,CAGD,8CACC,sBAAA,CAGD,yBACC,6CAAA,CACA,UAAA,CACA,WAAA,CACA,QAAA,CACA,kBAAA,CAEA,8DAEC,6CAAA,CAIF,sCACC,YAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.v-popover > .trigger > {\n\tz-index: 1;\n}\n\n.icon-info {\n\tbackground-image: var(--icon-info-000);\n}\n\n.important-info {\n\tmax-width: 230px;\n\tpadding: 16px;\n}\n\n.app-content-list-item:hover {\n\tbackground: transparent;\n}\n\n.button {\n\tbackground-color: var(--color-main-background);\n\twidth: 44px;\n\theight: 44px;\n\tborder: 0;\n\tmargin-bottom: 17px;\n\n\t&:hover,\n\t&:focus {\n\t\tbackground-color: var(--color-background-dark);\n\t}\n}\n\n#app-content-wrapper {\n\tdisplay: flex;\n}\n"],sourceRoot:""}]),n.a=r},1376:function(t,n,e){"use strict";var a=e(32),i=e.n(a),o=e(33),r=e.n(o)()(i.a);r.push([t.i,"[data-v-8e7f1bfa] .app-content-details{margin:0 auto;max-width:900px;display:flex;flex-direction:column;flex:1 1 100%;min-width:0}","",{version:3,sources:["webpack://./src/views/Home.vue"],names:[],mappings:"AAmHA,uCACC,aAAA,CACA,eAAA,CACA,YAAA,CACA,qBAAA,CACA,aAAA,CACA,WAAA",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n::v-deep .app-content-details {\n\tmargin: 0 auto;\n\tmax-width: 900px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex: 1 1 100%;\n\tmin-width: 0;\n}\n"],sourceRoot:""}]),n.a=r},1400:function(n,e,a){"use strict";a.r(e);var i=a(842),o=a.n(i),r=a(777),s=a.n(r),l=a(7),d=a(1119),c=a.n(d),p=a(1123),m=a.n(p),A=a(743),u=a.n(A),h={name:"SectionTitle",props:{name:{type:String,required:!0}}},g=a(31),v=a.n(g),f=a(1124),C={insert:"head",singleton:!1},b=(v()(f.a,C),f.a.locals,a(28)),y=Object(b.a)(h,(function(){var t=this.$createElement,n=this._self._c||t;return n("div",{attrs:{id:"priority"}},[n("div",{staticClass:"app-content-list-item"},[n("h2",[this._v(this._s(this.name))])])])}),[],!1,null,"95f06344",null).exports,x=a(2);const w="@@InfiniteScroll";var k=function(t){return t===window?Math.max(window.pageYOffset||0,document.documentElement.scrollTop):t.scrollTop},_=document.defaultView.getComputedStyle,I=function(t){return t===window?k(window):t.getBoundingClientRect().top+k(window)},T=function(t){for(var n=t.parentNode;n;){if("HTML"===n.tagName)return!0;if(11===n.nodeType)return!1;n=n.parentNode}return!1},E=function(){if(!this.binded){this.binded=!0;var t,n,e,a,i,o,r,s,l=this,d=l.el,c=d.getAttribute("infinite-scroll-throttle-delay"),p=200;c&&(p=Number(l.vm[c]||c),(isNaN(p)||p<0)&&(p=200)),l.throttleDelay=p,l.scrollEventTarget=function(t){for(var n=t;n&&"HTML"!==n.tagName&&"BODY"!==n.tagName&&1===n.nodeType;){var e=_(n).overflowY;if("scroll"===e||"auto"===e)return n;n=n.parentNode}return window}(d),l.scrollListener=(t=M.bind(l),n=l.throttleDelay,s=function(){t.apply(o,r),a=e},function(){if(o=this,r=arguments,e=Date.now(),i&&(clearTimeout(i),i=null),a){var t=n-(e-a);t<0?s():i=setTimeout(()=>{s()},t)}else s()}),l.scrollEventTarget.addEventListener("scroll",l.scrollListener),this.vm.$on("hook:beforeDestroy",(function(){l.scrollEventTarget.removeEventListener("scroll",l.scrollListener)}));var m=d.getAttribute("infinite-scroll-disabled"),A=!1;m&&(this.vm.$watch(m,(function(t){l.disabled=t,!t&&l.immediateCheck&&M.call(l)})),A=Boolean(l.vm[m])),l.disabled=A;var u=d.getAttribute("infinite-scroll-distance"),h=0;u&&(h=Number(l.vm[u]||u),isNaN(h)&&(h=0)),l.distance=h;var g=d.getAttribute("infinite-scroll-immediate-check"),v=!0;g&&(v=Boolean(l.vm[g])),l.immediateCheck=v,v&&M.call(l);var f=d.getAttribute("infinite-scroll-listen-for-event");f&&l.vm.$on(f,(function(){M.call(l)}))}},M=function(t){var n=this.scrollEventTarget,e=this.el,a=this.distance;if(!0===t||!this.disabled){var i=k(n),o=i+function(t){return t===window?document.documentElement.clientHeight:t.clientHeight}(n),r=!1;if(n===e)r=n.scrollHeight-o<=a;else r=o+a>=I(e)-I(n)+e.offsetHeight+i;r&&this.expression&&this.expression()}},S={bind(t,n,e){t[w]={el:t,vm:e.context,expression:n.value};const a=arguments;console.info("binding",t,n,e),t[w].vm.$nextTick((function(){T(t)&&E.call(t[w],a),t[w].bindTryCount=0;var n=function(){t[w].bindTryCount>10||(t[w].bindTryCount++,T(t)?E.call(t[w],a):setTimeout(n,50))};n()}))},unbind(t){t&&t[w]&&t[w].scrollEventTarget&&t[w].scrollEventTarget.removeEventListener("scroll",t[w].scrollListener)}},D={name:"EmptyMailbox"},B=Object(b.a)(D,(function(){var t=this.$createElement,n=this._self._c||t;return n("div",{attrs:{id:"emptycontent"}},[n("div",{staticClass:"icon-mail"}),this._v(" "),n("h2",[this._v(this._s(this.t("mail","No messages in this mailbox")))])])}),[],!1,null,null,null).exports,j=a(709),$=a.n(j),O=a(687),F=a.n(O),N=a(102),R=a(1125),q=a.n(R),L=a(843),P=a.n(L),z=a(529),U=a(844),G=a(710),W=a.n(G),V=a(973),Y=a.n(V),H=a(744),Q=a(1133),K=a.n(Q);class J{constructor(t,n,e){this.el=t,this.options=e,this.registerListeners.bind(this)(t),this.setInitialAttributes()}setInitialAttributes(){this.el.setAttribute("draggable","true"),this.el.classList.add("draggable-envelope")}update(t,n){this.options=n.options}registerListeners(t){t.addEventListener("dragstart",this.onDragStart.bind(this)),t.addEventListener("dragend",this.onDragEnd.bind(this))}removeListeners(t){t.removeEventListener("dragstart",this.onDragStart),t.removeEventListener("dragend",this.onDragEnd)}onDragStart(t){const{accountId:n,mailboxId:e,selectedEnvelopes:a}=this.options;t.dataTransfer.clearData(),t.dataTransfer.effectAllowed="move";const i=[];if(a.length)a.forEach((t,a)=>{i.push({accountId:n,mailboxId:e,envelopeId:t.databaseId,draggableLabel:"".concat(t.subject," (").concat(t.from[0].label,")")})});else{const{envelopeId:t,draggableLabel:a}=this.options;i.push({accountId:n,mailboxId:e,envelopeId:t,draggableLabel:a})}t.dataTransfer.setData("text/plain",JSON.stringify(i)),this.attachGhost({event:t,envelopes:i}),H.a.$emit("dragStart",{accountId:n,mailboxId:e,itemCount:i.length})}onDragEnd(t){H.a.$emit("dragEnd",{accountId:this.options.accountId})}attachGhost({event:t,envelopes:n}){const e="draggable-envelope-ghost",a=document.createElement("div");a.classList.add(e);const i=document.createElement("span");i.classList.add("".concat(e,"--counter"));const o=document.createTextNode(n.length);i.appendChild(o),a.appendChild(i);const r=document.createElement("div");r.classList.add("".concat(e,"--label-wrapper")),n.forEach(t=>{const n=document.createElement("div");n.classList.add("".concat(e,"--label-wrapper--label"));const a=document.createTextNode(t.draggableLabel);n.appendChild(a),r.appendChild(n)}),a.appendChild(r),document.body.appendChild(a),t.dataTransfer.setDragImage(a,0,15),K()(()=>{document.body.removeChild(a)})}}let X=[];const Z={bind(t,n,e){const a=new J(t,e.context,n.value);X.push(a)},componentUpdated(t,n){const e=n.value;setTimeout(()=>{X.forEach(n=>{n.options.selectedEnvelopes=e.selectedEnvelopes,n.update(t,n)})})},unbind(t){X=X.filter(n=>n.el!==t)}};var tt=a(1135),nt=a.n(tt),et=a(722);
/**
 * @copyright 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
const at=(t,n,e,a=!0)=>{const i="<p></p><p></p>",o="<br>&gt; "+t.value.replace(/\n/g,"<br>&gt; "),r="<blockquote>".concat(t.value,"</blockquote>"),s='<div class="quote">';switch(t.format){case"plain":if(n){const t=W.a.unix(e).format("LLL");return a?Object(et.b)("".concat(i).concat(s,'"').concat(n.label,'" ').concat(n.email," – ").concat(t)+o+"</div>"):Object(et.b)("".concat(s,'"').concat(n.label,'" ').concat(n.email," – ").concat(t)+o+"</div>"+i)}return a?Object(et.b)("".concat(i).concat(s).concat(o).concat("</div>")):Object(et.b)("".concat(s).concat(o).concat("</div>").concat(i));case"html":if(n){const t=W.a.unix(e).format("LLL");return a?Object(et.b)("".concat(i).concat(s,'"').concat(n.label,'" ').concat(n.email," – ").concat(t,"<br>").concat(r).concat("</div>")):Object(et.b)("".concat(s,'"').concat(n.label,'" ').concat(n.email," – ").concat(t,"<br>").concat(r).concat("</div>").concat(i))}return a?Object(et.b)("".concat(i).concat(s).concat(r).concat("</div>")):Object(et.b)("".concat(s).concat(r).concat("</div>").concat(i))}throw new Error("can't build a reply for the format ".concat(t.format))},it=Object.seal({None:0,To:1,Cc:2}),ot=(t,n)=>{let e=it.None;const a=t=>t.email===n.email,i=nt()(a);let o=t.to.find(a);void 0!==o?e=it.To:(o=t.cc.find(a),void 0!==o?e=it.Cc:o=n);let r=[],s=[];return e===it.To?(r=t.to.filter(i),r=r.concat(t.from.filter(i)),s=t.cc):e===it.Cc?(r=t.to.concat(t.from.filter(i)),s=t.cc.filter(i)):(r=t.to,r=r.concat(t.from.filter(i)),s=t.cc),0===r.length&&(r=t.from),{to:r,from:o?[o]:[],cc:s}},rt=["antw","atb","aw","bls","odp","r","re","ref","res","rif","sv","vá","vs","ynt","απ","σχετ","השב","回复","回覆"],st=t=>rt.some(n=>t.toLowerCase().startsWith("".concat(n,":")))?t:"Re: ".concat(t),lt=["doorst","enc","fs","fw","fwd","i","i̇lt","pd","rv","továbbítás","tr","trs","vb","vl","vs","wg","yml","ΠΡΘ","הועבר","إعادة توجيه","رد","轉寄","转发"];var dt=a(225),ct=a(323),pt={name:"MoveModal",components:{MailboxPicker:a(1110).a},props:{account:{type:Object,required:!0},envelopes:{type:Array,required:!0},moveThread:{type:Boolean,default:!1}},data:()=>({moving:!1,destMailboxId:void 0}),methods:{onClose(){this.$emit("close")},async onMove(){this.moving=!0;try{const t=this.envelopes.filter(t=>t.mailboxId!==this.destMailboxId);if(0===t.length)return;for(const n of t)this.moveThread?await this.$store.dispatch("moveThread",{envelope:n,destMailboxId:this.destMailboxId}):await this.$store.dispatch("moveMessage",{id:n.databaseId,destMailboxId:this.destMailboxId});await this.$store.dispatch("syncEnvelopes",{mailboxId:this.destMailboxId}),this.$emit("move")}catch(t){l.a.error("could not move messages",{error:t})}finally{this.moving=!1,this.$emit("close")}}}},mt=Object(b.a)(pt,(function(){var t=this,n=t.$createElement;return(t._self._c||n)("MailboxPicker",{attrs:{account:t.account,selected:t.destMailboxId,loading:t.moving,"label-select":t.moveThread?t.t("mail","Move thread"):t.t("mail","Move message"),"label-select-loading":t.moveThread?t.t("mail","Moving thread"):t.t("mail","Moving message")},on:{"update:selected":function(n){t.destMailboxId=n},select:t.onMove,close:t.onClose}})}),[],!1,null,null,null).exports,At=a(748),ut=a.n(At),ht=a(784),gt=a.n(ht),vt=a(785),ft=a.n(vt);function Ct(){let t=((1<<24)*Math.random()|0).toString(16);for(;t.length<6;)t="0"+t;return"#"+t}var bt={name:"TagModal",components:{Modal:ut.a,ActionText:gt.a,ActionInput:ft.a},props:{envelope:{required:!0,type:Object}},data:()=>({isAdded:!1,editing:!1,tagLabel:!0,tagInput:!1,showSaving:!1,color:Ct()}),computed:{tags(){return this.$store.getters.getTags.filter(t=>"$label1"!==t.imapLabel)}},methods:{onClose(){this.$emit("close")},isSet(t){return this.$store.getters.getEnvelopeTags(this.envelope.databaseId).some(n=>n.imapLabel===t)},addTag(t){this.isAdded=!0,this.$store.dispatch("addEnvelopeTag",{envelope:this.envelope,imapLabel:t})},removeTag(t){this.isAdded=!1,this.$store.dispatch("removeEnvelopeTag",{envelope:this.envelope,imapLabel:t})},addTagInput(){this.editing=!0,this.showSaving=!1},async createTag(t){this.editing=!0;const n=t.target.querySelector("input[type=text]").value;try{await this.$store.dispatch("createTag",{displayName:n,color:Ct()})}catch(t){console.debug(t),Object(N.b)(this.t("mail","An error occurred, unable to create the tag."))}finally{this.showSaving=!1,this.tagLabel=!0}},convertHex(t,n){if(4===t.length){const e=parseInt(t.substring(1,2),16),a=parseInt(t.substring(2,3),16),i=parseInt(t.substring(3,4),16);return"rgba(".concat(e,", ").concat(a,", ").concat(i,", ").concat(n,")")}{const e=parseInt(t.substring(1,3),16),a=parseInt(t.substring(3,5),16),i=parseInt(t.substring(5,7),16);return"rgba(".concat(e,", ").concat(a,", ").concat(i,", ").concat(n,")")}}}},yt=a(1189),xt={insert:"head",singleton:!1},wt=(v()(yt.a,xt),yt.a.locals,Object(b.a)(bt,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("Modal",{attrs:{size:"large"},on:{close:t.onClose}},[e("div",{staticClass:"modal-content"},[e("h2",{staticClass:"tag-title"},[t._v("\n\t\t\t"+t._s(t.t("mail","Edit tags"))+"\n\t\t")]),t._v(" "),t._l(t.tags,(function(n){return e("div",{key:n.id,staticClass:"tag-group"},[e("button",{staticClass:"tag-group__label",style:{color:t.convertHex(n.color,1),"background-color":t.convertHex(n.color,.15)}},[t._v("\n\t\t\t\t"+t._s(n.displayName)+"\n\t\t\t")]),t._v(" "),t.isSet(n.imapLabel)?e("button",{staticClass:"tag-actions",on:{click:function(e){return t.removeTag(n.imapLabel)}}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Remove"))+"\n\t\t\t")]):e("button",{staticClass:"tag-actions",on:{click:function(e){return t.addTag(n.imapLabel)}}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Add"))+"\n\t\t\t")])])})),t._v(" "),e("h2",{staticClass:"tag-title"},[t._v("\n\t\t\t"+t._s(t.t("mail","Add tag"))+"\n\t\t")]),t._v(" "),e("div",{staticClass:"create-tag"},[t.editing?t._e():e("button",{staticClass:"tagButton",on:{click:t.addTagInput}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Add tag"))+"\n\t\t\t")]),t._v(" "),t.editing?e("ActionInput",{attrs:{icon:"icon-tag"},on:{submit:t.createTag}}):t._e(),t._v(" "),t.showSaving?e("ActionText",{attrs:{icon:"icon-loading-small"}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Saving tag …"))+"\n\t\t\t")]):t._e()],1)],2)])}),[],!1,null,"268a25d4",null).exports),kt={name:"Envelope",components:{ListItem:q.a,Avatar:z.a,ActionButton:F.a,ActionRouter:P.a,MoveModal:mt,TagModal:wt},directives:{draggableEnvelope:Z},props:{withReply:{type:Boolean,default:!0},data:{type:Object,required:!0},mailbox:{type:Object,required:!0},selectMode:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},selectedEnvelopes:{type:Array,required:!1,default:()=>[]}},data:()=>({importantSvg:Y.a,showMoveModal:!1,showTagModal:!1}),computed:{hasMultipleRecipients(){this.account||console.error("account is undefined",{accountId:this.data.accountId});const t=ot(this.envelope,{label:this.account.name,email:this.account.emailAddress});return t.to.concat(t.cc).length>1},accountColor(){var t;const n=this.$store.getters.getAccount(this.data.accountId);return Object(U.a)(null!==(t=null==n?void 0:n.emailAddress)&&void 0!==t?t:"")},draft(){return this.data.flags.draft},account(){var t;const n=null!==(t=this.data.accountId)&&void 0!==t?t:this.data.accountId;return this.$store.getters.getAccount(n)},link(){return this.draft?{name:"message",params:{mailboxId:this.$route.params.mailboxId,filter:this.$route.params.filter?this.$route.params.filter:void 0,threadId:"new",draftId:this.data.databaseId},exact:!0}:{name:"message",params:{mailboxId:this.$route.params.mailboxId,filter:this.$route.params.filter?this.$route.params.filter:void 0,threadId:this.data.databaseId},exact:!0}},addresses(){if("sent"===this.mailbox.specialRole){const n=[this.data.to,this.data.cc].flat().map((function(t){return t.label?t.label:t.email}));return n.length>0?n.join(", "):t("mail","Blind copy recipients only")}return 0===this.data.from.length?"?":this.data.from[0].label||this.data.from[0].email},avatarEmail(){if("sent"===this.mailbox.specialRole){const t=[this.data.to,this.data.cc].flat().map((function(t){return t.email}));return t.length>0?t[0]:void 0}return this.data.from.length>0?this.data.from[0].email:void 0},isImportant(){return this.$store.getters.getEnvelopeTags(this.data.databaseId).some(t=>"$label1"===t.imapLabel)},tags(){return this.$store.getters.getEnvelopeTags(this.data.databaseId).filter(t=>"$label1"!==t.imapLabel)}},methods:{setSelected(t){this.selected!==t&&this.$emit("update:selected",t)},formatted(){return W.a.unix(this.data.dateInt).fromNow()},unselect(){this.selected&&this.$emit("updated:selected",!1)},toggleSelected(){this.$emit("update:selected",!this.selected)},onSelectMultiple(){this.$emit("select-multiple")},onToggleImportant(){this.$store.dispatch("toggleEnvelopeImportant",this.data)},onToggleFlagged(){this.$store.dispatch("toggleEnvelopeFlagged",this.data)},onToggleSeen(){this.$store.dispatch("toggleEnvelopeSeen",{envelope:this.data})},onToggleJunk(){this.$store.dispatch("toggleEnvelopeJunk",this.data)},async onDelete(){this.setSelected(!1),this.$emit("delete",this.data.databaseId);try{await this.$store.dispatch("deleteThread",{envelope:this.data})}catch(n){Object(N.b)(await Object(ct.a)(n,{[dt.a.getName()]:()=>t("mail","No trash mailbox configured"),default:n=>(l.a.error("could not delete message",n),t("mail","Could not delete message"))}))}},onOpenMoveModal(){this.showMoveModal=!0},onMove(){this.$emit("move")},onCloseMoveModal(){this.showMoveModal=!1},onOpenTagModal(){this.showTagModal=!0},onCloseTagModal(){this.showTagModal=!1}}},_t=a(1190),It={insert:"head",singleton:!1},Tt=(v()(_t.a,It),_t.a.locals,Object(b.a)(kt,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ListItem",{directives:[{name:"draggable-envelope",rawName:"v-draggable-envelope",value:{accountId:t.data.accountId?t.data.accountId:t.mailbox.accountId,mailboxId:t.data.mailboxId,envelopeId:t.data.databaseId,draggableLabel:t.data.subject+" ("+t.data.from[0].label+")",selectedEnvelopes:t.selectedEnvelopes},expression:"{\n\t\taccountId: data.accountId ? data.accountId : mailbox.accountId,\n\t\tmailboxId: data.mailboxId,\n\t\tenvelopeId: data.databaseId,\n\t\tdraggableLabel: `${data.subject} (${data.from[0].label})`,\n\t\tselectedEnvelopes,\n\t}"}],staticClass:"list-item-style",class:{seen:t.data.flags.seen,draft:t.draft,selected:t.selected},attrs:{to:t.link,"data-envelope-id":t.data.databaseId,title:t.addresses,details:t.formatted()},scopedSlots:t._u([{key:"icon",fn:function(){return[t.mailbox.isUnified?e("div",{staticClass:"mail-message-account-color",style:{"background-color":t.accountColor}}):t._e(),t._v(" "),t.data.flags.flagged?e("div",{staticClass:"app-content-list-item-star icon-starred",attrs:{"data-starred":t.data.flags.flagged?"true":"false"},on:{click:function(n){return n.preventDefault(),t.onToggleFlagged.apply(null,arguments)}}}):t._e(),t._v(" "),t.isImportant?e("div",{staticClass:"app-content-list-item-star svg icon-important",attrs:{"data-starred":t.isImportant?"true":"false"},domProps:{innerHTML:t._s(t.importantSvg)},on:{click:function(n){return n.preventDefault(),t.onToggleImportant.apply(null,arguments)}}}):t._e(),t._v(" "),t.data.flags.junk?e("div",{staticClass:"app-content-list-item-star icon-junk",attrs:{"data-starred":t.data.flags.junk?"true":"false"},on:{click:function(n){return n.preventDefault(),t.onToggleJunk.apply(null,arguments)}}}):t._e(),t._v(" "),e("div",{staticClass:"app-content-list-item-icon"},[e("Avatar",{attrs:{"display-name":t.addresses,email:t.avatarEmail}}),t._v(" "),t.selectMode?e("p",{staticClass:"app-content-list-item-select-checkbox"},[e("input",{staticClass:"checkbox",attrs:{id:"select-checkbox-"+t.data.uid,type:"checkbox"},domProps:{checked:t.selected}}),t._v(" "),e("label",{attrs:{for:"select-checkbox-"+t.data.uid},on:{click:[function(n){return n.ctrlKey||n.shiftKey||n.altKey||n.metaKey?null:(n.preventDefault(),t.toggleSelected.apply(null,arguments))},function(n){return n.shiftKey?(n.preventDefault(),t.onSelectMultiple.apply(null,arguments)):null}]}})]):t._e()],1)]},proxy:!0},{key:"subtitle",fn:function(){return[t.data.flags.answered?e("span",{staticClass:"icon-reply"}):t._e(),t._v(" "),!0===t.data.flags.hasAttachments?e("span",{staticClass:"icon-public icon-attachment"}):t._e(),t._v(" "),t.draft?e("span",{staticClass:"draft"},[e("em",[t._v(t._s(t.t("mail","Draft: ")))])]):t._e(),t._v("\n\t\t"+t._s(t.data.subject)+"\n\t")]},proxy:!0},{key:"actions",fn:function(){return[e("ActionButton",{attrs:{icon:"icon-important","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onToggleImportant.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.isImportant?t.t("mail","Mark unimportant"):t.t("mail","Mark important"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-starred","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onToggleFlagged.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.data.flags.flagged?t.t("mail","Mark unfavorite"):t.t("mail","Mark favorite"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-mail","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onToggleSeen.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.data.flags.seen?t.t("mail","Mark unread"):t.t("mail","Mark read"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-junk","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onToggleJunk.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.data.flags.junk?t.t("mail","Mark not spam"):t.t("mail","Mark as spam"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-checkmark","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.toggleSelected.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.selected?t.t("mail","Unselect"):t.t("mail","Select"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-tag","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onOpenTagModal.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Edit tags"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-external","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onOpenMoveModal.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Move thread"))+"\n\t\t")]),t._v(" "),e("ActionRouter",{attrs:{icon:"icon-add",to:{name:"message",params:{mailboxId:t.$route.params.mailboxId,threadId:"asNew",filter:t.$route.params.filter},query:{messageId:t.data.databaseId}}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Edit as new message"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-delete","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onDelete.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Delete thread"))+"\n\t\t")])]},proxy:!0},{key:"extra",fn:function(){return[t.mailbox.isUnified?e("div",{staticClass:"mail-message-account-color",style:{"background-color":t.accountColor}}):t._e(),t._v(" "),t._l(t.tags,(function(n){return e("div",{key:n.id,staticClass:"tag-group"},[e("div",{staticClass:"tag-group__bg",style:{"background-color":n.color}}),t._v(" "),e("span",{staticClass:"tag-group__label",style:{color:n.color}},[t._v(t._s(n.displayName)+" ")])])})),t._v(" "),t.showMoveModal?e("MoveModal",{attrs:{account:t.account,envelopes:[t.data],"move-thread":!0},on:{move:t.onMove,close:t.onCloseMoveModal}}):t._e(),t._v(" "),t.showTagModal?e("TagModal",{attrs:{account:t.account,envelope:t.data},on:{close:t.onCloseTagModal}}):t._e()]},proxy:!0}])})}),[],!1,null,"97196126",null).exports),Et=a(1394),Mt={name:"EnvelopeList",components:{Actions:$.a,ActionButton:F.a,Envelope:Tt,MoveModal:mt},props:{account:{type:Object,required:!0},mailbox:{type:Object,required:!0},envelopes:{type:Array,required:!0},searchQuery:{type:String,required:!1,default:void 0},refreshing:{type:Boolean,required:!0,default:!0},loadingMore:{type:Boolean,required:!0},loadMoreButton:{type:Boolean,required:!1,default:!1}},data:()=>({selection:[],showMoveModal:!1,lastToggledIndex:void 0}),computed:{selectMode(){return this.selection.length>0},areAllSelectedRead(){return this.selectedEnvelopes.every(t=>!0===t.flags.seen)},areAllSelectedFavorite(){return this.selectedEnvelopes.every(t=>!0===t.flags.flagged)},selectedEnvelopes(){return this.envelopes.filter(t=>this.selection.includes(t.databaseId))}},watch:{envelopes(t,n){const e=t.map(t=>t.databaseId);this.selection=this.selection.filter(t=>e.includes(t)),Object(Et.a)((t,n)=>t.databaseId===n.databaseId,n,t).forEach(t=>{t.flags.selected=!1})}},mounted(){H.a.$on("envelopesDropped",this.unselectAll)},beforeDestroy(){H.a.$off("envelopesDropped",this.unselectAll)},methods:{isEnvelopeSelected(t){return 0!==this.selection.length&&this.selection.includes(t)},markSelectedSeenOrUnseen(){const t=!this.areAllSelectedRead;this.selectedEnvelopes.forEach(n=>{this.$store.dispatch("toggleEnvelopeSeen",{envelope:n,seen:t})}),this.unselectAll()},favoriteOrUnfavoriteAll(){const t=!this.areAllSelectedFavorite;this.selectedEnvelopes.forEach(n=>{this.$store.dispatch("markEnvelopeFavoriteOrUnfavorite",{envelope:n,favFlag:t})}),this.unselectAll()},async deleteAllSelected(){for(const n of this.selectedEnvelopes){if(n.databaseId===this.$route.params.threadId){const t=this.envelopes.indexOf(n);let e;e=0===t?this.envelopes[t+1]:this.envelopes[t-1],e&&this.$router.push({name:"message",params:{mailboxId:this.$route.params.mailboxId,threadId:e.databaseId}})}l.a.info("deleting thread ".concat(n.threadRootId));try{await this.$store.dispatch("deleteThread",{envelope:n})}catch(n){Object(N.b)(await Object(ct.a)(n,{[dt.a.getName()]:()=>t("mail","No trash mailbox configured"),default:n=>(l.a.error("could not delete message",n),t("mail","Could not delete message"))}))}}this.$store.dispatch("fetchNextEnvelopes",{mailboxId:this.mailbox.databaseId,query:this.searchQuery,quantity:this.selectedEnvelopes.length}),this.unselectAll()},setEnvelopeSelected(t,n){const e=this.selection.includes(t.databaseId);n&&!e?(t.flags.selected=!0,this.selection.push(t.databaseId)):!n&&e&&(t.flags.selected=!1,this.selection.splice(this.selection.indexOf(t.databaseId),1))},onEnvelopeSelectToggle(t,n,e){this.lastToggledIndex=n,this.setEnvelopeSelected(t,e)},onEnvelopeSelectMultiple(t,n){if(void 0===this.lastToggledIndex)return;const e=Math.min(this.lastToggledIndex,n),a=Math.max(this.lastToggledIndex,n),i=this.selection.includes(t.databaseId);for(let t=e;t<=a;t++)this.setEnvelopeSelected(this.envelopes[t],!i);this.lastToggledIndex=n},unselectAll(){this.envelopes.forEach(t=>{t.flags.selected=!1}),this.selection=[]},onOpenMoveModal(){this.showMoveModal=!0},async forwardSelectedAsAttachment(){const t=this.selection;this.$router.push({name:"message",params:{mailboxId:this.$route.params.mailboxId,threadId:"new"},query:{forwardedMessages:t}}),this.unselectAll()},onCloseMoveModal(){this.showMoveModal=!1,this.unselectAll()}}},St=a(1191),Dt={insert:"head",singleton:!1},Bt=(v()(St.a,Dt),St.a.locals,Object(b.a)(Mt,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("transition",{attrs:{name:"multiselect-header"}},[t.selectMode?e("div",{key:"multiselect-header",staticClass:"multiselect-header"},[e("div",{staticClass:"button primary",on:{click:function(n){return n.preventDefault(),t.markSelectedSeenOrUnseen.apply(null,arguments)}}},[e("span",{attrs:{id:"action-label"}},[t._v(t._s(t.areAllSelectedRead?t.n("mail","Mark {number} unread","Mark {number} unread",t.selection.length,{number:t.selection.length}):t.n("mail","Mark {number} read","Mark {number} read",t.selection.length,{number:t.selection.length})))])]),t._v(" "),e("Actions",{staticClass:"app-content-list-item-menu",attrs:{"menu-align":"right"}},[e("ActionButton",{attrs:{icon:"icon-starred","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.favoriteOrUnfavoriteAll.apply(null,arguments)}}},[t._v("\n\t\t\t\t\t"+t._s(t.areAllSelectedFavorite?t.n("mail","Unfavorite {number}","Unfavorite {number}",t.selection.length,{number:t.selection.length}):t.n("mail","Favorite {number}","Favorite {number}",t.selection.length,{number:t.selection.length}))+"\n\t\t\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-close","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.unselectAll.apply(null,arguments)}}},[t._v("\n\t\t\t\t\t"+t._s(t.n("mail","Unselect {number}","Unselect {number}",t.selection.length,{number:t.selection.length}))+"\n\t\t\t\t")]),t._v(" "),t.account.isUnified?t._e():e("ActionButton",{attrs:{icon:"icon-external","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onOpenMoveModal.apply(null,arguments)}}},[t._v("\n\t\t\t\t\t"+t._s(t.n("mail","Move {number} thread","Move {number} threads",t.selection.length,{number:t.selection.length}))+"\n\t\t\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-forward","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.forwardSelectedAsAttachment.apply(null,arguments)}}},[t._v("\n\t\t\t\t\t"+t._s(t.n("mail","Forward {number} as attachment","Forward {number} as attachment",t.selection.length,{number:t.selection.length}))+"\n\t\t\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-delete","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.deleteAllSelected.apply(null,arguments)}}},[t._v("\n\t\t\t\t\t"+t._s(t.n("mail","Delete {number} thread","Delete {number} threads",t.selection.length,{number:t.selection.length}))+"\n\t\t\t\t")])],1),t._v(" "),t.showMoveModal?e("MoveModal",{attrs:{account:t.account,envelopes:t.selectedEnvelopes,"move-thread":!0},on:{close:t.onCloseMoveModal}}):t._e()],1):t._e()]),t._v(" "),e("transition-group",{attrs:{name:"list"}},[e("div",{key:"loading",staticClass:"icon-loading-small",class:{refreshing:t.refreshing},attrs:{id:"list-refreshing"}}),t._v(" "),t._l(t.envelopes,(function(n,a){return e("Envelope",{key:n.databaseId,attrs:{data:n,mailbox:t.mailbox,selected:t.selection.includes(n.databaseId),"select-mode":t.selectMode,"selected-envelopes":t.selectedEnvelopes},on:{delete:function(e){return t.$emit("delete",n.databaseId)},"update:selected":function(e){return t.onEnvelopeSelectToggle.apply(void 0,[n,a].concat(e))},"select-multiple":function(e){return t.onEnvelopeSelectMultiple(n,a)}}})})),t._v(" "),t.loadMoreButton&&!t.loadingMore?e("div",{key:"list-collapse-"+t.searchQuery,staticClass:"load-more",on:{click:function(n){return t.$emit("loadMore")}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Load more"))+"\n\t\t")]):t._e(),t._v(" "),e("div",{key:"loadingMore",class:{"icon-loading-small":t.loadingMore},attrs:{id:"load-more-mail-messages"}})],2)],1)}),[],!1,null,"0c6cc3d8",null).exports),jt=a(1192),$t=a.n(jt);
/*
 * @copyright 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
const Ot=t=>t.reduce((function(t,n){let e="";return n.class?e+="  at "+n.class+"::"+n.function:e+="  at "+n.function,n.file&&(e+="\n     "+n.file+", line "+n.line),t+e+"\n"}),""),Ft=t=>{console.error(t);let n=t.message||"An unkown error occurred.";n.endsWith(".")||(n+=".");const e=(new $t.a).addEmptyStepsToReproduce().addExpectedActualBehaviour().addLogs("Error",(t=>{let n="";return t.type&&(n+=t.type+": "),n+=t.message,n+="\n",t.trace&&(n+=Ot(t.trace)),t.stack&&(n+=t.stack),n})(t)).render();return"https://github.com/nextcloud/mail/issues/new?title="+encodeURIComponent(n)+"&body="+encodeURIComponent(e)};var Nt={name:"Error",props:{error:{type:String,required:!0},message:{type:String,required:!0},data:{type:Object,default:()=>{}}},computed:{reportUrl(){return Ft(this.data)}}},Rt=Object(b.a)(Nt,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"emptycontent"},[e("h2",[t._v(t._s(t.error))]),t._v(" "),e("p",[t._v(t._s(t.message))]),t._v(" "),t.data&&t.data.debug?e("p",[e("a",{staticClass:"button",attrs:{href:t.reportUrl,target:"_blank",rel:"noopener"}},[t._v(t._s(t.t("mail","Report this bug")))])]):t._e()])}),[],!1,null,null,null).exports,qt=a(1402),Lt=a(653),Pt={name:"Loading",props:{hint:{type:String,default:"",required:!1},slowHint:{type:String,default:"",required:!1}},data:()=>({slow:!1,slowTimer:void 0}),mounted(){clearTimeout(this.slowTimer),this.slowTimer=setTimeout(()=>{this.slow=!0},3500)},beforeDestroy(){clearTimeout(this.slowTimer)}},zt=a(1193),Ut={insert:"head",singleton:!1},Gt=(v()(zt.a,Ut),zt.a.locals,Object(b.a)(Pt,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.hint?e("div",{staticClass:"emptycontent"},[e("a",{staticClass:"icon-loading"}),t._v(" "),e("h2",[t._v(t._s(t.hint))]),t._v(" "),e("transition",{attrs:{name:"fade"}},[t.slowHint&&t.slow?e("em",[t._v(t._s(t.slowHint))]):t._e()])],1):e("div",{staticClass:"container icon-loading"})}),[],!1,null,"5dce5c60",null).exports),Wt=a(127),Vt=a(307),Yt=a(547),Ht={name:"EmptyMailboxSection"},Qt=a(1194),Kt={insert:"head",singleton:!1},Jt=(v()(Qt.a,Kt),Qt.a.locals,{name:"Mailbox",components:{EmptyMailboxSection:Object(b.a)(Ht,(function(){var t=this,n=t.$createElement;return(t._self._c||n)("div",{attrs:{id:"emptycontent"}},[t._t("default",(function(){return[t._v(" "+t._s(t.t("mail","No messages")))]}))],2)}),[],!1,null,"4512145e",null).exports,EmptyMailbox:B,EnvelopeList:Bt,Error:Rt,Loading:Gt},mixins:[s.a],props:{account:{type:Object,required:!0},mailbox:{type:Object,required:!0},bus:{type:Object,required:!0},paginate:{type:String,default:"scroll"},initialPageSize:{type:Number,default:20},openFirst:{type:Boolean,default:!0},searchQuery:{type:String,required:!1,default:void 0},isPriorityInbox:{type:Boolean,required:!1,default:!1}},data:()=>({error:!1,refreshing:!1,loadingMore:!1,loadingEnvelopes:!0,loadingCacheInitialization:!1,loadMailboxInterval:void 0,expanded:!1,endReached:!1}),computed:{envelopes(){return this.$store.getters.getEnvelopes(this.mailbox.databaseId,this.searchQuery)},envelopesToShow(){return"manual"!==this.paginate||this.expanded?this.envelopes:this.envelopes.slice(0,5)},hasMessages(){return this.envelopes.length>0},showLoadMore(){return!this.endReached&&"manual"===this.paginate}},watch:{$route(t){if(void 0===t.params.threadId&&!this.isMobile){const t=this.envelopes[0];void 0!==t&&(l.a.debug("refreshing mailbox"),this.$route.params.mailboxId===this.account.draftsMailboxId?this.$router.replace({name:"message",params:{mailboxId:this.$route.params.mailboxId,filter:this.$route.params.filter?this.$route.params.filter:void 0,threadId:"new",draftId:t.databaseId}}):this.$router.replace({name:"message",params:{mailboxId:this.$route.params.mailboxId,filter:this.$route.params.filter?this.$route.params.filter:void 0,threadId:t.databaseId}}))}},account(){this.loadEnvelopes()},mailbox(){this.loadEnvelopes().then(()=>{l.a.debug("syncing mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,") after mailbox change")),this.sync(!1)})},searchQuery(){this.loadEnvelopes()}},created(){this.bus.$on("loadMore",this.onScroll),this.bus.$on("delete",this.onDelete),this.bus.$on("shortcut",this.handleShortcut),this.loadMailboxInterval=setInterval(this.loadMailbox,6e4)},async mounted(){this.loadEnvelopes().then(()=>{l.a.debug("syncing mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,") after mount")),this.sync(!1)})},destroyed(){this.bus.$off("loadMore",this.onScroll),this.bus.$off("delete",this.onDelete),this.bus.$off("shortcut",this.handleShortcut),this.stopInterval()},methods:{initializeCache(){this.loadingCacheInitialization=!0,this.error=!1,l.a.debug("syncing mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,") during cache initalization")),this.sync(!0).then(()=>(this.loadingCacheInitialization=!1,this.loadEnvelopes()))},async loadEnvelopes(){l.a.debug("Fetching envelopes for mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,")"),this.mailbox),this.loadingEnvelopes=!0,this.loadingCacheInitialization=!1,this.error=!1;try{const t=await this.$store.dispatch("fetchEnvelopes",{mailboxId:this.mailbox.databaseId,query:this.searchQuery,limit:this.initialPageSize});if(l.a.debug(t.length+" envelopes fetched",{envelopes:t}),this.loadingEnvelopes=!1,this.openFirst&&!this.isMobile&&"message"!==this.$route.name&&t.length>0){const n=t[0];l.a.debug("showing the first message of mailbox "+this.$route.params.mailboxId),this.$route.params.mailboxId===this.account.draftsMailboxId?this.$router.replace({name:"message",params:{mailboxId:this.$route.params.mailboxId,filter:this.$route.params.filter?this.$route.params.filter:void 0,threadId:"new",draftId:n.databaseId}}):this.$router.replace({name:"message",params:{mailboxId:this.$route.params.mailboxId,filter:this.$route.params.filter?this.$route.params.filter:void 0,threadId:n.databaseId}})}}catch(t){await Object(ct.a)(t,{[Wt.a.getName()]:async t=>{l.a.info("Mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,") is locked"),{error:t}),await Object(Yt.a)(15e3),await this.loadEnvelopes()},[Vt.a.getName()]:async t=>{l.a.info("Mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,") not cached. Triggering initialization"),{error:t}),this.loadingEnvelopes=!1;try{await this.initializeCache()}catch(t){l.a.error("Could not initialize cache of mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,")"),{error:t}),this.error=t}},default:t=>{l.a.error("Could not fetch envelopes of mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,")"),{error:t}),this.loadingEnvelopes=!1,this.error=t}})}},async loadMore(){if(!this.expanded)return l.a.debug("expanding envelope list"),void(this.expanded=!0);l.a.debug("fetching next envelope page"),this.loadingMore=!0;try{0===(await this.$store.dispatch("fetchNextEnvelopePage",{mailboxId:this.mailbox.databaseId,query:this.searchQuery})).length&&(l.a.info("envelope list end reached"),this.endReached=!0)}catch(t){l.a.error("could not fetch next envelope page",{error:t})}finally{this.loadingMore=!1}},async handleShortcut(n){const e=this.envelopes,a=parseInt(this.$route.params.threadId,10),i=e.find(t=>t.databaseId===a),o=e.indexOf(i);let r;switch("refresh"===n.srcKey||i||l.a.debug("envelope is not in the list, ignoring shortcut",{srcKey:n.srcKey}),n.srcKey){case"next":case"prev":if(r="next"===n.srcKey?e[o+1]:e[o-1],!r)return void l.a.debug("ignoring shortcut: head or tail of envelope list reached",{envelopes:e,idx:o,srcKey:n.srcKey});this.$router.push({name:"message",params:{mailboxId:this.$route.params.mailboxId,filter:this.$route.params.filter?this.$route.params.filter:void 0,threadId:r.databaseId}});break;case"del":l.a.debug("deleting",{env:i}),this.onDelete(i.databaseId);try{await this.$store.dispatch("deleteThread",{envelope:i})}catch(n){l.a.error("could not delete envelope",{env:i,error:n}),Object(N.b)(await Object(ct.a)(n,{[dt.a.getName()]:()=>t("mail","No trash mailbox configured"),default:()=>t("mail","Could not delete message")}))}break;case"flag":l.a.debug("flagging envelope via shortkey",{env:i}),this.$store.dispatch("toggleEnvelopeFlagged",i).catch(t=>l.a.error("could not flag envelope via shortkey",{env:i,error:t}));break;case"refresh":l.a.debug("syncing mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,") per shortcut")),this.sync(!1);break;case"unseen":l.a.debug("marking message as seen/unseen via shortkey",{env:i}),this.$store.dispatch("toggleEnvelopeSeen",{envelope:i}).catch(t=>l.a.error("could not mark envelope as seen/unseen via shortkey",{env:i,error:t}));break;default:l.a.warn("shortcut "+n.srcKey+" is unknown. ignoring.")}},async sync(t=!1){if(this.refreshing)l.a.debug("already sync'ing mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,"), aborting"),{init:t});else{this.refreshing=!0;try{await this.$store.dispatch("syncEnvelopes",{mailboxId:this.mailbox.databaseId,query:this.searchQuery,init:t})}catch(n){Object(ct.a)(n,{[Wt.a.getName()](n){l.a.info("Background sync failed because the mailbox is locked",{error:n,init:t})},default(n){l.a.error("Could not sync envelopes: "+n.message,{error:n,init:t})}})}finally{this.refreshing=!1,l.a.debug("finished sync'ing mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,")"),{init:t})}}},onDelete(t){this.$store.dispatch("fetchNextEnvelopes",{mailboxId:this.mailbox.databaseId,query:this.searchQuery,quantity:1});const n=Object(qt.a)(Object(Lt.a)("databaseId",t),this.envelopes);if(-1===n)return void l.a.debug("envelope to delete does not exist in envelope list");if(t!==this.$route.params.threadId)return void l.a.debug("other message open, not jumping to the next/previous message");const e=this.envelopes[0===n?n:n-1];e?this.$router.push({name:"message",params:{mailboxId:this.$route.params.mailboxId,filter:this.$route.params.filter?this.$route.params.filter:void 0,threadId:e.databaseId}}):l.a.debug("no next/previous envelope, not navigating")},onScroll(){"scroll"===this.paginate?this.loadMore():l.a.debug("ignoring scroll pagination")},async loadMailbox(){if(!this.account.isUnified&&"inbox"!==this.mailbox.specialRole)try{l.a.debug("syncing mailbox ".concat(this.mailbox.databaseId," (").concat(this.searchQuery,") in background")),await this.sync(!1)}catch(t){l.a.error("Background sync failed: "+t.message,{error:t})}},stopInterval(){clearInterval(this.loadMailboxInterval),this.loadMailboxInterval=void 0}}}),Xt=a(1195),Zt={insert:"head",singleton:!1},tn=(v()(Xt.a,Zt),Xt.a.locals,Object(b.a)(Jt,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.error?e("Error",{attrs:{error:t.t("mail","Could not open mailbox"),message:"",role:"alert"}}):t.loadingEnvelopes?e("Loading",{attrs:{hint:t.t("mail","Loading messages"),role:"alert"}}):t.loadingCacheInitialization?e("Loading",{attrs:{hint:t.t("mail","Loading messages"),"slow-hint":t.t("mail","Indexing your messages. This can take a bit longer for larger mailboxes.")}}):t.isPriorityInbox&&!t.hasMessages?e("EmptyMailboxSection",{key:"empty"}):t.hasMessages?e("EnvelopeList",{attrs:{account:t.account,mailbox:t.mailbox,"search-query":t.searchQuery,envelopes:t.envelopesToShow,refreshing:t.refreshing,"loading-more":t.loadingMore,"load-more-button":t.showLoadMore},on:{delete:t.onDelete,loadMore:t.loadMore}}):e("EmptyMailbox",{key:"empty"})}),[],!1,null,"73117de6",null).exports),nn=a(786),en=a.n(nn),an=a(1),on=a.n(an),rn=a(0),sn=a(36),ln=a(992),dn=a.n(ln),cn=a(994),pn=a.n(cn),mn=a(1198),An=a.n(mn),un=a(995),hn=a.n(un),gn=a(1199),vn=a.n(gn),fn=a(996),Cn=a.n(fn),bn=a(787),yn=a.n(bn),xn=a(997),wn=a.n(xn),kn=a(788),_n=a.n(kn),In=a(1202),Tn=a.n(In),En=a(40),Mn=a(789),Sn=a(526),Dn=a.n(Sn),Bn=a(1204),jn=a.n(Bn),$n=a(1206),On=a.n($n),Fn=a(1208),Nn=a(528);
/*
 * @copyright 2021 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2021 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
const Rn=a.n(Nn)()(t=>{on.a.defaults.headers["X-Requested-With"]="XMLHttpRequest";return Fn.getPatcher().patch("request",on.a),Fn.createClient(Object(rn.generateRemoteUrl)("dav/".concat(t,"/").concat(Object(En.getCurrentUser)().uid)))});
/*
 * @copyright 2020 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2020 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */async function qn(t){var n,e;const a=await Rn("files").stat(t,{data:'<?xml version="1.0"?>\n\t\t\t<d:propfind  xmlns:d="DAV:"\n\t\t\t\txmlns:oc="http://owncloud.org/ns">\n\t\t\t\t<d:prop>\n\t\t\t\t\t<oc:size />\n\t\t\t\t</d:prop>\n\t\t\t</d:propfind>',details:!0});return null==a||null===(n=a.data)||void 0===n||null===(e=n.props)||void 0===e?void 0:e.size}
/**
 * @copyright Copyright (c) 2019 Marco Ambrosini <marcoambrosini@pm.me>
 * @copyright Copyright (c) 2020 Gary Kim <gary@garykim.dev>
 *
 * @author Marco Ambrosini <marcoambrosini@pm.me>
 * @author Gary Kim <gary@garykim.dev>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 *
 */
/*
 * @copyright 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
function Ln(t,n,e){const a=Object(rn.generateUrl)("/apps/mail/api/messages/{id}/attachment/{attachmentId}",{id:t,attachmentId:n});return on.a.post(a,{targetPath:e})}var Pn={name:"ComposerAttachments",props:{value:{type:Array,required:!0},bus:{type:Object,required:!0},uploadSizeLimit:{type:Number,default:0}},data:()=>({uploading:!1,uploads:{}}),computed:{uploadProgress(){let t=0,n=0;for(const e in this.uploads)t+=this.uploads[e].uploaded,n+=this.uploads[e].total;return(t/n*100).toFixed(1)}},created(){this.bus.$on("onAddLocalAttachment",this.onAddLocalAttachment),this.bus.$on("onAddCloudAttachment",this.onAddCloudAttachment),this.bus.$on("onAddCloudAttachmentLink",this.onAddCloudAttachmentLink)},methods:{onAddLocalAttachment(){this.$refs.localAttachments.click()},emitNewAttachments(t){this.$emit("input",this.value.concat(t))},totalSizeOfUpload(){return Object.values(this.value).reduce((t,n)=>"local"===!n.type?t:t+n.size,0)},onLocalAttachmentSelected(t){this.uploading=!0,x.default.set(this,"uploads",{});const n=On()(Dn()("size"),Object.values(t.target.files)),e=n+this.totalSizeOfUpload();if(l.a.debug("checking upload size limit",{existingUploads:this.totalSizeOfUpload(),toUpload:n,limit:this.uploadSizeLimit,newTotal:e}),this.uploadSizeLimit&&e>this.uploadSizeLimit)return this.showAttachmentFileSizeWarning(t.target.files.length),void(this.uploading=!1);const a=t=>(n,e)=>{this.uploads[t].uploaded=e},i=Tn()(t=>(x.default.set(this.uploads,t.name,{total:t.size,uploaded:0}),((t,n)=>{const e=Object(rn.generateUrl)("/apps/mail/api/attachments"),a=new FormData,i={onUploadProgress:t=>n(t,t.loaded,t.total)};return a.append("attachment",t),on.a.post(e,a,i).then(t=>t.data).then(({id:n})=>({file:t,id:n}))})(t,a(t.name)).then(({file:t,id:n})=>{l.a.info("uploaded"),this.emitNewAttachments([{fileName:t.name,displayName:hn()("/",t.name),id:n,size:t.size,type:"local"}])})),t.target.files),o=Promise.all(i).catch(t=>l.a.error("could not upload all attachments",{error:t})).then(()=>this.uploading=!1);return this.$emit("upload",o),o},async onAddCloudAttachment(){const t=Object(N.a)(Object(sn.translate)("mail","Choose a file to add as attachment")).setMultiSelect(!0).build();try{const n=await t.pick(Object(sn.translate)("mail","Choose a file to add as attachment")),e=await Promise.all(n.map(qn)),a=jn()(e)+this.totalSizeOfUpload();if(this.uploadSizeLimit&&a>this.uploadSizeLimit)return void this.showAttachmentFileSizeWarning(n.length);this.emitNewAttachments(n.map((function(t){return{fileName:t,displayName:hn()("/",t),type:"cloud"}})))}catch(t){l.a.error("could not choose a file as attachment",{error:t})}},async onAddCloudAttachmentLink(){const n=Object(N.a)(Object(sn.translate)("mail","Choose a file to share as a link")).build();try{const e=await n.pick(Object(sn.translate)("mail","Choose a file to share as a link")),a=await async function(n,e){try{return(await on.a.post(Object(rn.generateOcsUrl)("apps/files_sharing/api/v1/",2)+"shares",{shareType:3,path:n,shareWith:e})).data.ocs.data.url}catch(n){throw n.response&&n.response.data&&n.response.data.ocs&&n.response.data.ocs.meta&&n.response.data.ocs.meta.message?(console.error("Error while sharing file: ".concat(n.response.data.ocs.meta.message||"Unknown error")),Object(N.b)(n.response.data.ocs.meta.message),n):(console.error("Error while sharing file: Unknown error"),Object(N.b)(t("mail","Error while sharing file")),n)}}(e,Object(En.getRequestToken)());this.appendToBodyAtCursor('<a href="'.concat(a,'">').concat(a,"</a>"))}catch(t){l.a.error("could not choose a file as attachment link",{error:t})}},showAttachmentFileSizeWarning(t){Object(N.e)(Object(sn.translatePlural)("mail","The attachment exceed the allowed attachments size of {size}. Please share the file via link instead.","The attachments exceed the allowed attachments size of {size}. Please share the files via link instead.",t,{size:Object(Mn.formatFileSize)(this.uploadSizeLimit)}))},onDelete(t){this.$emit("input",this.value.filter(n=>n!==t))},appendToBodyAtCursor(t){this.bus.$emit("appendToBodyAtCursor",t)}}},zn=a(1266),Un={insert:"head",singleton:!1},Gn=(v()(zn.a,Un),zn.a.locals,Object(b.a)(Pn,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"new-message-attachments"},[e("ul",[t._l(t.value,(function(n){return e("li",{key:n.id},[e("div",{staticClass:"new-message-attachment-name"},[t._v("\n\t\t\t\t"+t._s(n.displayName)+"\n\t\t\t")]),t._v(" "),e("div",{staticClass:"new-message-attachments-action svg icon-delete",on:{click:function(e){return t.onDelete(n)}}})])})),t._v(" "),t.uploading?e("li",{staticClass:"attachments-upload-progress"},[e("div",{class:{"icon-loading-small":t.uploading}}),t._v(" "),e("div",[t._v(t._s(t.uploading?t.t("mail","Uploading {percent}% …",{percent:t.uploadProgress}):""))])]):t._e()],2),t._v(" "),e("input",{ref:"localAttachments",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:t.onLocalAttachmentSelected}})])}),[],!1,null,"44ae67a0",null).exports);var Wn=a(1107);
/**
 * @copyright 2020 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2020 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
const Vn=t=>"plain"===t.format&&t.value.startsWith("-----BEGIN PGP MESSAGE-----");var Yn={name:"MailvelopeEditor",props:{value:{type:String,required:!0},recipients:{type:Array,required:!0},quotedText:{type:Object,required:!1,default:()=>{}},isReplyOrForward:{type:Boolean,default:!1}},data:()=>({editor:void 0}),async mounted(){var t;const n=!!this.quotedText&&Vn(this.quotedText),e=this.isReplyOrForward?null===(t=this.quotedText)||void 0===t?void 0:t.value:void 0;this.editor=await window.mailvelope.createEditorContainer("#mailvelope-composer",void 0,{quotedMail:n?e:void 0})},methods:{async pull(){const t=this.recipients.map(t=>t.email);l.a.info("encrypting message",{recipients:t});const n=await this.editor.encrypt(t);l.a.info("message encryted",{armored:n}),this.$emit("input",n)}}},Hn=a(1305),Qn={insert:"head",singleton:!1},Kn=(v()(Hn.a,Qn),Hn.a.locals,Object(b.a)(Yn,(function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"mailvelope-composer"}})}),[],!1,null,"1320c887",null).exports);
/*
 * @copyright 2020 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2020 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
let Jn;const Xn=async()=>Jn||(Jn=window.mailvelope,Jn?(l.a.debug("mailvelope found statically"),Jn):(l.a.debug("loading mailvelope dynamically"),Jn=await new Promise(t=>{window.addEventListener("mailvelope",()=>t(window.mailvelope),!1)}),l.a.debug("mailvelope found dynamically"),Jn));var Zn=a(309),te=a(308),ne=a(310);const ee=Cn()(t=>{const n=Object(rn.generateUrl)("/apps/mail/api/autoComplete?term={term}",{term:t});return on.a.get(n).then(t=>t.data)},500);x.default.use(vn.a);const ae=Object.seal({EDITING:0,UPLOADING:1,SENDING:2,ERROR:3,WARNING:4,FINISHED:5});var ie={name:"Composer",components:{MailvelopeEditor:Kn,Actions:$.a,ActionButton:F.a,ActionCheckbox:yn.a,ActionLink:wn.a,ComposerAttachments:Gn,Loading:Gt,Multiselect:_n.a,TextEditor:Wn.a},props:{fromAccount:{type:Number,default:()=>{}},to:{type:Array,default:()=>[]},cc:{type:Array,default:()=>[]},bcc:{type:Array,default:()=>[]},subject:{type:String,default:""},body:{type:Object,default:()=>Object(et.b)("")},draft:{type:Function,required:!0},send:{type:Function,required:!0},replyTo:{type:Object,required:!1,default:()=>{}},forwardFrom:{type:Object,required:!1,default:()=>{}}},data(){var t,n,e;let a=Object(et.d)(this.body).value;return 0===a.length&&(a="<p></p><p></p>"),{showCC:this.cc.length>0,selectedAlias:-1,autocompleteRecipients:this.to.concat(this.cc).concat(this.bcc),newRecipients:[],subjectVal:this.subject,bodyVal:a,attachments:[],noReply:this.to.some(t=>t.email.startsWith("noreply@")||t.email.startsWith("no-reply@")),draftsPromise:Promise.resolve(),attachmentsPromise:Promise.resolve(),canSaveDraft:!0,savingDraft:void 0,saveDraftDebounced:dn()(1e4,this.saveDraft),state:ae.EDITING,errorText:void 0,STATES:ae,selectTo:this.to,selectCc:this.cc,selectBcc:this.bcc,bus:new x.default,encrypt:!1,mailvelope:{available:!1,keyRing:void 0,keysMissing:[]},editorMode:"html",addShareLink:Object(sn.translate)("mail","Add share link from {productName} Files",{productName:null!==(t=null===(n=OC)||void 0===n||null===(e=n.theme)||void 0===e?void 0:e.name)&&void 0!==t?t:"Nextcloud"}),requestMdn:!1,appendSignature:!0}},computed:{aliases(){let t=0;return this.$store.getters.accounts.filter(t=>!t.isUnified).flatMap(n=>[{id:n.id,aliasId:null,selectId:t++,editorMode:n.editorMode,signature:n.signature,name:n.name,emailAddress:n.emailAddress,signatureAboveQuote:n.signatureAboveQuote},n.aliases.map(e=>({id:n.id,aliasId:e.id,selectId:t++,editorMode:n.editorMode,signature:e.signature,name:e.name,emailAddress:e.alias,signatureAboveQuote:n.signatureAboveQuote}))]).flat()},allRecipients(){return this.selectTo.concat(this.selectCc).concat(this.selectBcc)},attachmentSizeLimit(){return this.$store.getters.getPreference("attachment-size-limit")},selectableRecipients(){return this.newRecipients.concat(this.autocompleteRecipients).map(t=>({...t,label:t.label||t.email}))},isForward(){return void 0!==this.forwardFrom},isReply(){return void 0!==this.replyTo},canSend(){return(!this.encrypt||!this.mailvelope.keysMissing.length)&&(this.selectTo.length>0||this.selectCc.length>0||this.selectBcc.length>0)},editorPlainText(){return"plaintext"===this.editorMode},submitButtonTitle(){return this.mailvelope.available?this.encrypt?Object(sn.translate)("mail","Encrypt and send"):Object(sn.translate)("mail","Send unencrypted"):Object(sn.translate)("mail","Send")}},watch:{"$route.params.threadId"(){this.reset()},allRecipients(){this.checkRecipientsKeys()},aliases(t){if(console.debug("aliases changed"),-1===this.selectedAlias)return;const n=t.find(t=>t.id===this.selectedAlias.id&&t.aliasId===this.selectedAlias.aliasId);void 0===n?this.onAliasChange(t[0]):this.onAliasChange(n)}},async beforeMount(){this.setAlias(),this.initBody(),await this.onMailvelopeLoaded(await Xn())},mounted(){var t;this.isReply||this.$refs.toLabel.$el.focus(),this.$root.$on("newMessage",()=>{this.draftsPromise.then(()=>this.saveDraft(this.getMessageData)).then(()=>{this.reset()})}),void 0!==(null===(t=this.forwardFrom)||void 0===t?void 0:t.attachments)&&this.forwardFrom.attachments.forEach(t=>{this.attachments.push({fileName:t.fileName,displayName:hn()("/",t.fileName),id:t.id,messageId:this.forwardFrom.databaseId,type:"message-attachment"})});let n=[];this.$route.query.forwardedMessages&&!An()(this.$route.query.forwardedMessages)?n=[this.$route.query.forwardedMessages]:this.$route.query.forwardedMessages&&An()(this.$route.query.forwardedMessages)&&(n=this.$route.query.forwardedMessages),n.forEach(t=>{const n=this.$store.getters.getEnvelope(t);n?this.attachments.push({displayName:n.subject+".eml",id:t,type:"message"}):Object(N.b)(Object(sn.translate)("mail","Message {id} could not be found",{id:t}))})},beforeDestroy(){this.$root.$off("newMessage"),window.removeEventListener("mailvelope",this.onMailvelopeLoaded)},methods:{setAlias(){const t=this.selectedAlias;this.fromAccount?this.selectedAlias=this.aliases.find(t=>t.id===this.fromAccount):this.selectedAlias=this.aliases[0],-1===t&&(this.editorMode=this.selectedAlias.editorMode)},async checkRecipientsKeys(){if(!this.encrypt||!this.mailvelope.available)return;const t=this.allRecipients.map(t=>t.email),n=await this.mailvelope.keyRing.validKeyForAddress(t);l.a.debug("recipients keys validated",{recipients:t,keysValid:n}),this.mailvelope.keysMissing=t.filter(t=>!1===n[t])},initBody(){let t;t=this.replyTo?at(this.editorPlainText?Object(et.e)(this.body):Object(et.d)(this.body),this.replyTo.from[0],this.replyTo.dateInt,"top"===this.$store.getters.getPreference("reply-mode","top")).value:this.forwardFrom?at(this.editorPlainText?Object(et.e)(this.body):Object(et.d)(this.body),this.forwardFrom.from[0],this.forwardFrom.dateInt,"top"===this.$store.getters.getPreference("reply-mode","top")).value:this.bodyVal,this.bodyVal=Object(et.b)(t).value},recipientToRfc822:t=>t.email===t.label||""===t.label||0===t.email.search(/^[a-zA-Z]+:/)?t.email:'"'.concat(t.label,'" <').concat(t.email,">"),getMessageData(t){return{account:this.selectedAlias.id,aliasId:this.selectedAlias.aliasId,to:this.selectTo.map(this.recipientToRfc822).join(", "),cc:this.selectCc.map(this.recipientToRfc822).join(", "),bcc:this.selectBcc.map(this.recipientToRfc822).join(", "),draftId:t,subject:this.subjectVal,body:this.encrypt?Object(et.c)(this.bodyVal):Object(et.b)(this.bodyVal),attachments:this.attachments,messageId:this.replyTo?this.replyTo.databaseId:void 0,isHtml:!this.editorPlainText,requestMdn:this.requestMdn}},saveDraft(t){return this.savingDraft=!0,this.draftsPromise=this.draftsPromise.then(n=>{const e=t(n);return n||e.subject||e.body||e.cc||e.bcc||e.to?this.draft(e):(l.a.debug("Nothing substantial to save, ignoring draft save"),this.savingDraft=!1,n)}).then(t=>(this.canSaveDraft=!0,t)).catch(async t=>{console.error("could not save draft",t);await Object(ct.a)(t,{[te.a.getName()]:()=>!1,default:()=>!0})||(this.canSaveDraft=!1)}).then(t=>(this.savingDraft=!1,t)),this.draftsPromise},onInputChanged(){if(this.saveDraftDebounced(this.getMessageData),this.appendSignature){const t=Object(et.d)(Object(et.a)(this.selectedAlias.signature)).value;this.bus.$emit("insertSignature",t,this.selectedAlias.signatureAboveQuote),this.appendSignature=!1}},onAliasChange(t){l.a.debug("changed alias",{alias:t}),this.selectedAlias=t,this.appendSignature=!0,this.onInputChanged()},onAddLocalAttachment(){this.bus.$emit("onAddLocalAttachment")},onAddCloudAttachment(){this.bus.$emit("onAddCloudAttachment")},onAddCloudAttachmentLink(){this.bus.$emit("onAddCloudAttachmentLink")},onAutocomplete(t){void 0!==t&&""!==t&&ee(t).then(t=>{this.autocompleteRecipients=pn()("email")(this.autocompleteRecipients.concat(t))})},onAttachmentsUploading(t){this.attachmentsPromise=this.attachmentsPromise.then(()=>t).catch(t=>l.a.error("could not upload attachments",{error:t})).then(()=>l.a.debug("attachments uploaded"))},async onMailvelopeLoaded(t){this.encrypt=Vn(this.body),this.mailvelope.available=!0,l.a.info("Mailvelope loaded",{encrypt:this.encrypt,isPgpgMessage:Vn(this.body),keyRing:this.mailvelope.keyRing}),this.mailvelope.keyRing=await t.getKeyring(),await this.checkRecipientsKeys()},onNewToAddr(t){this.onNewAddr(t,this.selectTo)},onNewCcAddr(t){this.onNewAddr(t,this.selectCc)},onNewBccAddr(t){this.onNewAddr(t,this.selectBcc)},onNewAddr(t,n){const e={label:t,email:t};this.newRecipients.push(e),n.push(e)},async onSend(t,n=!1){this.encrypt&&(l.a.debug("get encrypted message from mailvelope"),await this.$refs.mailvelopeEditor.pull()),this.state=ae.UPLOADING,await this.attachmentsPromise.then(()=>this.state=ae.SENDING).then(()=>this.draftsPromise).then(this.getMessageData).then(t=>this.send({...t,force:n})).then(()=>l.a.info("message sent")).then(()=>this.state=ae.FINISHED).catch(async t=>{l.a.error("could not send message",{error:t}),[this.errorText,this.state]=await Object(ct.a)(t,{[Zn.a.getName()]:()=>[Object(sn.translate)("mail","No sent mailbox configured. Please pick one in the account settings."),ae.ERROR],[ne.a.getName()]:()=>[Object(sn.translate)("mail","You are trying to send to many recipients in To and/or Cc. Consider using Bcc to hide recipient addresses."),ae.WARNING],default(t){if(t&&t.toString)return[t.toString(),ae.ERROR]}})});const e=this.$store.getters.getAccount(this.selectedAlias.id);parseInt(this.$route.params.mailboxId,10)===e.sentMailboxId&&setTimeout(()=>{this.$store.dispatch("syncEnvelopes",{mailboxId:e.sentMailboxId,query:"",init:!1})},500)},async onForceSend(){await this.onSend(null,!0)},reset(){this.draftsPromise=Promise.resolve(),this.selectTo=[],this.selectCc=[],this.selectBcc=[],this.subjectVal="",this.bodyVal="<p></p><p></p>",this.attachments=[],this.errorText=void 0,this.state=ae.EDITING,this.autocompleteRecipients=[],this.newRecipients=[],this.requestMdn=!1,this.appendSignature=!0,this.setAlias(),this.initBody(),x.default.nextTick(()=>{this.$refs.toLabel.$el.focus()})},formatAliases:t=>t.name?"".concat(t.name," <").concat(t.emailAddress,">"):t.emailAddress}},oe=a(1306),re={insert:"head",singleton:!1},se=(v()(oe.a,re),oe.a.locals,Object(b.a)(ie,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.state===t.STATES.EDITING?e("div",{staticClass:"message-composer"},[e("div",{staticClass:"composer-fields mail-account"},[e("label",{staticClass:"from-label",attrs:{for:"from"}},[t._v("\n\t\t\t"+t._s(t.t("mail","From"))+"\n\t\t")]),t._v(" "),e("Multiselect",{attrs:{id:"from",value:t.selectedAlias,options:t.aliases,label:"name","track-by":"selectId",searchable:!1,"custom-label":t.formatAliases,placeholder:t.t("mail","Select account"),"clear-on-select":!1},on:{select:t.onAliasChange}})],1),t._v(" "),e("div",{staticClass:"composer-fields"},[e("label",{staticClass:"to-label",attrs:{for:"to"}},[t._v("\n\t\t\t"+t._s(t.t("mail","To"))+"\n\t\t")]),t._v(" "),e("Multiselect",{ref:"toLabel",attrs:{id:"to",options:t.selectableRecipients,taggable:!0,label:"label","track-by":"email",limit:4,multiple:!0,placeholder:t.t("mail","Contact or email address …"),"clear-on-select":!1,"close-on-select":!1,"show-no-options":!1,"preserve-search":!0,"hide-selected":!0},on:{keyup:t.onInputChanged,tag:t.onNewToAddr,"search-change":t.onAutocomplete},model:{value:t.selectTo,callback:function(n){t.selectTo=n},expression:"selectTo"}}),t._v(" "),t.showCC?t._e():e("a",{staticClass:"copy-toggle",attrs:{href:"#"},on:{click:function(n){n.preventDefault(),t.showCC=!0}}},[t._v("\n\t\t\t"+t._s(t.t("mail","+ Cc/Bcc"))+"\n\t\t")])],1),t._v(" "),t.showCC?e("div",{staticClass:"composer-fields"},[e("label",{staticClass:"cc-label",attrs:{for:"cc"}},[t._v("\n\t\t\t"+t._s(t.t("mail","Cc"))+"\n\t\t")]),t._v(" "),e("Multiselect",{attrs:{id:"cc",options:t.selectableRecipients,taggable:!0,label:"label","track-by":"email",multiple:!0,placeholder:t.t("mail",""),"clear-on-select":!1,"show-no-options":!1,"preserve-search":!0},on:{keyup:t.onInputChanged,tag:t.onNewCcAddr,"search-change":t.onAutocomplete},model:{value:t.selectCc,callback:function(n){t.selectCc=n},expression:"selectCc"}},[e("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v(t._s(t.t("mail","No contacts found.")))])])],1):t._e(),t._v(" "),t.showCC?e("div",{staticClass:"composer-fields"},[e("label",{staticClass:"bcc-label",attrs:{for:"bcc"}},[t._v("\n\t\t\t"+t._s(t.t("mail","Bcc"))+"\n\t\t")]),t._v(" "),e("Multiselect",{attrs:{id:"bcc",options:t.selectableRecipients,taggable:!0,label:"label","track-by":"email",multiple:!0,placeholder:t.t("mail",""),"show-no-options":!1,"preserve-search":!0},on:{keyup:t.onInputChanged,tag:t.onNewBccAddr,"search-change":t.onAutocomplete},model:{value:t.selectBcc,callback:function(n){t.selectBcc=n},expression:"selectBcc"}},[e("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v(t._s(t.t("mail","No contacts found.")))])])],1):t._e(),t._v(" "),e("div",{staticClass:"composer-fields"},[e("label",{staticClass:"subject-label hidden-visually",attrs:{for:"subject"}},[t._v("\n\t\t\t"+t._s(t.t("mail","Subject"))+"\n\t\t")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.subjectVal,expression:"subjectVal"}],staticClass:"subject",attrs:{id:"subject",type:"text",name:"subject",autocomplete:"off",placeholder:t.t("mail","Subject …")},domProps:{value:t.subjectVal},on:{keyup:t.onInputChanged,input:function(n){n.target.composing||(t.subjectVal=n.target.value)}}})]),t._v(" "),t.noReply?e("div",{staticClass:"warning noreply-warning"},[t._v("\n\t\t"+t._s(t.t("mail","This message came from a noreply address so your reply will probably not be read."))+"\n\t")]):t._e(),t._v(" "),t.mailvelope.keysMissing.length?e("div",{staticClass:"warning noreply-warning"},[t._v("\n\t\t"+t._s(t.t("mail","The following recipients do not have a PGP key: {recipients}.",{recipients:t.mailvelope.keysMissing.join(", ")}))+"\n\t")]):t._e(),t._v(" "),e("div",{staticClass:"composer-fields"},[!t.encrypt&&t.editorPlainText?e("TextEditor",{key:"editor-plain",staticClass:"message-body",attrs:{name:"body",placeholder:t.t("mail","Write message …"),focus:t.isReply,bus:t.bus},on:{input:t.onInputChanged},model:{value:t.bodyVal,callback:function(n){t.bodyVal=n},expression:"bodyVal"}}):t.encrypt||t.editorPlainText?e("MailvelopeEditor",{ref:"mailvelopeEditor",attrs:{recipients:t.allRecipients,"quoted-text":t.body,"is-reply-or-forward":t.isReply||t.isForward},model:{value:t.bodyVal,callback:function(n){t.bodyVal=n},expression:"bodyVal"}}):e("TextEditor",{key:"editor-rich",staticClass:"message-body",attrs:{html:!0,name:"body",placeholder:t.t("mail","Write message …"),focus:t.isReply,bus:t.bus},on:{input:t.onInputChanged},model:{value:t.bodyVal,callback:function(n){t.bodyVal=n},expression:"bodyVal"}})],1),t._v(" "),e("div",{staticClass:"composer-actions"},[e("ComposerAttachments",{attrs:{bus:t.bus,"upload-size-limit":t.attachmentSizeLimit},on:{upload:t.onAttachmentsUploading},model:{value:t.attachments,callback:function(n){t.attachments=n},expression:"attachments"}}),t._v(" "),e("div",{staticClass:"composer-actions-right"},[e("p",{staticClass:"composer-actions-draft"},[t.canSaveDraft?!0===t.savingDraft?e("span",{attrs:{id:"draft-status"}},[t._v(t._s(t.t("mail","Saving draft …")))]):!1===t.savingDraft?e("span",{attrs:{id:"draft-status"}},[t._v(t._s(t.t("mail","Draft saved")))]):t._e():e("span",{attrs:{id:"draft-status"}},[t._v(t._s(t.t("mail","Cannot save draft because this account does not have a drafts mailbox configured.")))])]),t._v(" "),e("Actions",[e("ActionButton",{attrs:{icon:"icon-upload"},on:{click:t.onAddLocalAttachment}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mail","Upload attachment"))+"\n\t\t\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-folder"},on:{click:t.onAddCloudAttachment}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mail","Add attachment from Files"))+"\n\t\t\t\t")]),t._v(" "),e("ActionButton",{attrs:{disabled:t.encrypt,icon:"icon-public"},on:{click:t.onAddCloudAttachmentLink}},[t._v("\n\t\t\t\t\t"+t._s(t.addShareLink)+"\n\t\t\t\t")]),t._v(" "),e("ActionCheckbox",{attrs:{checked:!t.encrypt&&!t.editorPlainText,disabled:t.encrypt},on:{check:function(n){t.editorMode="html"},uncheck:function(n){t.editorMode="plaintext"}}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mail","Enable formatting"))+"\n\t\t\t\t")]),t._v(" "),e("ActionCheckbox",{attrs:{checked:t.requestMdn},on:{check:function(n){t.requestMdn=!0},uncheck:function(n){t.requestMdn=!1}}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mail","Request a read receipt"))+"\n\t\t\t\t")]),t._v(" "),t.mailvelope.available?e("ActionCheckbox",{attrs:{checked:t.encrypt},on:{check:function(n){t.encrypt=!0},uncheck:function(n){t.encrypt=!1}}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mail","Encrypt message with Mailvelope"))+"\n\t\t\t\t")]):e("ActionLink",{attrs:{href:"https://www.mailvelope.com/",target:"_blank",icon:"icon-password"}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mail","Looking for a way to encrypt your emails? Install the Mailvelope browser extension!"))+"\n\t\t\t\t")])],1),t._v(" "),e("div",[e("input",{staticClass:"submit-message send primary icon-confirm-white",attrs:{type:"submit",disabled:!t.canSend},domProps:{value:t.submitButtonTitle},on:{click:t.onSend}})])],1)],1)]):t.state===t.STATES.UPLOADING?e("Loading",{attrs:{hint:t.t("mail","Uploading attachments …"),role:"alert"}}):t.state===t.STATES.SENDING?e("Loading",{attrs:{hint:t.t("mail","Sending …"),role:"alert"}}):t.state===t.STATES.ERROR?e("div",{staticClass:"emptycontent",attrs:{role:"alert"}},[e("h2",[t._v(t._s(t.t("mail","Error sending your message")))]),t._v(" "),t.errorText?e("p",[t._v("\n\t\t"+t._s(t.errorText)+"\n\t")]):t._e(),t._v(" "),e("button",{staticClass:"button",on:{click:function(n){t.state=t.STATES.EDITING}}},[t._v("\n\t\t"+t._s(t.t("mail","Go back"))+"\n\t")]),t._v(" "),e("button",{staticClass:"button primary",on:{click:t.onSend}},[t._v("\n\t\t"+t._s(t.t("mail","Retry"))+"\n\t")])]):t.state===t.STATES.WARNING?e("div",{staticClass:"emptycontent",attrs:{role:"alert"}},[e("h2",[t._v(t._s(t.t("mail","Warning sending your message")))]),t._v(" "),t.errorText?e("p",[t._v("\n\t\t"+t._s(t.errorText)+"\n\t")]):t._e(),t._v(" "),e("button",{staticClass:"button primary",on:{click:function(n){t.state=t.STATES.EDITING}}},[t._v("\n\t\t"+t._s(t.t("mail","Go back"))+"\n\t")]),t._v(" "),e("button",{staticClass:"button",on:{click:t.onForceSend}},[t._v("\n\t\t"+t._s(t.t("mail","Send anyway"))+"\n\t")])]):e("div",{staticClass:"emptycontent"},[e("h2",[t._v(t._s(t.t("mail","Message sent!")))]),t._v(" "),t.isReply?t._e():e("button",{staticClass:"button primary",on:{click:t.reset}},[t._v("\n\t\t"+t._s(t.t("mail","Write another message"))+"\n\t")])])}),[],!1,null,"ee7216e4",null).exports);const le=[":-(",":-/",":-\\",":-|",":'-(",":'-/",":'-\\",":'-|"],de=()=>le[Math.floor(Math.random()*le.length)],ce=()=>{const t=[Object(sn.translate)("mail","Could not load your message"),Object(sn.translate)("mail","Could not load the desired message"),Object(sn.translate)("mail","Could not load the message")];return t[Math.floor(Math.random()*t.length)]+" "+de()};var pe=a(29),me={name:"NewMessageDetail",components:{AppContentDetails:en.a,Composer:se,Error:Rt,Loading:Gt},data:()=>({loading:!1,draft:void 0,original:void 0,originalBody:void 0,errorMessage:"",error:void 0,newDraftId:void 0}),computed:{composerData(){if(void 0!==this.draft)return l.a.info("todo: handle draft data",{draft:this.draft}),{to:this.draft.to,cc:this.draft.cc,bcc:this.draft.bcc,subject:this.draft.subject,body:this.draft.hasHtmlBody?Object(et.b)(this.draft.body):Object(et.c)(this.draft.body)};if(void 0!==this.$route.query.messageId){const n=this.original;if(l.a.debug("forwarding or replying to message",{message:n}),"reply"===this.$route.params.threadId)return l.a.debug("simple reply",{message:n}),{accountId:n.accountId,to:n.from,cc:[],subject:st(n.subject),body:this.originalBody,originalBody:this.originalBody,replyTo:n};if("replyAll"===this.$route.params.threadId){l.a.debug("replying to all",{original:this.original});const t=this.$store.getters.getAccount(n.accountId),e=ot(n,{email:t.emailAddress,label:t.name});return{accountId:n.accountId,to:e.to,cc:e.cc,subject:st(n.subject),body:this.originalBody,originalBody:this.originalBody,replyTo:n}}return"asNew"===this.$route.params.threadId?(l.a.debug("composing as new",{original:this.original}),this.original.attachments.length&&Object(N.e)(Object(sn.translate)("mail","Attachments were not copied. Please add them manually.")),{accountId:n.accountId,to:n.to,cc:n.cc,subject:n.subject,body:this.originalBody,originalBody:this.originalBody}):{accountId:n.accountId,to:[],cc:[],subject:(t=n.subject,lt.some(n=>t.toLowerCase().startsWith("".concat(n,":")))?t:"Fwd: ".concat(t)),body:this.originalBody,originalBody:this.originalBody,forwardFrom:n}}{let t;return l.a.debug("composing a new message or handling a mailto link",{threadId:this.$route.params.threadId}),0!==this.$route.params.accountId&&"0"!==this.$route.params.accountId&&(t=parseInt(this.$route.params.accountId,10)),{accountId:t,to:this.stringToRecipients(this.$route.query.to),cc:this.stringToRecipients(this.$route.query.cc),subject:this.$route.query.subject||"",body:this.$route.query.body?Object(et.a)(this.$route.query.body):Object(et.b)("")}}var t}},watch:{$route(t,n){var e,a;"message"!==t.name||!this.draft||t.params.draftId!==parseInt(this.draft.databaseId,10)&&t.params.draftId!==this.newDraftId?(l.a.debug("the  draft ID changed, we have to fetch the draft",{currentId:null!==(e=null==this||null===(a=this.draft)||void 0===a?void 0:a.databaseId)&&void 0!==e?e:"no draft currently loaded",newId:t.params.draftId}),this.fetchMessage()):l.a.debug("detected navigation to current (new) draft UID, not reloading")}},created(){this.fetchMessage()},methods:{stringToRecipients:t=>void 0===t?[]:[{label:t,email:t}],fetchMessage(){return void 0!==this.$route.params.draftId?this.fetchDraftMessage(this.$route.params.draftId):void 0!==this.$route.query.messageId?this.fetchOriginalMessage(this.$route.query.messageId):void 0},fetchDraftMessage(t){this.loading=!0,this.draft=void 0,this.error=void 0,this.errorMessage="",this.$store.dispatch("fetchMessage",t).then(n=>{if(n.databaseId===parseInt(this.$route.params.draftId,10)){if(this.draft=n,void 0===this.draft)return l.a.info("draft could not be found",{id:t}),this.errorMessage=ce(),void(this.loading=!1);this.loading=!1}else l.a.debug("User navigated away, loaded draft won't be shown",{draft:n,draftId:this.$route.params.draftId})}).catch(n=>{l.a.error("could not load draft ".concat(t),{error:n}),n.isError&&(this.errorMessage=Object(sn.translate)("mail","Could not load your draft"),this.error=n,this.loading=!1)})},async fetchOriginalMessage(t){this.loading=!0,this.error=void 0,this.errorMessage="",l.a.debug("fetching original message ".concat(t));try{const n=await this.$store.dispatch("fetchMessage",t);if(n.databaseId!==parseInt(this.$route.query.messageId,10))return void l.a.debug("User navigated away, loaded original message won't be used",{message:n,messageId:n.databaseId,urlId:this.$route.query.messageId});l.a.debug("original message fetched",{message:n}),this.original=n;let e=Object(et.c)(n.body||"");if(n.hasHtmlBody){l.a.debug("original message has HTML body");const n=await on.a.get(Object(rn.generateUrl)("/apps/mail/api/messages/{id}/html?plain=true",{id:t}));e=Object(et.b)(n.data)}this.originalBody=e}catch(n){l.a.error("could not load original message "+t,{error:n}),n.isError&&(this.errorMessage=Object(sn.translate)("mail","Could not load original message"),this.error=n,this.loading=!1)}finally{this.loading=!1}},async saveDraft(t){void 0===t.draftId&&this.draft&&(l.a.debug("draft data does not have a draftId, adding one",{draft:this.draft,data:t,id:this.draft.databaseId}),t.draftId=this.draft.databaseId);const n={...t,body:t.isHtml?t.body.value:Object(et.e)(t.body).value},{id:e}=await Object(pe.j)(t.account,n);this.$store.commit("removeEnvelope",{id:t.draftId}),this.$store.commit("removeMessage",{id:t.draftId}),await this.$store.dispatch("fetchEnvelope",e);const a=this.$store.getters.getAccount(t.account);return parseInt(this.$route.params.mailboxId,10)===a.draftsMailboxId&&(this.newDraftId=e,this.$router.replace({to:"message",params:{mailboxId:this.$route.params.mailboxId,threadId:this.$route.params.threadId,draftId:e}})),e},async sendMessage(t){l.a.debug("sending message",{data:t});const n={...t,body:t.isHtml?t.body.value:Object(et.e)(t.body).value};await Object(pe.l)(t.account,n),this.$store.commit("removeEnvelope",{id:t.draftId}),this.$store.commit("removeMessage",{id:t.draftId})}}},Ae=Object(b.a)(me,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("AppContentDetails",[t.loading?e("Loading"):t.error?e("Error",{attrs:{error:t.error&&t.error.message?t.error.message:t.t("mail","Not found"),message:t.errorMessage,data:t.error,role:"alert"}}):e("Composer",{attrs:{"from-account":t.composerData.accountId,to:t.composerData.to,cc:t.composerData.cc,bcc:t.composerData.bcc,subject:t.composerData.subject,body:t.composerData.body,draft:t.saveDraft,send:t.sendMessage,"reply-to":t.composerData.replyTo,"forward-from":t.composerData.forwardFrom}})],1)}),[],!1,null,null,null).exports,ue={name:"NoMessageSelected",components:{AppContentDetails:en.a}},he=a(1307),ge={insert:"head",singleton:!1},ve=(v()(he.a,ge),he.a.locals,Object(b.a)(ue,(function(){var t=this.$createElement,n=this._self._c||t;return n("AppContentDetails",[n("div",{staticClass:"icon icon-mail"}),this._v(" "),n("h2",[this._v(this._s(this.t("mail","No message selected")))]),this._v(" "),n("p")])}),[],!1,null,"0f812b2d",null).exports),fe=a(1403),Ce=a(654),be=a(1308),ye=a.n(be),xe=a(527);
/*
 * @copyright 2021 Kristian Lebold <kristian@lebold.info>
 *
 * @author 2021 Kristian Lebold <kristian@lebold.info>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
const we=Cn()(t=>{const n=Object(rn.generateUrl)("/apps/mail/api/contactIntegration/autoComplete/{term}",{term:t});return on.a.get(n).then(t=>t.data)},500),ke=Object.freeze({new:1,existing:2,select:3});var _e={name:"RecipientBubble",components:{UserBubble:ye.a,Popover:u.a,Multiselect:_n.a},props:{email:{type:String,required:!0},label:{type:String,required:!0}},data:()=>({avatarUrl:void 0,loadingContacts:!1,contactsWithEmail:[],autoCompleteContacts:[],selectedContact:"",newContactName:"",ContactSelectionStateEnum:ke,selection:ke.select,isContactPopoverOpen:!1}),computed:{avatarUrlAbsolute(){if(this.avatarUrl)return this.avatarUrl.startsWith("http")?this.avatarUrl:window.location.protocol+"//"+window.location.host+Object(rn.generateUrl)(this.avatarUrl)},selectableContacts(){return this.autoCompleteContacts.map(t=>({...t,label:t.label}))},contactsWithEmailComputed(){let t="";return this.contactsWithEmail&&this.contactsWithEmail.length>3&&(t=" + ".concat(this.contactsWithEmail.length-3)),this.contactsWithEmail.slice(0,3).map(t=>t.label).join(", ").concat(t)},addButtonDisabled(){return!(this.selection===ke.existing&&this.selectedContact||this.selection===ke.new&&""!==this.newContactName.trim())}},async mounted(){try{this.avatarUrl=await Object(xe.a)(this.email)}catch(t){console.debug("no avatar for "+this.email,{error:t})}this.newContactName=this.label},methods:{onClickReply(){this.$router.push({name:"message",params:{mailboxId:"priority",threadId:"new"},query:{to:this.email}})},onClickOpenContactDialog(){0===this.contactsWithEmail.length&&(t=>{const n=Object(rn.generateUrl)("/apps/mail/api/contactIntegration/match/{mail}",{mail:t});return on.a.get(n).then(t=>t.data)})(this.email).then(t=>{t&&t.length>0&&(this.contactsWithEmail=t)})},onClickAddToContact(){this.selection===ke.new?""!==this.newContactName&&((t,n)=>{const e=Object(rn.generateUrl)("/apps/mail/api/contactIntegration/new");return on.a.put(e,{contactName:t,mail:n}).then(t=>t.data)})(this.newContactName.trim(),this.email).then(t=>console.debug("ContactIntegration",t)):this.selection===ke.existing&&this.selectedContact&&((t,n)=>{const e=Object(rn.generateUrl)("/apps/mail/api/contactIntegration/add");return on.a.put(e,{uid:t,mail:n}).then(t=>t.data)})(this.selectedContact.id,this.email).then(t=>console.debug("ContactIntegration",t))},onAutocomplete(t){void 0!==t&&""!==t&&we(t).then(t=>{this.autoCompleteContacts=pn()("id")(this.autoCompleteContacts.concat(t))})}}},Ie=a(1309),Te={insert:"head",singleton:!1},Ee=(v()(Ie.a,Te),Ie.a.locals,Object(b.a)(_e,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("Popover",{staticClass:"contact-popover",attrs:{trigger:"click"}},[e("UserBubble",{attrs:{slot:"trigger","display-name":t.label,"avatar-image":t.avatarUrlAbsolute},on:{click:t.onClickOpenContactDialog},slot:"trigger"},[e("span",{staticClass:"user-bubble-email"},[t._v(t._s(t.email))])]),t._v(" "),e("div",{staticClass:"contact-wrapper"},[t.contactsWithEmail&&t.contactsWithEmail.length>0?e("div",{staticClass:"contact-existing"},[e("span",{staticClass:"icon-details"},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Contacts with this address"))+":\n\t\t\t")]),t._v(" "),e("span",[t._v("\n\t\t\t\t"+t._s(t.contactsWithEmailComputed)+"\n\t\t\t")])]):t._e(),t._v(" "),t.selection===t.ContactSelectionStateEnum.select?e("div",[e("a",{staticClass:"icon-reply",on:{click:t.onClickReply}},[e("span",{staticClass:"action-label"},[t._v(t._s(t.t("mail","Reply")))])]),t._v(" "),e("a",{staticClass:"icon-user",on:{click:function(n){t.selection=t.ContactSelectionStateEnum.existing}}},[e("span",{staticClass:"action-label"},[t._v(t._s(t.t("mail","Add to Contact")))])]),t._v(" "),e("a",{staticClass:"icon-add",on:{click:function(n){t.selection=t.ContactSelectionStateEnum.new}}},[e("span",{staticClass:"action-label"},[t._v(t._s(t.t("mail","New Contact")))])])]):e("div",{staticClass:"contact-input-wrapper"},[t.selection===t.ContactSelectionStateEnum.existing?e("Multiselect",{ref:"contact-selection-label",attrs:{id:"contact-selection",options:t.selectableContacts,taggable:!0,label:"label","track-by":"label",multiple:!1,placeholder:t.t("name","Contact name …"),"clear-on-select":!1,"show-no-options":!1,"preserve-search":!0},on:{"search-change":t.onAutocomplete},model:{value:t.selectedContact,callback:function(n){t.selectedContact=n},expression:"selectedContact"}}):t.selection===t.ContactSelectionStateEnum.new?e("input",{directives:[{name:"model",rawName:"v-model",value:t.newContactName,expression:"newContactName"}],domProps:{value:t.newContactName},on:{input:function(n){n.target.composing||(t.newContactName=n.target.value)}}}):t._e()],1),t._v(" "),t.selection!==t.ContactSelectionStateEnum.select?e("div",[e("a",{staticClass:"icon-close",attrs:{type:"button"},on:{click:function(n){t.selection=t.ContactSelectionStateEnum.select}}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Go back"))+"\n\t\t\t")]),t._v(" "),e("a",{directives:[{name:"close-popover",rawName:"v-close-popover"}],staticClass:"icon-checkmark",attrs:{disabled:t.addButtonDisabled,type:"button"},on:{click:t.onClickAddToContact}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Add"))+"\n\t\t\t")])]):t._e()])],1)}),[],!1,null,"7f075410",null).exports),Me=a(1310),Se=a.n(Me),De=a(770),Be=a.n(De);const je=t=>{var n;let e=null==t||null===(n=t.acl)||void 0===n?void 0:n.ace;if(!e)return!1;Array.isArray(e)||(e=[e]);for(const t of e){var a,i;if(void 0!==(null===(a=t.grant)||void 0===a||null===(i=a.privilege)||void 0===i?void 0:i.write))return!0}return!1},$e=t=>({displayname:t.props.displayname,order:t.props["calendar-order"],components:{vevent:!0},writable:je(t.props),url:Object(rn.generateRemoteUrl)("dav/calendars/".concat(Object(En.getCurrentUser)().uid).concat(t.filename,"/"))}),Oe=async()=>(await Rn("calendars").getDirectoryContents("/",{data:'<?xml version="1.0"?>\n<d:propfind  xmlns:d="DAV:" xmlns:c="urn:ietf:params:xml:ns:caldav" xmlns:aapl="http://apple.com/ns/ical/" xmlns:oc="http://owncloud.org/ns" xmlns:cs="http://calendarserver.org/ns/">\n  <d:prop>\n    <d:displayname />\n    <c:calendar-description />\n    <c:calendar-timezone />\n    <aapl:calendar-order />\n    <c:supported-calendar-component-set />\n    <oc:calendar-enabled />\n    <d:acl />\n    <d:owner />\n    <oc:invite />\n  </d:prop>\n</d:propfind>',details:!0})).data.map($e).filter(t=>t.components.vevent&&!0===t.writable),Fe=()=>{let t="";for(let n=0;n<7;n++)t+=Math.random().toString(36).substring(7);return t},Ne=()=>{const t=new Be.a.Component(["vcalendar",[],[]]);return t.updatePropertyWithValue("prodid","-//"+OC.theme.name+" Mail"),t},Re=t=>n=>{l.a.debug("importing events into calendar",{url:t,data:n});const e=[],a=(t=>{const n=[],e={},a=Be.a.parse(t),i=new Be.a.Component(a);i.getAllSubcomponents("vtimezone").forEach(t=>n.push(t));const o=["vevent","vjournal","vtodo"];o.forEach(t=>{const n=i.getAllSubcomponents(t);e[t]={},n.forEach(n=>{const a=n.getFirstPropertyValue("uid");e[t][a]=e[t][a]||[],e[t][a].push(n)})});const r=[];return o.forEach(t=>{r[t]=[];for(const a in e[t]){const i=e[t][a],o=Ne();n.forEach(o.addSubcomponent.bind(o));for(const t in i)o.addSubcomponent(i[t]);r[t].push(o.toString())}}),{name:i.getFirstPropertyValue("x-wr-calname"),color:i.getFirstPropertyValue("x-apple-calendar-color"),split:r}})(n);return["vevent","vjournal","vtodo"].forEach(n=>{for(const i in a.split[n]){const o=a.split[n][i];l.a.info("importing event component",{component:o}),e.push(Promise.resolve(on.a.put(t+Fe()+".ics",o,{headers:{"Content-Type":"text/calendar; charset=utf-8"}})))}}),Promise.all(e)};var qe=a(489),Le=a.n(qe),Pe={name:"CalendarImport",components:{Actions:$.a,ActionButton:F.a},props:{calendars:{type:Array,required:!0},handler:{type:Function,required:!0}},computed:{cals(){return this.calendars.map(t=>(this.$set(t,"loading",!1),t))}},methods:{onImport(t){t.loading=!0,this.handler(t).catch(console.error.bind(this)).then(()=>{t.loading=!1})}}},ze=Object(b.a)(Pe,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.calendars.length?e("Actions",{attrs:{"default-icon":"icon-add"}},t._l(t.cals,(function(n,a){return e("ActionButton",{key:a,attrs:{icon:n.loading?"icon-loading-small":"icon-add"},on:{click:function(e){return t.onImport(n)}}},[t._v("\n\t\t"+t._s(t.t("mail","Import into {calendar}",{calendar:n.displayname}))+"\n\t")])})),1):t._e()}),[],!1,null,"7c52d704",null).exports,Ue={name:"EventReservation",components:{CalendarImport:ze},props:{data:{type:Object,required:!0},calendars:{type:Array,required:!0},messageId:{type:String,required:!0}},computed:{eventName(){return this.data.reservationFor.name},time(){if("startDate"in this.data.reservationFor)return W()(this.data.reservationFor.startDate).format("LT")},date(){if("startDate"in this.data.reservationFor)return W()(this.data.reservationFor.startDate).format("L")},location(){if("location"in this.data.reservationFor&&"name"in this.data.reservationFor.location)return this.data.reservationFor.location.name},canImport(){return"startDate"in this.data.reservationFor}},methods:{getEndDateTime(t){return"endDate"in this.data.reservationFor?W()(this.data.reservationFor.endDate).format():W()("2019-10-22T12:00:00Z").add(2,"hours").format()},handleImport(n){const e=new Be.a.Component("VEVENT");e.updatePropertyWithValue("SUMMARY",this.eventName);const a=W()(this.data.reservationFor.startDate).format();e.updatePropertyWithValue("DTSTART",Be.a.Time.fromDateTimeString(a)),e.updatePropertyWithValue("DTEND",Be.a.Time.fromDateTimeString(this.getEndDateTime(this.data.reservationFor))),"location"in this.data.reservationFor&&(e.updatePropertyWithValue("LOCATION",this.data.reservationFor.location.name),"geo"in this.data.reservationFor.location&&e.updatePropertyWithValue("GEO","".concat(this.data.reservationFor.location.geo.latitude,";").concat(this.data.reservationFor.location.geo.longitude))),e.updatePropertyWithValue("PRODID","Nextcloud Mail"),e.updatePropertyWithValue("UID",Le()(this.messageId+this.eventName));const i=new Be.a.Component("VCALENDAR");return i.addSubcomponent(e),l.a.debug("generated calendar event from event reservation data",{ical:i.toString()}),Re(n.url)(i.toString()).then(()=>{l.a.debug("event successfully imported"),Object(N.d)(t("mail","Event imported into {calendar}",{calendar:n.displayname}))}).catch(n=>{l.a.error("Could not import event",{error:n}),Object(N.b)(t("mail","Could not create event"))})}}},Ge=a(1312),We={insert:"head",singleton:!1},Ve=(v()(Ge.a,We),Ge.a.locals,Object(b.a)(Ue,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"reservation"},[e("div",{staticClass:"event"},[e("div",{staticClass:"event-name"},[t._v("\n\t\t\t"+t._s(t.eventName)+"\n\t\t")]),t._v(" "),t.location?e("div",{staticClass:"venue"},[t._v("\n\t\t\t"+t._s(t.location)+"\n\t\t")]):t._e(),t._v(" "),t.date?e("div",[t._v("\n\t\t\t"+t._s(t.date)+"\n\t\t")]):t._e(),t._v(" "),t.time?e("div",[t._v("\n\t\t\t"+t._s(t.time)+"\n\t\t")]):t._e()]),t._v(" "),t.canImport?e("CalendarImport",{attrs:{calendars:t.calendars,handler:t.handleImport}}):t._e()],1)}),[],!1,null,"b2f6d4c0",null).exports),Ye=a(1388),He=a(773),Qe={name:"FlightReservation",components:{AirplaneIcon:Ye.a,ArrowIcon:He.default,CalendarImport:ze},props:{data:{type:Object,required:!0},calendars:{type:Array,required:!0},messageId:{type:String,required:!0}},computed:{departureTime(){if("departureTime"in this.data.reservationFor)return W()(this.data.reservationFor.departureTime["@value"]).format("LT")},departureDate(){if("departureTime"in this.data.reservationFor)return W()(this.data.reservationFor.departureTime["@value"]).format("L")},arrivalTime(){if("arrivalTime"in this.data.reservationFor)return W()(this.data.reservationFor.arrivalTime["@value"]).format("LT")},arrivalDate(){if("arrivalTime"in this.data.reservationFor)return W()(this.data.reservationFor.arrivalTime["@value"]).format("L")},flightNumber(){return this.data.reservationFor.airline.iataCode+this.data.reservationFor.flightNumber},reservation(){if("reservationNumber"in this.data)return this.data.reservationNumber},canImport(){return"departureTime"in this.data.reservationFor&&"arrivalTime"in this.data.reservationFor}},methods:{handleImport(n){const e=new Be.a.Component("VEVENT");e.updatePropertyWithValue("SUMMARY",t("mail","Flight {flightNr} from {depAirport} to {arrAirport}",{flightNr:this.flightNumber,depAirport:this.data.reservationFor.departureAirport.iataCode,arrAirport:this.data.reservationFor.arrivalAirport.iataCode}));const a=W()(this.data.reservationFor.departureTime["@value"]).format();e.updatePropertyWithValue("DTSTART",Be.a.Time.fromDateTimeString(a));const i=W()(this.data.reservationFor.arrivalTime["@value"]).format();e.updatePropertyWithValue("DTEND",Be.a.Time.fromDateTimeString(i)),e.updatePropertyWithValue("PRODID","Nextcloud Mail"),e.updatePropertyWithValue("UID",Le()(this.messageId+this.flightNumber));const o=new Be.a.Component("VCALENDAR");return o.addSubcomponent(e),l.a.debug("generated calendar event from flight reservation data",{ical:o.toString()}),Re(n.url)(o.toString()).then(()=>{l.a.debug("event successfully imported"),Object(N.d)(t("mail","Event imported into {calendar}",{calendar:n.displayname}))}).catch(n=>{l.a.error("Could not import event",{error:n}),Object(N.b)(t("mail","Could not create event"))})}}},Ke=a(1313),Je={insert:"head",singleton:!1},Xe=(v()(Ke.a,Je),Ke.a.locals,Object(b.a)(Qe,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"reservation"},[e("div",{staticClass:"departure"},[e("div",{staticClass:"iata"},[t._v("\n\t\t\t"+t._s(t.data.reservationFor.departureAirport.iataCode)+"\n\t\t")]),t._v(" "),e("div",{staticClass:"airport"},[t._v("\n\t\t\t"+t._s(t.data.reservationFor.departureAirport.name)+"\n\t\t")]),t._v(" "),t.departureDate?e("div",[t._v("\n\t\t\t"+t._s(t.departureDate)+"\n\t\t")]):t._e(),t._v(" "),t.departureTime?e("div",[t._v("\n\t\t\t"+t._s(t.departureTime)+"\n\t\t")]):t._e()]),t._v(" "),e("div",{staticClass:"connection"},[e("div",[e("AirplaneIcon",{attrs:{title:t.t("mail","Airplane")}})],1),t._v(" "),e("div",[t._v(t._s(t.flightNumber))]),t._v(" "),t.reservation?e("div",[t._v("\n\t\t\t"+t._s(t.t("mail","Reservation {id}",{id:t.reservation}))+"\n\t\t")]):e("div",[e("ArrowIcon",{attrs:{decorative:""}})],1)]),t._v(" "),e("div",{staticClass:"arrival"},[e("div",{staticClass:"iata"},[t._v("\n\t\t\t"+t._s(t.data.reservationFor.arrivalAirport.iataCode)+"\n\t\t")]),t._v(" "),e("div",{staticClass:"airport"},[t._v("\n\t\t\t"+t._s(t.data.reservationFor.arrivalAirport.name)+"\n\t\t")]),t._v(" "),t.arrivalDate?e("div",[t._v("\n\t\t\t"+t._s(t.arrivalDate)+"\n\t\t")]):t._e(),t._v(" "),t.arrivalTime?e("div",[t._v("\n\t\t\t"+t._s(t.arrivalTime)+"\n\t\t")]):t._e()]),t._v(" "),e("CalendarImport",{attrs:{calendars:t.calendars,handler:t.handleImport}})],1)}),[],!1,null,"670645fc",null).exports),Ze=a(1389),ta={name:"TrainReservation",components:{ArrowIcon:He.default,CalendarImport:ze,TrainIcon:Ze.a},props:{data:{type:Object,required:!0},calendars:{type:Array,required:!0},messageId:{type:String,required:!0}},computed:{departureTime(){if("departureTime"in this.data.reservationFor)return W()(this.data.reservationFor.departureTime).format("LT")},departureDate(){return"departureTime"in this.data.reservationFor?W()(this.data.reservationFor.departureTime).format("L"):"departureDay"in this.data.reservationFor?W()(this.data.reservationFor.departureDay).format("L"):void 0},arrivalTime(){if("arrivalTime"in this.data.reservationFor)return W()(this.data.reservationFor.arrivalTime).format("LT")},arrivalDate(){if("arrivalTime"in this.data.reservationFor)return W()(this.data.reservationFor.arrivalTime).format("L")},trainNumber(){return this.data.reservationFor.trainNumber},canImport(){return"departureTime"in this.data.reservationFor&&"arrivalTime"in this.data.reservationFor||"departureDay"in this.data.reservationFor}},methods:{handleImport(n){const e=new Be.a.Component("VEVENT");if("trainNumber"in this.data.reservationFor?e.updatePropertyWithValue("SUMMARY",t("mail","{trainNr} from {depStation} to {arrStation}",{trainNr:this.data.reservationFor.trainNumber,depStation:this.data.reservationFor.departureStation.name,arrStation:this.data.reservationFor.arrivalStation.name})):e.updatePropertyWithValue("SUMMARY",t("mail","Train from {depStation} to {arrStation}",{depStation:this.data.reservationFor.departureStation.name,arrStation:this.data.reservationFor.arrivalStation.name})),"departureTime"in this.data.reservationFor&&"arrivalTime"in this.data.reservationFor){const t=W()(this.data.reservationFor.departureTime).format();e.updatePropertyWithValue("DTSTART",Be.a.Time.fromDateTimeString(t));const n=W()(this.data.reservationFor.arrivalTime).format();e.updatePropertyWithValue("DTEND",Be.a.Time.fromDateTimeString(n))}else if("departureDay"in this.data.reservationFor){const t=W()(this.data.reservationFor.departureDay).format();e.updatePropertyWithValue("DTSTART",Be.a.Time.fromDateTimeString(t))}e.updatePropertyWithValue("PRODID","Nextcloud Mail"),e.updatePropertyWithValue("UID",Le()(this.messageId+this.departureTime));const a=new Be.a.Component("VCALENDAR");return a.addSubcomponent(e),l.a.debug("generated calendar event from train reservation data",{ical:a.toString()}),Re(n.url)(a.toString()).then(()=>{l.a.debug("event successfully imported"),Object(N.d)(t("mail","Event imported into {calendar}",{calendar:n.displayname}))}).catch(n=>{l.a.error("Could not import event",{error:n}),Object(N.b)(t("mail","Could not create event"))})}}},na=a(1314),ea={insert:"head",singleton:!1},aa=(v()(na.a,ea),na.a.locals,Object(b.a)(ta,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"reservation"},[e("div",{staticClass:"departure"},[e("div",{staticClass:"station"},[t._v("\n\t\t\t"+t._s(t.data.reservationFor.departureStation.name)+"\n\t\t")]),t._v(" "),t.departureDate?e("div",[t._v("\n\t\t\t"+t._s(t.departureDate)+"\n\t\t")]):t._e(),t._v(" "),t.departureTime?e("div",[t._v("\n\t\t\t"+t._s(t.departureTime)+"\n\t\t")]):t._e()]),t._v(" "),e("div",{staticClass:"connection"},[e("div",[e("TrainIcon",{attrs:{title:t.t("mail","Train")}})],1),t._v(" "),e("div",[t._v(t._s(t.trainNumber))]),t._v(" "),e("div",[e("ArrowIcon",{attrs:{decorative:""}})],1)]),t._v(" "),e("div",{staticClass:"arrival"},[e("div",{staticClass:"station"},[t._v("\n\t\t\t"+t._s(t.data.reservationFor.arrivalStation.name)+"\n\t\t")]),t._v(" "),t.arrivalDate?e("div",[t._v("\n\t\t\t"+t._s(t.arrivalDate)+"\n\t\t")]):t._e(),t._v(" "),t.arrivalTime?e("div",[t._v("\n\t\t\t"+t._s(t.arrivalTime)+"\n\t\t")]):t._e()]),t._v(" "),t.canImport?e("CalendarImport",{attrs:{calendars:t.calendars,handler:t.handleImport}}):t._e()],1)}),[],!1,null,"1eebd676",null).exports);const ia=Se()(Oe);var oa={name:"Itinerary",components:{EventReservation:Ve,FlightReservation:Xe,TrainReservation:aa},props:{entries:{type:Array,required:!0},messageId:{type:String,required:!0}},data:()=>({calendars:[]}),mounted(){ia().then(t=>this.calendars=t).catch(t=>l.a.error("Could not load calendars",{error:t}))}},ra=Object(b.a)(oa,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[t._l(t.entries,(function(n,a){return["EventReservation"===n["@type"]?e("EventReservation",{key:a,attrs:{data:n,calendars:t.calendars,"message-id":t.messageId}}):"FlightReservation"===n["@type"]?e("FlightReservation",{key:a,attrs:{data:n,calendars:t.calendars,"message-id":t.messageId}}):"TrainReservation"===n["@type"]?e("TrainReservation",{key:a,attrs:{data:n,calendars:t.calendars,"message-id":t.messageId}}):e("span",{key:a},[t._v(t._s(t.t("mail","Itinerary for {type} is not supported yet",{type:n["@type"]})))])]}))],2)}),[],!1,null,null,null).exports,sa=a(1315),la=a(1316),da={name:"MessageAttachment",components:{PopoverMenu:a.n(la).a},mixins:[sa.mixin],props:{id:{type:String,required:!0},fileName:{type:String,default:Object(sn.translate)("mail","Unnamed"),required:!1},url:{type:String,required:!0},size:{type:Number,required:!0},mime:{type:String,required:!0},mimeUrl:{type:String,required:!0},isImage:{type:Boolean,default:!1},isCalendarEvent:{type:Boolean,default:!1}},data:()=>({savingToCloud:!1,loadingCalendars:!1,calendars:[],showCalendarPopover:!1}),computed:{name(){return"message/rfc822"===this.mime?Object(sn.translate)("mail","Embedded message"):this.fileName},label(){return"message/rfc822"===this.mime?Object(sn.translate)("mail","Embedded message")+" ("+Object(Mn.formatFileSize)(this.size)+")":this.fileName+" ("+Object(Mn.formatFileSize)(this.size)+")"},calendarMenuEntries(){return this.calendars.map(t=>({icon:"icon-add",text:t.displayname,action:this.importCalendar(t.url)}))}},methods:{humanReadable:t=>Object(Mn.formatFileSize)(t),saveToCloud(){const t=this.$route.params.threadId;return Object(N.a)(Object(sn.translate)("mail","Choose a folder to store the attachment in")).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").setModal(!0).setType(1).allowDirectories(!0).build().pick().then(t=>(this.savingToCloud=!0,t)).then(((t,n)=>e=>Ln(t,n,e))(t,this.id)).then(()=>l.a.info("saved")).catch(t=>l.a.error("not saved",{error:t})).then(()=>this.savingToCloud=!1)},download(){window.location=this.url},loadCalendars(){this.loadingCalendars=!0,Oe().then(t=>{this.calendars=t,this.showCalendarPopover=!0,this.loadingCalendars=!1})},closeCalendarPopover(){this.showCalendarPopover=!1},importCalendar(t){return()=>{(function(t){return on.a.get(t).then(t=>t.data)})(this.url).then(Re(t)).then(()=>l.a.info("calendar imported")).catch(t=>l.a.error("import error",{error:t})).then(()=>this.showCalendarPopover=!1)}}}},ca=a(1317),pa={insert:"head",singleton:!1},ma=(v()(ca.a,pa),ca.a.locals,{name:"MessageAttachments",components:{MessageAttachment:Object(b.a)(da,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"attachment",on:{click:t.download}},[t.isImage?e("img",{staticClass:"mail-attached-image",attrs:{src:t.url}}):t._e(),t._v(" "),e("img",{staticClass:"attachment-icon",attrs:{src:t.mimeUrl}}),t._v(" "),e("span",{staticClass:"attachment-name",attrs:{title:t.label}},[t._v(t._s(t.name)+"\n\t\t"),e("span",{staticClass:"attachment-size"},[t._v("("+t._s(t.humanReadable(t.size))+")")])]),t._v(" "),t.isCalendarEvent?e("button",{staticClass:"button attachment-import calendar",class:{"icon-add":!t.loadingCalendars,"icon-loading-small":t.loadingCalendars},attrs:{disabled:t.loadingCalendars,title:t.t("mail","Import into calendar")},on:{click:function(n){return n.stopPropagation(),t.loadCalendars.apply(null,arguments)}}}):t._e(),t._v(" "),e("button",{staticClass:"button icon-download attachment-download",attrs:{title:t.t("mail","Download attachment")}}),t._v(" "),e("button",{staticClass:"attachment-save-to-cloud",class:{"icon-folder":!t.savingToCloud,"icon-loading-small":t.savingToCloud},attrs:{disabled:t.savingToCloud,title:t.t("mail","Save to Files")},on:{click:function(n){return n.stopPropagation(),t.saveToCloud.apply(null,arguments)}}}),t._v(" "),e("div",{directives:[{name:"on-click-outside",rawName:"v-on-click-outside",value:t.closeCalendarPopover,expression:"closeCalendarPopover"}],staticClass:"popovermenu bubble attachment-import-popover hidden",class:{open:t.showCalendarPopover}},[e("PopoverMenu",{attrs:{menu:t.calendarMenuEntries}})],1)])}),[],!1,null,"473b0a1e",null).exports},props:{envelope:{required:!0,type:Object},attachments:{type:Array,required:!0}},data:()=>({savingToCloud:!1}),computed:{moreThanOne(){return this.attachments.length>1},zipUrl(){return Object(rn.generateUrl)("/apps/mail/api/messages/{id}/attachments",{id:this.envelope.databaseId})}},methods:{saveAll(){const n=Object(N.a)(t("mail","Choose a folder to store the attachments in")).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").setModal(!0).setType(1).allowDirectories(!0).build(),e=this.$route.params.threadId;return n.pick().then(t=>(this.savingToCloud=!0,t)).then((t=>n=>function(t,n){return Ln(t,0,n)}(t,n))(e)).then(()=>l.a.info("saved")).catch(t=>l.a.error("not saved",{error:t})).then(()=>this.savingToCloud=!1)},downloadZip(){window.location=this.zipUrl}}}),Aa=a(1318),ua={insert:"head",singleton:!1},ha=(v()(Aa.a,ua),Aa.a.locals,Object(b.a)(ma,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"mail-message-attachments"},[e("div",{staticClass:"attachments"},t._l(t.attachments,(function(t){return e("MessageAttachment",{key:t.id,attrs:{id:t.id,"file-name":t.fileName,size:t.size,url:t.downloadUrl,"is-image":t.isImage,"is-calendar-event":t.isCalendarEvent,mime:t.mime,"mime-url":t.mimeUrl}})})),1),t._v(" "),t.moreThanOne?e("p",{staticClass:"attachments-button-wrapper"},[e("button",{staticClass:"attachments-save-to-cloud",class:{"icon-folder":!t.savingToCloud,"icon-loading-small":t.savingToCloud},attrs:{disabled:t.savingToCloud},on:{click:t.saveAll}},[t._v("\n\t\t\t"+t._s(t.t("mail","Save all to Files"))+"\n\t\t")]),t._v(" "),e("button",{staticClass:"attachments-save-to-cloud icon-folder",on:{click:t.downloadZip}},[t._v("\n\t\t\t"+t._s(t.t("mail","Download Zip"))+"\n\t\t")])]):t._e()])}),[],!1,null,null,null).exports),ga={name:"MdnRequest",props:{message:{required:!0,type:Object}},data(){return{hasMdnRequest:this.message.dispositionNotificationTo&&this.message.dispositionNotificationTo.length>0,loading:!1}},computed:{mdnSent(){return this.message.flags.mdnsent}},methods:{async sendMdn(){this.loading=!0,l.a.debug("send return receipt");try{await Object(pe.k)(this.message.databaseId),this.$store.commit("flagEnvelope",{envelope:this.message,flag:"mdnsent",value:!0})}catch(n){l.a.error("could not send mdn",n),Object(N.b)(t("mail","Could not send mdn"))}this.loading=!1}}},va=a(1319),fa={insert:"head",singleton:!1},Ca=(v()(va.a,fa),va.a.locals,Object(b.a)(ga,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.hasMdnRequest&&!t.mdnSent?e("div",{staticClass:"mail-message-has-mdn-request"},[t._v("\n\t"+t._s(t.t("mail","The sender of this message has asked to be notified when you read this message."))+"\n\t"),e("button",{attrs:{disabled:t.loading},on:{click:t.sendMdn}},[t._v("\n\t\t"+t._s(t.t("mail","Notify the sender"))+"\n\t")])]):t.mdnSent?e("div",{staticClass:"mail-message-has-mdn-request"},[t._v("\n\t"+t._s(t.t("mail","You sent a read confirmation to the sender of this message."))+"\n")]):t._e()}),[],!1,null,"3bf60f28",null).exports),ba={name:"MessageEncryptedBody",components:{MdnRequest:Ca},props:{body:{type:String,required:!0},from:{type:String,required:!1,default:void 0},message:{required:!0,type:Object}},data:()=>({mailvelope:!1}),async mounted(){this.mailvelope=await Xn(),this.mailvelope.createDisplayContainer("#mail-content",this.body,void 0,{senderAddress:this.from})}},ya=a(1320),xa={insert:"head",singleton:!1},wa=(v()(ya.a,xa),ya.a.locals,Object(b.a)(ba,(function(){var t=this.$createElement,n=this._self._c||t;return n("div",[this.mailvelope?n("div",{attrs:{id:"mail-content"}},[n("MdnRequest",{attrs:{message:this.message}})],1):n("span",[this._v(this._s(this.t("mail","This message is encrypted with PGP. Install Mailvelope to decrypt it.")))])])}),[],!1,null,"812ccd96",null).exports),ka=a(1321),_a=a(1393),Ia=a(1039);const Ta=new _a.a;var Ea={name:"MessageHTMLBody",components:{MdnRequest:Ca,Actions:$.a,ActionButton:F.a},props:{url:{type:String,required:!0},fullHeight:{type:Boolean,required:!1,default:!1},message:{required:!0,type:Object}},data(){return{loading:!0,hasBlockedContent:!1,isSenderTrusted:this.message.isSenderTrusted}},beforeMount(){Ta.on("beforeprint",this.onBeforePrint),Ta.on("afterprint",this.onAfterPrint)},mounted(){Object(ka.iframeResizer)({},this.$refs.iframe)},beforeDestroy(){Ta.off("beforeprint",this.onBeforePrint),Ta.off("afterprint",this.onAfterPrint),this.$refs.iframe.iFrameResizer.close()},methods:{getIframeDoc(){const t=this.$refs.iframe;return t.contentDocument||t.contentWindow.document},onMessageFrameLoad(){const t=this.getIframeDoc();this.hasBlockedContent=t.querySelectorAll("[data-original-src]").length>0||t.querySelectorAll("[data-original-style]").length>0||t.querySelectorAll("style[data-original-content]").length>0,this.loading=!1,this.isSenderTrusted&&this.displayIframe()},onAfterPrint(){this.$refs.iframe.style.setProperty("height","")},onBeforePrint(){this.$refs.iframe.style.setProperty("height","".concat(this.getIframeDoc().body.scrollHeight,"px"),"important")},displayIframe(){const t=this.getIframeDoc();l.a.debug("showing external images"),t.querySelectorAll("[data-original-src]").forEach(t=>{t.style.display=null,t.setAttribute("src",t.getAttribute("data-original-src"))}),t.querySelectorAll("[data-original-style]").forEach(t=>t.setAttribute("style",t.getAttribute("data-original-style"))),t.querySelectorAll("style[data-original-content]").forEach(t=>{t.innerHTML=t.getAttribute("data-original-content")}),this.hasBlockedContent=!1},async onShowBlockedContent(){this.displayIframe(),await Object(Ia.b)(this.message.from[0].email,"individual",!0)},getDomain(){return this.message.from[0].email.split("@").pop()},async onShowBlockedContentForDomain(){this.displayIframe(),await Object(Ia.b)(this.getDomain(),"domain",!0)}}},Ma=a(1324),Sa={insert:"head",singleton:!1},Da=(v()(Ma.a,Sa),Ma.a.locals,Object(b.a)(Ea,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"mail-content"}},[e("MdnRequest",{attrs:{message:t.message}}),t._v(" "),t.hasBlockedContent?e("div",{staticStyle:{color:"#000000"},attrs:{id:"mail-message-has-blocked-content"}},[t._v("\n\t\t"+t._s(t.t("mail","The images have been blocked to protect your privacy."))+"\n\t\t"),e("Actions",{attrs:{"default-icon":"icon-toggle","menu-title":t.t("mail","Show")}},[e("ActionButton",{attrs:{icon:"icon-toggle"},on:{click:t.displayIframe}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Show images temporarily"))+"\n\t\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-toggle"},on:{click:t.onShowBlockedContent}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Always show images from {sender}",{sender:t.message.from[0].email}))+"\n\t\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-toggle"},on:{click:t.onShowBlockedContentForDomain}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Always show images from {domain}",{domain:t.getDomain()}))+"\n\t\t\t")])],1)],1):t._e(),t._v(" "),t.loading?e("div",{staticClass:"icon-loading"}):t._e(),t._v(" "),e("div",{class:{hidden:t.loading,scroll:!t.fullHeight},attrs:{id:"message-container"}},[e("iframe",{ref:"iframe",staticClass:"message-frame",attrs:{title:t.t("mail","Message frame"),src:t.url,seamless:""},on:{load:t.onMessageFrameLoad}})])],1)}),[],!1,null,"566bc156",null).exports);const Ba=/(.+\n\r?)+(\n\r?)+/;var ja={name:"MessagePlainTextBody",components:{MdnRequest:Ca},props:{body:{type:String,required:!0},signature:{type:String,default:()=>{}},message:{required:!0,type:Object}},computed:{enhancedBody(){return this.body.replace(/(&gt;.*\n?)+/g,n=>'<details class="quoted-text"><summary>'.concat(t("mail","Quoted text"),"</summary>").concat(n,"</details>"))},signatureSummaryAndBody(){const t=this.signature.trim().match(Ba);if(t&&t[0])return{summary:t[0],body:this.signature.substring(t[0].length)};const n=this.signature.trim().split(/\r?\n/);return{summary:n[0],body:n.slice(1).join("\n")}},signatureSummary(){return console.info(this.signature.match(Ba)),this.signatureSummaryAndBody.summary}},methods:{nl2br:t=>t.replace(/(\r\n|\n\r|\n|\r)/g,"<br />")}},$a=a(1325),Oa={insert:"head",singleton:!1},Fa=(v()($a.a,Oa),$a.a.locals,a(1326)),Na={insert:"head",singleton:!1},Ra=(v()(Fa.a,Na),Fa.a.locals,Object(b.a)(ja,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"mail-content"}},[e("MdnRequest",{attrs:{message:t.message}}),t._v(" "),e("div",{attrs:{id:"message-container"},domProps:{innerHTML:t._s(t.nl2br(t.enhancedBody))}}),t._v(" "),t.signature?e("details",{staticClass:"mail-signature"},[e("summary",{domProps:{innerHTML:t._s(t.nl2br(t.signatureSummaryAndBody.summary))}}),t._v(" "),e("span",{domProps:{innerHTML:t._s(t.nl2br(t.signatureSummaryAndBody.body))}})]):t._e()],1)}),[],!1,null,"6bd2c088",null).exports),qa={name:"Message",components:{Actions:$.a,ActionButton:F.a,Itinerary:ra,MessageAttachments:ha,MessageEncryptedBody:wa,MessageHTMLBody:Da,MessagePlainTextBody:Ra,Popover:u.a},props:{envelope:{required:!0,type:Object},message:{required:!0,type:Object},fullHeight:{required:!1,type:Boolean,default:!1}},computed:{from(){return 0===this.message.from.length?"?":this.message.from[0].label||this.message.from[0].email},htmlUrl(){return Object(rn.generateUrl)("/apps/mail/api/messages/{id}/html",{id:this.envelope.databaseId})},isEncrypted(){return Vn(this.message.hasHtmlBody?Object(et.b)(this.message.body):Object(et.c)(this.message.body))}}},La=a(1327),Pa={insert:"head",singleton:!1},za=(v()(La.a,Pa),La.a.locals,Object(b.a)(qa,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{class:[t.message.hasHtmlBody?"mail-message-body mail-message-body-html":"mail-message-body"],attrs:{role:"region","aria-label":t.t("mail","Message body")}},[t.message.itineraries.length>0?e("div",{staticClass:"message-itinerary"},[e("Itinerary",{attrs:{entries:t.message.itineraries,"message-id":t.message.messageId}})],1):t._e(),t._v(" "),t.message.hasHtmlBody?e("MessageHTMLBody",{attrs:{url:t.htmlUrl,message:t.message,"full-height":t.fullHeight}}):t.isEncrypted?e("MessageEncryptedBody",{attrs:{body:t.message.body,from:t.from,message:t.message}}):e("MessagePlainTextBody",{attrs:{body:t.message.body,signature:t.message.signature,message:t.message}}),t._v(" "),t.message.attachments[0]?e("Popover",{staticClass:"attachment-popover"},[e("Actions",{attrs:{slot:"trigger"},slot:"trigger"},[e("ActionButton",{attrs:{icon:"icon-public icon-attachment"}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Attachments"))+"\n\t\t\t")])],1),t._v(" "),e("MessageAttachments",{directives:[{name:"close-popover",rawName:"v-close-popover",value:!0,expression:"true"}],attrs:{attachments:t.message.attachments,envelope:t.envelope}})],1):t._e(),t._v(" "),e("div",{attrs:{id:"reply-composer"}})],1)}),[],!1,null,"106a4f26",null).exports),Ua=a(1328),Ga={name:"MenuEnvelope",components:{Actions:$.a,ActionButton:F.a,ActionLink:wn.a,ActionRouter:P.a,Modal:ut.a,MoveModal:mt,TagModal:wt},props:{envelope:{type:Object,required:!0},mailbox:{type:Object,required:!1,default:void 0},isSelected:{type:Boolean,default:!1},withReply:{type:Boolean,default:!0},withSelect:{type:Boolean,default:!0},withShowSource:{type:Boolean,default:!0}},data(){var t,n;return{debug:(null===(t=window)||void 0===t||null===(n=t.OC)||void 0===n?void 0:n.debug)||!1,rawMessage:"",sourceLoading:!1,showSourceModal:!1,showMoveModal:!1,showTagModal:!1}},computed:{account(){var t;const n=null!==(t=this.envelope.accountId)&&void 0!==t?t:this.mailbox.accountId;return this.$store.getters.getAccount(n)},hasMultipleRecipients(){this.account||console.error("account is undefined",{accountId:this.envelope.accountId});const t=ot(this.envelope,{label:this.account.name,email:this.account.emailAddress});return t.to.concat(t.cc).length>1},replyOneLink(){return{name:"message",params:{mailboxId:this.$route.params.mailboxId,threadId:"reply",filter:this.$route.params.filter?this.$route.params.filter:void 0},query:{messageId:this.envelope.databaseId}}},replyAllLink(){return{name:"message",params:{mailboxId:this.$route.params.mailboxId,threadId:"replyAll",filter:this.$route.params.filter?this.$route.params.filter:void 0},query:{messageId:this.envelope.databaseId}}},forwardLink(){return{name:"message",params:{mailboxId:this.$route.params.mailboxId,threadId:"new",filter:this.$route.params.filter?this.$route.params.filter:void 0},query:{messageId:this.envelope.databaseId}}},threadingFile(){return"data:text/plain;base64,".concat(Ua.a.encode(JSON.stringify({subject:this.envelope.subject,messageId:this.envelope.messageId,inReplyTo:this.envelope.inReplyTo,references:this.envelope.references,threadRootId:this.envelope.threadRootId},null,2)))},threadingFileName(){return"".concat(this.envelope.databaseId,".json")},iconFavorite(){return this.envelope.flags.flagged?"icon-favorite":"icon-starred"},isImportant(){return this.$store.getters.getEnvelopeTags(this.envelope.databaseId).some(t=>"$label1"===t.imapLabel)}},methods:{onToggleFlagged(){this.$store.dispatch("toggleEnvelopeFlagged",this.envelope)},onToggleImportant(){this.$store.dispatch("toggleEnvelopeImportant",this.envelope)},onToggleSeen(){this.$store.dispatch("toggleEnvelopeSeen",{envelope:this.envelope})},onToggleJunk(){this.$store.dispatch("toggleEnvelopeJunk",this.envelope)},toggleSelected(){this.$emit("update:selected")},async onDelete(){this.withSelect&&this.$emit("unselect"),this.$emit("delete",this.envelope.databaseId),l.a.info("deleting message ".concat(this.envelope.databaseId));try{await this.$store.dispatch("deleteMessage",{id:this.envelope.databaseId})}catch(n){Object(N.b)(await Object(ct.a)(n,{[dt.a.getName()]:()=>t("mail","No trash mailbox configured"),default:n=>(l.a.error("could not delete message",n),t("mail","Could not delete message"))}))}},async onShowSourceModal(){this.sourceLoading=!0;try{const t=await on.a.get(Object(rn.generateUrl)("/apps/mail/api/messages/{id}/source",{id:this.envelope.databaseId}));this.rawMessage=t.data.source,this.showSourceModal=!0}finally{this.sourceLoading=!1}},onCloseSourceModal(){this.showSourceModal=!1},onMove(){this.$emit("move")},onOpenMoveModal(){this.showMoveModal=!0},onCloseMoveModal(){this.showMoveModal=!1},onOpenTagModal(){this.showTagModal=!0},onCloseTagModal(){this.showTagModal=!1}}},Wa=a(1329),Va={insert:"head",singleton:!1},Ya=(v()(Wa.a,Va),Wa.a.locals,Object(b.a)(Ga,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("Actions",{attrs:{"menu-align":"right",event:""},nativeOn:{click:function(t){t.preventDefault()}}},[t.withReply?e("ActionRouter",{attrs:{icon:t.hasMultipleRecipients?"icon-reply-all":"icon-reply","close-after-click":!0,to:t.hasMultipleRecipients?t.replyAllLink:t.replyOneLink}},[t._v("\n\t\t\t"+t._s(t.t("mail","Reply"))+"\n\t\t")]):t._e(),t._v(" "),t.hasMultipleRecipients?e("ActionRouter",{attrs:{icon:"icon-reply","close-after-click":!0,to:t.replyOneLink}},[t._v("\n\t\t\t"+t._s(t.t("mail","Reply to sender only"))+"\n\t\t")]):t._e(),t._v(" "),e("ActionRouter",{attrs:{icon:"icon-forward","close-after-click":!0,to:t.forwardLink}},[t._v("\n\t\t\t"+t._s(t.t("mail","Forward"))+"\n\t\t")]),t._v(" "),e("ActionRouter",{attrs:{icon:"icon-add",to:{name:"message",params:{mailboxId:t.$route.params.mailboxId,threadId:"asNew",filter:t.$route.params.filter},query:{messageId:t.envelope.databaseId}}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Edit as new message"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-important","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onToggleImportant.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.isImportant?t.t("mail","Mark unimportant"):t.t("mail","Mark important"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:t.iconFavorite,"close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onToggleFlagged.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.envelope.flags.flagged?t.t("mail","Mark unfavorite"):t.t("mail","Mark favorite"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-mail","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onToggleSeen.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.envelope.flags.seen?t.t("mail","Mark unread"):t.t("mail","Mark read"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-junk","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onToggleJunk.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.envelope.flags.junk?t.t("mail","Mark not spam"):t.t("mail","Mark as spam"))+"\n\t\t")]),t._v(" "),e("ActionButton",{attrs:{icon:"icon-tag","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onOpenTagModal.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Edit tags"))+"\n\t\t")]),t._v(" "),t.withSelect?e("ActionButton",{attrs:{icon:"icon-checkmark","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.toggleSelected.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.isSelected?t.t("mail","Unselect"):t.t("mail","Select"))+"\n\t\t")]):t._e(),t._v(" "),e("ActionButton",{attrs:{icon:"icon-external","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onOpenMoveModal.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Move message"))+"\n\t\t")]),t._v(" "),t.withShowSource?e("ActionButton",{attrs:{icon:t.sourceLoading?"icon-loading-small":"icon-details",disabled:t.sourceLoading,"close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onShowSourceModal.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.t("mail","View source"))+"\n\t\t")]):t._e(),t._v(" "),t.debug?e("ActionLink",{attrs:{icon:"icon-download",download:t.threadingFileName,href:t.threadingFile,"close-after-click":!0}},[t._v("\n\t\t\t"+t._s(t.t("mail","Download thread data for debugging"))+"\n\t\t")]):t._e(),t._v(" "),e("ActionButton",{attrs:{icon:"icon-delete","close-after-click":!0},on:{click:function(n){return n.preventDefault(),t.onDelete.apply(null,arguments)}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Delete message"))+"\n\t\t")])],1),t._v(" "),t.showSourceModal?e("Modal",{staticClass:"source-modal",on:{close:t.onCloseSourceModal}},[e("div",{staticClass:"source-modal-content"},[e("div",{staticClass:"section"},[e("h2",[t._v(t._s(t.t("mail","Message source")))]),t._v(" "),e("pre",{staticClass:"message-source"},[t._v(t._s(t.rawMessage))])])])]):t._e(),t._v(" "),t.showMoveModal?e("MoveModal",{attrs:{account:t.account,envelopes:[t.envelope]},on:{move:t.onMove,close:t.onCloseMoveModal}}):t._e(),t._v(" "),t.showTagModal?e("TagModal",{attrs:{account:t.account,envelope:t.envelope},on:{close:t.onCloseTagModal}}):t._e()],1)}),[],!1,null,"4870a97e",null).exports),Ha={name:"Moment",props:{timestamp:{type:Number,required:!0},format:{type:String,default:"LLL"}},computed:{title(){return W.a.unix(this.timestamp).format(this.format)},formatted(){return W.a.unix(this.timestamp).fromNow()}}},Qa={name:"ThreadEnvelope",components:{Error:Rt,Loading:Gt,MenuEnvelope:Ya,Moment:Object(b.a)(Ha,(function(){var t=this.$createElement;return(this._self._c||t)("span",{staticClass:"live-relative-timestamp",attrs:{"data-timestamp":1e3*this.timestamp,title:this.title}},[this._v(this._s(this.formatted))])}),[],!1,null,null,null).exports,Message:za,Avatar:z.a},props:{envelope:{required:!0,type:Object},mailboxId:{required:!1,type:[String,Number],default:void 0},expanded:{required:!1,type:Boolean,default:!1},fullHeight:{required:!1,type:Boolean,default:!1}},data:()=>({loading:!1,error:void 0,message:void 0,importantSvg:Y.a,seenTimer:void 0}),computed:{account(){return this.$store.getters.getAccount(this.envelope.accountId)},hasMultipleRecipients(){this.account||console.error("account is undefined",{accountId:this.envelope.accountId});const t=ot(this.envelope,{label:this.account.name,email:this.account.emailAddress});return t.to.concat(t.cc).length>1},replyOneLink(){return{name:"message",params:{mailboxId:this.$route.params.mailboxId,threadId:"reply",filter:this.$route.params.filter?this.$route.params.filter:void 0},query:{messageId:this.envelope.databaseId}}},replyAllLink(){return{name:"message",params:{mailboxId:this.$route.params.mailboxId,threadId:"replyAll",filter:this.$route.params.filter?this.$route.params.filter:void 0},query:{messageId:this.envelope.databaseId}}},route(){return{name:"message",params:{mailboxId:this.mailboxId||this.envelope.mailboxId,threadId:this.envelope.databaseId}}},isImportant(){return this.$store.getters.getEnvelopeTags(this.envelope.databaseId).find(t=>"$label1"===t.imapLabel)},tags(){return this.$store.getters.getEnvelopeTags(this.envelope.databaseId).filter(t=>"$label1"!==t.imapLabel)}},watch:{expanded(t){t?this.fetchMessage():this.message=void 0}},async mounted(){this.expanded&&(await this.fetchMessage(),this.$nextTick(()=>this.scrollToCurrentEnvelope()))},beforeDestroy(){void 0!==this.seenTimer&&(l.a.info("Navigating away before seenTimer delay, will not mark message as seen/read"),clearTimeout(this.seenTimer))},methods:{async fetchMessage(){this.loading=!0,l.a.debug("fetching thread message ".concat(this.envelope.databaseId));try{const t=this.message=await this.$store.dispatch("fetchMessage",this.envelope.databaseId);l.a.debug("message ".concat(this.envelope.databaseId," fetched"),{message:t}),this.envelope.flags.seen||(l.a.info("Starting timer to mark message as seen/read"),this.seenTimer=setTimeout(()=>{this.$store.dispatch("toggleEnvelopeSeen",{envelope:this.envelope}),this.seenTimer=void 0},2e3)),this.loading=!1}catch(t){l.a.error("Could not fetch message",{error:t})}},scrollToCurrentEnvelope(){const t=document.querySelector("#header").clientHeight,n=document.querySelector("#mail-thread-header").clientHeight,e=this.$el.getBoundingClientRect().top-t-n;window.scrollTo({top:e})},onToggleImportant(){this.$store.dispatch("toggleEnvelopeImportant",this.envelope)},onToggleFlagged(){this.$store.dispatch("toggleEnvelopeFlagged",this.envelope)}}},Ka=a(1330),Ja={insert:"head",singleton:!1},Xa=(v()(Ka.a,Ja),Ka.a.locals,Object(b.a)(Qa,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"envelope"},[e("div",{staticClass:"envelope--header",class:{"list-item-style":t.expanded}},[t.envelope.from&&t.envelope.from[0]?e("Avatar",{attrs:{email:t.envelope.from[0].email,"display-name":t.envelope.from[0].label,"disable-tooltip":!0,size:40}}):t._e(),t._v(" "),t.isImportant?e("div",{staticClass:"app-content-list-item-star icon-important",attrs:{"data-starred":t.isImportant?"true":"false"},domProps:{innerHTML:t._s(t.importantSvg)},on:{click:function(n){return n.preventDefault(),t.onToggleImportant.apply(null,arguments)}}}):t._e(),t._v(" "),t.envelope.flags.flagged?e("div",{staticClass:"app-content-list-item-star icon-starred",attrs:{"data-starred":t.envelope.flags.flagged?"true":"false"},on:{click:function(n){return n.preventDefault(),t.onToggleFlagged.apply(null,arguments)}}}):t._e(),t._v(" "),e("router-link",{staticClass:"left",class:{seen:t.envelope.flags.seen},attrs:{to:t.route,event:""},nativeOn:{click:function(n){return n.preventDefault(),t.$emit("toggleExpand",n)}}},[e("span",{staticClass:"sender"},[t._v(t._s(t.envelope.from&&t.envelope.from[0]?t.envelope.from[0].label:""))]),t._v(" "),e("div",{staticClass:"subject"},[e("span",{staticClass:"preview"},[t._v("\n\t\t\t\t\t"+t._s(t.envelope.subject)+"\n\t\t\t\t")])]),t._v(" "),t._l(t.tags,(function(n){return e("div",{key:n.id,staticClass:"tag-group"},[e("div",{staticClass:"tag-group__bg",style:{"background-color":n.color}}),t._v(" "),e("span",{staticClass:"tag-group__label",style:{color:n.color}},[t._v(t._s(n.displayName)+" ")])])}))],2),t._v(" "),e("div",{staticClass:"right"},[e("Moment",{staticClass:"timestamp",attrs:{timestamp:t.envelope.dateInt}}),t._v(" "),e("router-link",{staticClass:"button",class:{"icon-reply-all-white":t.hasMultipleRecipients,"icon-reply-white":!t.hasMultipleRecipients,primary:t.expanded},attrs:{to:t.hasMultipleRecipients?t.replyAllLink:t.replyOneLink}},[e("span",{staticClass:"action-label"},[t._v(" "+t._s(t.t("mail","Reply")))])]),t._v(" "),e("MenuEnvelope",{staticClass:"app-content-list-item-menu",attrs:{envelope:t.envelope,"with-reply":!1,"with-select":!1,"with-show-source":!0},on:{delete:function(n){return t.$emit("delete",t.envelope.databaseId)}}})],1)],1),t._v(" "),t.loading?e("Loading"):t.message?e("Message",{attrs:{envelope:t.envelope,message:t.message,"full-height":t.fullHeight}}):t.error?e("Error",{attrs:{error:t.error&&t.error.message?t.error.message:t.t("mail","Not found"),message:t.errorMessage,data:t.error,role:"alert"}}):t._e()],1)}),[],!1,null,"0737c023",null).exports),Za={name:"Thread",components:{RecipientBubble:Ee,AppContentDetails:en.a,Loading:Gt,ThreadEnvelope:Xa,Popover:u.a},data(){return{loading:!0,message:void 0,errorMessage:"",error:void 0,expandedThreads:[],participantsToDisplay:999,resizeDebounced:dn()(500,this.updateParticipantsToDisplay)}},computed:{moreParticipantsString(){return"+".concat(this.threadParticipants.length-this.participantsToDisplay)},threadId(){return parseInt(this.$route.params.threadId,10)},thread(){const t=this.$store.getters.getEnvelopeThread(this.threadId),n=t.find(t=>t.databaseId===this.threadId);if(void 0===n)return[];const e=this.$store.getters.getMailbox(n.mailboxId),a=this.$store.getters.getMailboxes(e.accountId).find(t=>"trash"===t.specialRole);return void 0===a?t:e.databaseId===a.databaseId?t.filter(t=>t.mailboxId===a.databaseId):t.filter(t=>t.mailboxId!==a.databaseId)},threadParticipants(){const t=this.thread.flatMap(t=>t.from.concat(t.to).concat(t.cc));return Object(fe.a)(Object(Ce.a)("email"),t)},threadSubject(){const t=this.thread;return 0===t.length?(console.warn("thread is empty"),""):t[0].subject}},watch:{$route(t,n){n.name!==t.name||n.params.mailboxId!==t.params.mailboxId||n.params.threadId!==t.params.threadId||n.params.filter!==t.params.filter?(l.a.debug("navigated to another thread",{to:t,from:n}),this.resetThread()):l.a.debug("navigated but the thread is still the same")}},created(){this.resetThread(),window.addEventListener("resize",this.resizeDebounced)},beforeDestroy(){window.removeEventListener("resize",this.resizeDebounced)},methods:{updateParticipantsToDisplay(){if(!this.$refs.avatarHeader||!this.threadParticipants)return;const t=this.$refs.avatarHeader,n=t.clientWidth-100;let e=0,a=0,i=0;for(;e<n&&a<this.threadParticipants.length;)void 0!==t.childNodes[i].clientWidth?(e+=t.childNodes[i].clientWidth,a++,i++):i+=3;this.participantsToDisplay=e>n?a>1?a-1:0===a?1:a:this.threadParticipants.length},toggleExpand(t){this.expandedThreads.includes(t)?(console.debug("collapse thread ".concat(t)),this.expandedThreads=this.expandedThreads.filter(n=>n!==t)):(console.debug("expand thread ".concat(t)),this.expandedThreads.push(t))},onMove(t){t===this.threadId?this.$router.replace({name:"mailbox",params:{mailboxId:this.$route.params.mailboxId}}):(this.expandedThreads=this.expandedThreads.filter(n=>n!==t),this.fetchThread())},async resetThread(){this.expandedThreads=[this.threadId],await this.fetchThread(),this.updateParticipantsToDisplay()},async fetchThread(){this.loading=!0,this.errorMessage="",this.error=void 0;const n=this.threadId;try{const t=await this.$store.dispatch("fetchThread",n);if(l.a.debug("thread for envelope ".concat(n," fetched"),{thread:t}),n!==parseInt(this.$route.params.threadId,10))return void l.a.debug("User navigated away, loaded envelope won't be shown nor flagged as seen",{oldId:n,newId:this.$route.params.threadId});if(0===t.length)return l.a.info("thread could not be found and is empty",{threadId:n}),this.errorMessage=ce(),void(this.loading=!1);this.loading=!1}catch(e){l.a.error("could not load envelope thread",{threadId:n,error:e}),e.isError&&(this.errorMessage=t("mail","Could not load your message thread"),this.error=e,this.loading=!1)}}}},ti=a(1331),ni={insert:"head",singleton:!1},ei=(v()(ti.a,ni),ti.a.locals,Object(b.a)(Za,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("AppContentDetails",{attrs:{id:"mail-message"}},[t.loading?e("Loading"):[e("div",{attrs:{id:"mail-thread-header"}},[e("div",{attrs:{id:"mail-thread-header-fields"}},[e("h2",{attrs:{title:t.threadSubject}},[t._v("\n\t\t\t\t\t"+t._s(t.threadSubject)+"\n\t\t\t\t")]),t._v(" "),e("div",{ref:"avatarHeader",staticClass:"avatar-header"},[t._l(t.threadParticipants.slice(0,t.participantsToDisplay),(function(t){return e("RecipientBubble",{key:t.email,attrs:{email:t.email,label:t.label}})})),t._v(" "),t.threadParticipants.length>t.participantsToDisplay?e("Popover",{staticClass:"avatar-more"},[e("span",{staticClass:"avatar-more",attrs:{slot:"trigger"},slot:"trigger"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.moreParticipantsString)+"\n\t\t\t\t\t\t")]),t._v(" "),t._l(t.threadParticipants.slice(t.participantsToDisplay),(function(t){return e("RecipientBubble",{key:t.email,attrs:{email:t.email,label:t.label}})}))],2):t._e(),t._v(" "),t._l(t.threadParticipants.slice(t.participantsToDisplay),(function(t){return e("RecipientBubble",{key:t.email,staticClass:"avatar-hidden",attrs:{email:t.email,label:t.label}})}))],2)])]),t._v(" "),t._l(t.thread,(function(n){return e("ThreadEnvelope",{key:n.databaseId,attrs:{envelope:n,"mailbox-id":t.$route.params.mailboxId,expanded:t.expandedThreads.includes(n.databaseId),"full-height":1===t.thread.length},on:{delete:function(e){return t.$emit("delete",n.databaseId)},move:function(e){return t.onMove(n.databaseId)},toggleExpand:function(e){return t.toggleExpand(n.databaseId)}}})}))]],2)}),[],!1,null,null,null).exports),ai=a(25),ii={name:"MailboxThread",directives:{infiniteScroll:S},components:{AppContent:c.a,AppContentList:m.a,Mailbox:tn,NewMessageDetail:Ae,NoMessageSelected:ve,Popover:u.a,SectionTitle:y,Thread:ei},mixins:[s.a],props:{account:{type:Object,required:!0},mailbox:{type:Object,required:!0}},data:()=>({importantInfo:t("mail","Messages will automatically be marked as important based on which messages you interacted with or marked as important. In the beginning you might have to manually change the importance to teach the system, but it will improve over time."),bus:new x.default,searchQuery:void 0,shortkeys:{del:["del"],flag:["s"],next:["arrowright"],prev:["arrowleft"],refresh:["r"],unseen:["u"]}}),computed:{unifiedAccount(){return this.$store.getters.getAccount(ai.c)},unifiedInbox(){return this.$store.getters.getMailbox(ai.d)},hasEnvelopes(){return this.$store.getters.getEnvelopes(this.mailbox.databaseId,this.searchQuery).length>0},showThread(){return(!0===this.mailbox.isPriorityInbox||this.hasEnvelopes)&&"message"===this.$route.name},query(){return"starred"===this.$route.params.filter?this.searchQuery?this.searchQuery+" is:starred":"is:starred":this.searchQuery},newMessage(){return"new"===this.$route.params.threadId||"reply"===this.$route.params.threadId||"replyAll"===this.$route.params.threadId||"asNew"===this.$route.params.threadId},isThreadShown(){return!!this.$route.params.threadId}},methods:{deleteMessage(t){this.bus.$emit("delete",t)},onScroll(t){l.a.debug("scroll",{event:t}),this.bus.$emit("loadMore")},onShortcut(t){this.bus.$emit("shortcut",t)},appendToSearch(t){return void 0===this.searchQuery?t:this.searchQuery+" "+t},hideMessage(){var t;this.$router.replace({name:"mailbox",params:{mailboxId:this.$route.params.mailboxId,filter:null===(t=this.$route.params)||void 0===t?void 0:t.filter}})}}},oi=a(1332),ri={insert:"head",singleton:!1},si=(v()(oi.a,ri),oi.a.locals,Object(b.a)(ii,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("AppContent",{attrs:{"pane-config-key":"mail","show-details":t.isThreadShown},on:{"update:showDetails":t.hideMessage}},[e("template",{slot:"list"},[e("AppContentList",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.onScroll,expression:"onScroll"},{name:"shortkey",rawName:"v-shortkey.once",value:t.shortkeys,expression:"shortkeys",modifiers:{once:!0}}],attrs:{"infinite-scroll-immediate-check":"false","show-details":t.showThread,"infinite-scroll-disabled":!1,"infinite-scroll-distance":10,role:"heading","aria-level":2},nativeOn:{shortkey:function(n){return t.onShortcut.apply(null,arguments)}}},[t.mailbox.isPriorityInbox?[e("div",{staticClass:"app-content-list-item"},[e("SectionTitle",{staticClass:"important",attrs:{name:t.t("mail","Important and unread")}}),t._v(" "),e("Popover",{attrs:{trigger:"hover focus"}},[e("button",{staticClass:"button icon-info",attrs:{slot:"trigger","aria-label":t.t("mail","Important info")},slot:"trigger"}),t._v(" "),e("p",{staticClass:"important-info"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.importantInfo)+"\n\t\t\t\t\t\t")])])],1),t._v(" "),e("Mailbox",{staticClass:"nameimportant",attrs:{account:t.unifiedAccount,mailbox:t.unifiedInbox,"search-query":t.appendToSearch("is:pi-important"),paginate:"manual","is-priority-inbox":!0,"initial-page-size":5,collapsible:!0,bus:t.bus}}),t._v(" "),e("SectionTitle",{staticClass:"app-content-list-item starred",attrs:{name:t.t("mail","Favorites")}}),t._v(" "),e("Mailbox",{staticClass:"namestarred",attrs:{account:t.unifiedAccount,mailbox:t.unifiedInbox,"search-query":t.appendToSearch("is:pi-starred"),paginate:"manual","is-priority-inbox":!0,"initial-page-size":5,bus:t.bus}}),t._v(" "),e("SectionTitle",{staticClass:"app-content-list-item other",attrs:{name:t.t("mail","Other")}}),t._v(" "),e("Mailbox",{staticClass:"nameother",attrs:{account:t.unifiedAccount,mailbox:t.unifiedInbox,"open-first":!1,"search-query":t.appendToSearch("is:pi-other"),"is-priority-inbox":!0,bus:t.bus}})]:e("Mailbox",{attrs:{account:t.account,mailbox:t.mailbox,"search-query":t.query,bus:t.bus}})],2)],1),t._v(" "),t.newMessage?e("NewMessageDetail"):t.showThread?e("Thread",{on:{delete:t.deleteMessage}}):t.hasEnvelopes&&!t.isMobile?e("NoMessageSelected"):t._e()],2)}),[],!1,null,"407d295e",null).exports),li=a(1104),di={name:"Home",components:{Content:o.a,MailboxThread:si,Navigation:li.a},mixins:[s.a],computed:{activeAccount(){var t;return this.$store.getters.getAccount(null===(t=this.activeMailbox)||void 0===t?void 0:t.accountId)},activeMailbox(){return this.$store.getters.getMailbox(this.$route.params.mailboxId)},menu(){return this.buildMenu()}},created(){const t=this.$store.getters.accounts;if("home"===this.$route.name&&t.length>1){const n=t[0],e=this.$store.getters.getMailboxes(n.id)[0];console.debug("loading first mailbox of first account",n.id,e.databaseId),this.$router.replace({name:"mailbox",params:{mailboxId:e.databaseId}})}else if("home"===this.$route.name&&1===t.length)l.a.debug("the only account we have is the unified one -> show the setup page"),this.$router.replace({name:"setup"});else if("mailto"===this.$route.name){if(0===t.length)return void console.error("cannot handle mailto:, no accounts configured");const n=t[0],e=this.$store.getters.getMailboxes(n.id)[0];console.debug("loading composer with first account and mailbox",n.id,e.id),this.$router.replace({name:"message",params:{mailboxId:e.databaseId,threadId:"new"},query:{to:this.$route.query.to,cc:this.$route.query.cc,bcc:this.$route.query.bcc,subject:this.$route.query.subject,body:this.$route.query.body}})}},methods:{onNewMessage(){this.$router.push({name:"message",params:{mailboxId:this.$route.params.mailboxId,threadId:"new"}})},hideMessage(){var t;this.$router.replace({name:"mailbox",params:{mailboxId:this.$route.params.mailboxId,filter:null===(t=this.$route.params)||void 0===t?void 0:t.filter}})}}},ci=a(1376),pi={insert:"head",singleton:!1},mi=(v()(ci.a,pi),ci.a.locals,Object(b.a)(di,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("Content",{directives:[{name:"shortkey",rawName:"v-shortkey.once",value:["c"],expression:"['c']",modifiers:{once:!0}}],attrs:{"app-name":"mail"},nativeOn:{shortkey:function(n){return t.onNewMessage.apply(null,arguments)}}},[e("Navigation"),t._v(" "),t.activeAccount?e("MailboxThread",{attrs:{account:t.activeAccount,mailbox:t.activeMailbox}}):t._e()],1)}),[],!1,null,"8e7f1bfa",null));e.default=mi.exports},527:function(t,n,e){"use strict";e.d(n,"a",(function(){return l}));var a=e(528),i=e.n(a),o=e(1),r=e.n(o),s=e(0);
/**
 * @copyright 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
const l=i()(t=>{if(null===t)return Promise.resolve(void 0);const n=Object(s.generateUrl)("/apps/mail/api/avatars/url/{email}",{email:t});return r.a.get(n).then(t=>t.data).then(n=>n.isExternal?Object(s.generateUrl)("/apps/mail/api/avatars/image/{email}",{email:t}):n.url).catch(t=>{if(404!==t.response.status)return Promise.reject(t)})})},529:function(t,n,e){"use strict";var a=e(530),i=e.n(a),o=e(527),r={name:"Avatar",components:{BaseAvatar:i.a},props:{displayName:{type:String,required:!0},email:{type:String,required:!0},disableTooltip:{type:Boolean,default:!1},size:{type:Number,default:40}},data:()=>({loading:!0,avatarUrl:void 0}),computed:{hasAvatar(){return void 0!==this.avatarUrl}},mounted(){Object(o.a)(this.email).then(t=>{this.avatarUrl=t,this.loading=!1})}},s=e(28),l=Object(s.a)(r,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.loading||!t.hasAvatar?e("BaseAvatar",{attrs:{"display-name":t.displayName,size:t.size,"disable-tooltip":t.disableTooltip}}):e("BaseAvatar",{attrs:{"display-name":t.displayName,url:t.avatarUrl,size:t.size,"disable-tooltip":t.disableTooltip}})}),[],!1,null,null,null);n.a=l.exports},973:function(t,n){t.exports='<svg xmlns="http://www.w3.org/2000/svg"><path d="M2 13h7.8a1.4 1.4 0 001.1-.6L14 8l-3.1-4.4A1.4 1.4 0 009.8 3H2l3.4 5z" stroke="#000" stroke-width="2"></path></svg>'}},0,[8]]);
//# sourceMappingURL=mail.9.4aab34361cf4c523d8f9.js.map